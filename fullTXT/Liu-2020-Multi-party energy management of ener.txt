a05e291a-87f3-4242-a8c5-2219d950790d
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
Multi-party Energy Management of Energy
Hub: A Hybrid Approach with Stackelberg
Game and Blockchain
Nian Liu, Lu Tan, Linjie Zhou, and Qifang Chen
Abstract——In an integrated energy distribution system (IEDS),
an energy hub has been introduced and deemed to be a suitable
tool for managing and integrating multi-party energy forms.
Due to different energies having diverse characteristics and be‐
ing coupled with each other, it is difficult for an energy hub to
implement the optimal scheduling of multiple energy sources.
Therefore, an energy optimization management model is pro‐
posed based on the Stackelberg game, which considers the exer‐
gy conversion of multi-party energy sources in different opera‐
tion modes. The problem is solved by the two-layer distributed
optimization algorithm, in which the energy hub acts as the
leader and is followed by the users. Furthermore, in order to al‐
leviate the deception, malicious tampering, subpeption, and oth‐
er secure risks in energy trading, blockchain is introduced into
the energy hub and the concept of exergy coin (EC) is pro‐
posed. A credit-based blockchain framework and concurrent
block building consensus process is explored to reduce the cal‐
culation cost and promote the exergy trading efficiency. Finally,
the case study shows how the proposed method can effectively
optimize energy scheduling and configure a more reasonable en‐
ergy solution.
Index Terms——Energy management, Stackelberg game, exergy
coins (EC), exergy conversion, blockchain.
I. INTRODUCTION
RECENTLY, with the increasingly serious energy crisis
and environmental issues, in order to alleviate environ‐
mental pollution and improve the energy utilization efficien‐
cy, an integrated energy distribution system (IEDS) is pro‐
posed and considered as a promising solution [1]. In the
IEDS, different energies are coupled with each other in a
synergistic way, which includes natural gas/thermal/electrici‐
ty/hot water and other various energy forms [2]. New con‐
cepts and tools are essential when considering the interac‐
tions among multiple energy forms. In turn, energy hub has
been introduced and deemed to be a suitable tool for manag‐
ing and integrating various energy forms due to its high effi‐
ciency [3]. In energy hub, multiple types of energy carriers
are input at the imported interface which connect to energy
producers, and are stored, converted, or transferred within it,
then finally output to provide energy demands for users at
the exported interface [4]. The coordination and optimization
of various energy sources can improve the reliability and
flexibility of energy utilization [5], [6]. However, despite the
aforementioned advantages of energy hub, some challenges
must be considered regarding multi-party energy manage‐
ment.
Firstly, different energies have diverse characteristics, and
the optimal scheduling of multiple energy sources needs to
be considered simultaneously, which brings about the diffi‐
culties for energy hubs when interacting with users. In order
to solve the problem of energy optimization, exergy is pre‐
sented. Exergy is based on the laws of thermodynamics. It
acts as a measure of the energy quality, but unlike energy, it
is not conserved [7], [8]. Based on a given environment, the
maximum amount of energy that can be theoretically con‐
verted into “infinitely convertible energy” is called exergy,
which means that it varies with the environmental reference
[9]. Furthermore, exergy has received extensive attention
from academia and industry [10] - [14]. In [10], the conver‐
sion models of electric power, heat, sensible heat, and chemi‐
cal exergy are studied, in which the thermal process contain‐
ing the energy and conversion process with exergy metrics is
analyzed. A resource-based quantifier “extended exergy” is
applied to the energy conversion systems in [11]. The au‐
thors in [12] present a novel systematic approach to evaluate
the energy conversion processes based on an extended repre‐
sentation of their exergy flow diagram. An approach based
on cumulative exergy consumption and thermo-economic
methods is proposed in [13]. However, this work ignores the
various exergy demands and operation modes of different
seasons.
Secondly, an efficient security framework for energy trad‐
ing between users and energy hubs is lacking. Considering
the selfishness and rationality of users and energy hubs in
the energy transaction, each participant wants to maximize
their own profits. Therefore, the deception, malicious tamper‐
ing, subpeption, and other security risks may exist, which
bring about critical challenges for energy trading.
Manuscript received: August 9, 2019; accepted: December 19, 2019. Date of
CrossCheck: December 19, 2019. Date of online publication: August 10, 2020.
This work was supported by the Science and Technology Project of State
Grid Corporation of China (No. SGJX0000KXJS1900321).
This article is distributed under the terms of the Creative Commons Attribu‐
tion 4.0 International License (http://creativecommons.org/licenses/by/4.0/).
N. Liu, L. Tan, and L. Zhou are with State Key Laboratory of Alternate Elec‐
trical Power System with Renewable Energy Sources, North China Electric Pow‐
er University, Beijing, China (e-mail: nianliu@ncepu.edu.cn; 13717568897@163.
com; z1364317601@163.com).
Q. Chen (corresponding author) is with the School of Electrical Engineering,
Beijing Jiaotong University, Beijing, China (e-mail: chenqf@bjtu.edu.cn).
DOI: 10.35833/MPCE.2019.000545
919
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
In order to address the above-mentioned challenges, a hy‐
brid approach to the multi-party energy management of ener‐
gy hubs is proposed, which utilizes the exergy conversion,
Stackelberg game, and blockchain technology. An energy op‐
timization management scheme considering the exergy con‐
version of various energy sources in different seasons is pro‐
posed. Furthermore, the exergy interactions between the ener‐
gy hub and users are modeled as a two-stage Stackelberg
leader-follower game, in which the energy hub acts as the
leader that is followed by the users.
Blockchain is essentially a distributed ledger database,
which is a series of data blocks generated via cryptography
[15], [16]. It can provide a secure and transparent energy
trading environment for a distributed system without partici‐
pation of third-party authority. The authors in [17] propose
an efficient and secure framework for vehicle-to-grid (V2G)
energy trading by utilizing blockchain and edge computing,
and a proof-of-concept for a distributed energy trading sys‐
tem in a smart grid is introduced in [18] by exploring block‐
chain and multi-signature technologies. However, the calcula‐
tion cost and resource consumption of the traditional consen‐
sus process are huge, which is impractical for the energy
trading that involves high real-time requirements and high
frequency between the energy hub and users. In this paper,
for the sake of reducing the calculation cost and promoting
the trading efficiency, a credit-based blockchain framework
is proposed using a concurrent block building consensus pro‐
cess according to [19] and [20].
The main contributions of this paper are as follows:
1) A Stackelberg game model is proposed considering ex‐
ergy conversion in three operation modes. In order to realize
the unified and optimal dispatch of different qualities of en‐
ergies in the commercial park, the exergy is presented. The
exergy conversion models of electricity, cold, heat, and do‐
mestic hot water in the park are established, and all kinds of
energies are unified into exergy. Therefore, all kinds of ener‐
gies are involved in the Stackelberg game in the form of ex‐
ergy to achieve the unified optimization management of mul‐
tiple energy sources.
2) Blockchain is introduced into the energy hub and exer‐
gy coin (EC) is utilized, which is a virtual currency for the
trade between the energy hub and users. A credit-based
blockchain framework and concurrent block building consen‐
sus process is explored to reduce the calculation cost and
time delay, and to promote exergy trading efficiency.
II. SYSTEM MODEL
A. System Structure
The blockchain system structure is shown in Fig. 1. In the
commercial park, there is an energy hub and several users
who act as the participants. The energy hub owns the inter‐
nal combustion (IC) engine in order to take responsibility
for generating electricity and waste heat, and the gas-hot wa‐
ter operated lithium bromide absorption unit can use waste
heat to produce cold, heat, and hot water. The energy hub al‐
so owns the boiler which can generate heat or hot water by
burning natural gas, cold generating auxiliary equipment
such as an electric centrifugal chiller, and domestic hot wa‐
ter conversion equipment such as a plate heat exchanger and
heat pump.
B. Operation Mode
In order to meet the different energy demands of users in
different seasons, there are three operation modes. Figures 2-
4 are the structure diagrams of the centralized cooling, heat‐
ing and transition season operation modes, respectively. In
centralized cooling operation mode, all of the equipments in
the energy hub participate in the efforts to provide cold, elec‐
tricity, and hot water for users, while in the other two opera‐
tion modes the users have no demands for cold. Thus, there
is no need for the electric centrifugal chiller to participate in.
However, in centralized heating operation mode, the boiler
needs to generate heat and hot water at the same time [21].
Genesis
IC
engine 
Lithium bromide absorption  
Users
Exergy EC
Authority
Plate heat exchanger
Electric
heat pumpBoiler
Centrifugal
chiller
hea
Energy hub
Block number
Previous block hash
Current block
roothash
Block header
Block body
Transaction 
Signature
Timestamp
Block N
Block N�1 Block N Block N+1
�
Pla
Fig. 1. System structure with blockchain.
IC engine Lithium bromide
absorption
Electric centrifugal
chiller
Plate heat exchanger
Grid
Natural
gas
E
FGE
EGE ECR
FGB
EHP
Boiler
Electric heat
pump
QHP,hw
QCRC
QLBC
Qhw
QC
Qrec,eg
αQrec,cj
(1�α)Qrec,cj
Fig. 2. Centralized cooling operation mode.
IC engine Lithium bromide
absorption
Plate heat exchanger
Grid
Natural
gas
E
FGE
EGE
FGB
EHP
Boiler
Electric heat
pump
QHP,hw
Qhw
QH
Qrec,eg
αQrec,cj
(1�α)Qrec,cj
Fig. 3. Centralized heating operation mode.
920
LIU et al.: MULTI-PARTY ENERGY MANAGEMENT OF ENERGY HUB: A HYBRID APPROACH WITH STACKELBERG GAME AND BLOCKCHAIN
C. Exergy Conversion Model
In order to realize unified regulation and control via the
energy hub of different types of energies including electrici‐
ty, cold, heat, and domestic hot water, energies are converted
into exergy. The energy level coefficient is the ratio of the
exergy in energy, so according to the energy level coeffi‐
cient, each energy can be converted into exergy [22].
1) Electricity
Electricity is the highest grade of energy, so it can be com‐
pletely converted into exergy and the energy level coeffi‐
cient is equal to 1. The exergy of electricity can be defined
as:
ExE =E (1)
where ExE is the exergy of electricity; and E is the energy of
electricity.
2) Cold
The energy level coefficient of cold can be defined as λC
and the exergy of cold is ExQC
:
λC =
T
T 0
- 1 (2)
ExQC
= λCQC (3)
where T is the temperature of the environment; T 0 is the
temperature of the heat source; and QC is the energy of cold.
3) Heat
The energy level coefficient of heat can be defined as λH
and the exergy of heat is ExQH
:
λH = 1-
T
T 0
(4)
ExQH
= λHQH (5)
where QH is the energy of heat.
4) Domestic Hot Water
The energy level coefficient of domestic hot water can be
defined as λhw and the exergy of heat is ExQhw
:
λhw = 1-
T
T s - T r
ln
T s
T r
(6)
ExQhw
= λhwQhw (7)
where T s is the supply water temperature; T r is the return
water temperature; and Qhw is the energy of domestic hot wa‐
ter.
D. Basic Model
1) EC
In this paper, the concept of EC is proposed, which is cir‐
culated as the virtual currency in the trading process of the
blockchain. In this model, EC is assumed to possess the cur‐
rency value and is exchangeable with traditional currencies,
which can be used for purchasing goods and services [16].
The actual purchasing power of EC pex is represented by:
pex = ζB (8)
where ζ is the exchange rate between EC and CNY (i. e.,
CNY per unit of EC); and B is the total capacity of EC in
circulation.
2) IC Engine
The energy hub uses the IC engine as the prime mover
for generating electricity by burning natural gas to supply us‐
er demand, while combustion produces high-temperature flue
gas. The recoverable unit of waste heat can be used to recov‐
er and reuse the residual heat of high temperature flue gas
and cylinder liner water. The fuel energy ratio can be de‐
fined as:
R=
Qrec
LF GE
(9)
where Qrec is the recoverable heat from the IC engine; L is
the low calorific value; and F GE is the natural gas consump‐
tion.
Qrec can be further divided into the recoverable heat from
the flue gas Qreceg and the cylinder liner water Qreccj, which
account for the ratio of Qrec, respectively.
Qrec =Qreceg +Qreccj (10)
The IC engine output EGE can be defined as:
EGE =F GE (1-R- ηloss)L (11)
where ηloss is the energy loss rate of this process.
3) Boiler
A boiler is a pressure vessel that can provide hot water
and thermal power for the user by burning natural gas, and
the hot capacity generated from it can be calculated as:
QGB =F GBηGB =QGBhw +QGBH (12)
where F GB is the natural gas consumption efficiency; ηGB is
the energy conversion efficiency of a boiler; and QGBhw and
QGBH are the hot water capacity and the heat of the boiler, re‐
spectively. When it is in centralized heating mode, a boiler
generates hot water with the proportion of 0.6 and heat with
the proportion of 0.4. In the other two modes, it only pro‐
vides hot water.
4) Recoverable Unit of Waste Heat
The lithium bromide absorption unit operated by gas and
hot water is adopted in this paper. The lithium bromide unit
can utilize high-temperature flue gas and cylinder liner water
generated by the IC engine to produce cold, heat, or hot wa‐
ter.
When it is centralized heating or cooling season, the resid‐
ual heat enters the plate heat exchanger with the proportion
of α and the lithium bromide unit with the proportion of
1- α. The cooling capacity and the calorific capacity of the
lithium bromide unit are shown in (13) and (14), respective‐
ly. When it is transition season, the hot water capacity of the
lithium bromide unit is shown in (15).
QLBC =[Qreceg + (1- α)Qreccj]×COPLBC (13)
IC engine
Lithium bromide
absorption
Plate heat exchanger
Grid
Natural
gas
E
FGE
EGE
FGB
EHP
Boiler
Electric heat
pump
Qhw
Qrec,eg
Qrec,cj
Fig. 4. Transition season operation mode.
921
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
QLBH =[Qreceg + (1- α)Qreccj]×COPLBH (14)
QLBhw =Qreceg ×COPLBhw (15)
where COPLBC, COPLBH, COPLBhw are the refrigeration coeffi‐
cient, heating coefficient and hot water generation coeffi‐
cient of lithium bromide unit, respectively.
5) Electric Centrifugal Chiller
An electric centrifugal chiller is adopted to operate for re‐
frigeration. The cooling capacity of the unit is defined as:
QCRC =ECR ×COPCRC (16)
where COPCRC is the refrigeration coefficient of the electric
centrifugal chiller; and ECR is the power consumption for
cooling.
6) Electric Heat Pump
An electric heat pump is an energy converter that utilizes
electricity in order to satisfy the hot water demands of users.
Its hot water capacity QHPhw is calculated as:
QHPhw =EHP ×COPHPhw (17)
where COPHPhw is the coefficient of the performance of the
heat pump; and EHP is the power consumption.
7) Preparation Device of Domestic Hot Water
The domestic hot water is prepared by using the cylinder
liner water of the IC engine, and the water needs to pass
through the plate heat exchanger to obtain the domestic hot
water that meets the demand of the users. The domestic hot
water can be defined as:
Qhwp = nQreccjηphe (18)
where ηphe is the efficiency of the plate heat exchanger; in
the centralized cooling operation mode and the centralized
heating operation mode, n= α, and in the transition season
operation mode, n= 1.
8) Utility of Energy Hub
1) Cost of energy hub
The cost of the energy hub Ceh includes the cost of natu‐
ral gas consumption Cg, the cost of interaction with the grid
Celec, and the maintenance cost Cm.
Ceh =Cg +Celec +Cm (19)
ì
í
î
ïï
ïï
Cg = pg F GE
Celec = ps max(Egrid0)+ pb min(Egrid0)
Cm =∑pmom
(20)
where pg is the natural gas price; ps is the electricity purchas‐
ing price of the grid; pb is the electricity selling price of the
grid; Egrid is the interaction electricity with the grid; pm is the
maintenance cost of devices; and om is the output of devices.
In the centralized cooling operation mode, Cm = pGE EGE +
pabQLBC + pelQCRC + ppheQphe + pboilQGBhw + phpQHPhw. In the cen‐
tralized heating operation mode, Cm = pGE EGE + pabQLBH +
ppheQphe + pboil (QGBhw +QGBH)+ phpQHPhw. In the transition sea‐
son operation mode, Cm = pGE EGE + ppheQphe + pabQLBhw +
pboilQGBhw + phpQHPhw. pGE, pab, pel, pphe, pboil, and php are the
maintenance costs of the IC engine, the lithium bromide
unit, the electric centrifugal chiller, the plate heat exchanger,
boiler, and heat pump, respectively.
2) Profit of energy hub
The energy hub earns profits by selling exergy to the user,
which is calculated as:
Peh = pexSex (21)
where pex is the selling price of exergy which is equal to the
actual purchasing power of EC. The reason is that the ener‐
gy hub uses the EC to trade with the user and EC possesses
currency value. So the actual purchasing power of EC and
the selling price of exergy are equivalent. Sex is the total ex‐
ergy of all types of energies. In the centralized cooling oper‐
ation mode, Sex =ExE +ExQC
+ExQhw
; in the centralized heat‐
ing operation mode, Sex =ExE +ExQH
+ExQhw
; and in the transi‐
tion season operation mode, Sex =ExE +ExQhw
.
The utility function of the energy hub is defined as:
U eh =Peh -Ceh (22)
9) User’ s Utility
1) User’s cost
The user’s cost for purchasing exergy can be expressed as:
Cu = pexSex (23)
2) User’s profit
The user’s profit can be expressed as:
Pu =Kln(1+ Sex) (24)
The utility function is ln(1+ Sex) instead of ln(Sex), because
when Sex = 0, ln(Sex) approaches infinity.
Thus, the user’s utility can be defined as:
U u =Pu -Cu (25)
10) Balances and Constraints
1) Balances
In centralized cooling operation mode, the power balance,
cold balance, and domestic hot water balance can be ex‐
pressed as (26), (27), and (28), respectively.
E +ECR +EHP =Egrid +EGE (26)
QC =QCRC +QLBC (27)
Qhw = αQreccjηphe +QHPhw +QGBhw (28)
In centralized heating operation mode, the power balance,
heat balance, and domestic hot water balance can be ex‐
pressed as (29), (30), and (31), respectively.
E +EHP =Egrid +EGE (29)
QH =QLBH +QGBH (30)
Qhw = αQrec- cjηphe +QHP - hw +QGB- hw (31)
In transition season operation mode, the power balance
and domestic hot water balance can be expressed as (32)
and (33), respectively.
E +EHP =Egrid +EGE (32)
Qhw =Qreccjηphe +QHPhw +QGBhw +QLBhw (33)
2) Constraints
The constraints of the exergy can be expressed as:
ExEmin £ExE £ExEmax (34)
ExQCmin £ExQC
£ExQCmax (35)
ExQHmin
x £ExQH
x £ExQHmax
x (36)
ExQhwmin
x £ExQhw
x £ExQhwmax
x (37)
922
LIU et al.: MULTI-PARTY ENERGY MANAGEMENT OF ENERGY HUB: A HYBRID APPROACH WITH STACKELBERG GAME AND BLOCKCHAIN
where [ExEmin, ExEmax], [ExQCmin, ExQCmax], [ExQHmin, ExQHmax],
and [ExQhwminExQhwmax] are the ranges of electricity exergy,
cold exergy, heat exergy, and domestic hot water exergy, re‐
spectively.
III. STACKELBERG GAME AND BLOCKCHAIN
A. Stackelberg Game
In this subsection, the exergy interaction between the ener‐
gy hub and users is studied by utilizing the Stackelberg
game, which is an effective model for exploring the multi-
level decision-making process between decision makers and
responders [23]. In this paper, the objectives of the energy
hub and each user are to maximize the utilities defined in
(22) and (25). The energy hub is the leader who sets the ex‐
ergy price first, and the users are the followers who respond
to the exergy price by adjusting their exergy demands such
as electricity, cold, heat, and hot water.
The model of the Stackelberg game can be described as:
M S = { }(U O); su ; U u ; pex ; U eh (38)
The main components of the Stackelberg game M S in this
paper are as follows.
1) In the Stackelberg game, there are two players. One is
the energy hub O, and the other is the user U.
2) su is the set of strategies of each user, which varies
with the operation modes.
3) U u is the user’s utility.
4) pex is the strategy of the energy hub, which represents
the selling price of exergy.
5) U eh is the utility of the energy hub.
1) Stackelberg Equilibrium (SE)
The players in the Stackelberg game could not increase
their own utility by changing their own strategies [24] when
it reached the SE. The strategies at SE can be defined as
(su*pex*).
For the energy hub and users, the set of strategies reaches
an SE if and only if the following two inequalities are guar‐
anteed:
U u (su*pex*)³U u (supex*) (39)
U eh (su*pex*)³U eh (su*pex) (40)
where su* = (ExE*ExQC*ExQhw*) in the centralized cooling op‐
eration mode, su* = (ExE*ExQH*ExQhw*) in the centralized heat‐
ing operation mode, and su*= (ExE*ExQhw*) in the transition
season operation mode.
Then the existence of the SE will be proven in this paper.
If the following conditions are met at the same time, then
there is an SE [25], [26]: ① U u is a continuous function
about su and pex; ② U u is a quasi-convex function about su;
③ U eh is a continuous function about su and pex.
According to the formulas inferred as (19) and (22), the
utilities of the energy hub and users are continuous about
the variables. Thus, ① and ③ are correct. Next, the correct‐
ness of ② needs to be proven. It is known that if the func‐
tion is convex, it must be quasi-convex. So if it can be prov‐
en that the utility of user U u is a convex function about ExE,② can be proven. In (22), each part including ExE is convex
about ExE. Thus, U u is a convex function about ExE. Similar‐
ly, U u is also a convex function about ExQC
, ExQH
and ExQhw
.
Therefore, U u is a quasi-convex function about su, i. e., ②
has been proved.
Based on the above results, the existence of the SE in this
paper has been proven.
2) Algorithms of SE
In order to solve the problem and achieve SE, a two-layer
distributed optimization method is applied. It can effectively
reduce the calculation scale and protect the privacy of calcu‐
lation participants. In addition, it can solve the problem that
the variables of two objective functions mutually coupled as
a model. The upper-layer algorithm is shown in Fig. 5, in
which the energy hub aims at optimizing its utility and strat‐
egy. The lower-layer algorithm is called when the upper-lay‐
er algorithm is calculated, which is shown in Fig. 6. The us‐
er is the responder of the exergy price to get its utility and
strategy. The result of the lower- layer algorithm will return
to the upper-layer. The upper-layer adopts the differential
evolution (DE) while the lower layer applies the fmincon,
which is a kind of toolkit in MATLAB.
Energy hub sets the basic parameters
Generate the selling price of exergy pex randomly 
Energy hub sends the selling price of exergy to the
user and executes the lower-layer algorithm
Energy hub receives the strategy from the
user and calculate its utility Uope
Crossover and mutation to form new
compensation price pex�
Use new compensation price to calculate the
utility Uope� of the operator
Is the iterative
convergence condition reached?
N
N
Y
Y
Start
End
Uope<Uope�?
pex=pex�
Fig. 5. Upper-layer algorithm.
Solve the strategy by optimizing the utility function of the user
Start
The user sets the basic parameters
Receive the selling price of exergy from energy hub 
Send the strategy to energy hub
End
Fig. 6. Lower-layer algorithm.
923
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
B. Blockchain
After the game reaches SE, the equilibrium solution will
spread through the blockchain to the entire system. Figure 7
shows the steps for implementing exergy trading based on
the consortium blockchain in the commercial park.
1) Preliminaries
1) Key generation
Each user i selects two secret large prime numbers p and
q, and calculates n= pq and ϕ(n) [27]:
ϕ(n)= (p- 1)(q- 1) (41)
where ϕ(n) is the Eulers function of n. Next, user i selects an
integer e randomly, which satisfies:
1< e< ϕ(n) (42)
gcd(eϕ(n))= 1 (43)
where gcd(×) is the operation of calculating the greatest com‐
mon divisor. Then, user i calculates d, which satisfies:
de= 1mod ϕ(n) (44)
The public key and private key of user i are PKi = (en)
and SKi = (dn), respectively.
In this paper, RSA is employed, an asymmetric encryption
algorithm, in order to guarantee the authenticity and integrity
of the transmitted information.
2) Signature and verification model
Assume m is the plaintext of the message to be transmit‐
ted, H(m) is the hash digest of the message. The sender first
uses its private key SKi to encrypt H(m), i.e.,
c=ESKi
(H(m)) (45)
Any receiver can decrypt ciphertext c by utilizing the
senders public key PKi, which is known by the whole net‐
work, i.e.,
H(m)=DPKi
(c) (46)
Since the encryption is finished by utilizing the private
key SKi which is the private information of the sender, thus
the ciphertext c can be considered as the digital signature of
the transmitted message, which can also verifiy message
sources and data integrity, and the sender cannot deny the
message sent [28].
2) System Initialization
First, each user i has to generate a pair of information
keys, i.e., public/private key pair (PKiSKi), and obtain a cer‐
tificate Ceri from a trusted authority to guarantee the authen‐
ticity of PKi, which can specifically recognize the user by
their registration information, which can be described as:
Ceri = (PKiIDiTc) (47)
where IDi is the identity of user i; and Tc is the timestamp
of the certificate for guaranteeing its validity, only the regis‐
tered user is allowed to join in the exergy blockchain. Fur‐
thermore, the authority will announce a wallet address
addressi to the user, and in order to ensure individual priva‐
cy and security, public keys such as random pseudonyms are
utilized to replace the true address of the wallet. In this pa‐
per, the account of each user includes the information of wal‐
let address addressi, account balance balancei, current credit
value crediti, and certificate Ceri. Similarly, the account of
the energy hub includes wallet address addressEH, account
balance balanceEH, and key pair (PKEHSKEH).
3) Exergy Blockchain Implementation Process
Step 1: generate credit-based consensus node and select
leader node.
The credit value of each node can be used to show its
credibility and trustworthiness [29]. The credit value crediti
of user i is assumed to satisfy 0< crediti < 1. The larger the
number is, the higher the credibility is. In the system initia‐
tion, the credit value of each new node that joins in the exer‐
gy blockchain is set as 0.5, and if crediti < μ, node i is re‐
garded as a malicious node and could never be selected as
the consensus node, where μ is the pre-set threshold of cred‐
it value. At the beginning of each round of the consensus
process, the credit values of all nodes in the network are
ranked and the top N nodes are selected as the current round
consensus nodes, and N ³ 3f + 1 is considered, where f is the
maximum number of malicious nodes in the exergy block‐
chain.
Step 2: broadcast transactions and build local block.
After the Stackelberg game between the user and the ener‐
gy hub, each user formulates a transaction txi of the final op‐
timal strategies, which can be described as:
txi = (SigiexergyipiTs) (48)
where Sigi is its digital signature; exergyi is the request exer‐
gy; pi is the price of exergy which is set by the energy hub;
and Ts is the timestamp of transaction generation. Then, user
i broadcasts the transaction information of final optimal strat‐
egies to the whole network. Each consensus node n gathers
the transaction records within a certain period, then firstly
verifies the validity of the transaction by checking the time‐
stamp and the public keys of the users, followed by building
the local block concurrently [20], i. e., localblockn. In order
to guarantee verifiability and traceability, each newly created
block in the exergy blockchain is linked to the prior blocks
through a cryptographic hash. After all the nonleader consen‐
sus nodes finish building the local block, the leader sends its
Energy hub and the user obtain their
optimal strategies after game
The user assigns a pair of information
keys from a trusted anthority
Step 1: generate credit-based
consensus node and select leader node
Step 2: broadcast transactions
and build local block
Step 3: verify block and
publish new block
Results of
Stackelberg
game 
System
initialization
Consensus
process
Publish
new block
Steps about blockchain 
Start
End
Fig. 7. Steps for implementing exergy trading based on consortium block‐
chain.
924
LIU et al.: MULTI-PARTY ENERGY MANAGEMENT OF ENERGY HUB: A HYBRID APPROACH WITH STACKELBERG GAME AND BLOCKCHAIN
created block ℬ with its signature to other consensus nodes
for audit.
Step 3: verify block and publish new block.
Through verification and audit about the received block
data, by comparing ℬ with local block localblockn, each non‐
leader consensus node n generates a feedback message about
the results and then broadcasts the feedback message to the
whole exergy blockchain. Once the created block is verified
and accepted by ℳ participants in the network, the current
consensus process is ended, and the created block will be
published and linked at the latest blockchain. Therefore,
each nonleader consensus node and leader will be rewarded
a credit increase δ1 and δ2 for its contribution on consensus.
However, if over N nodes doubt the created block or the
feedback message of node n, they will be punished by a
credit decrease of -δ1 and -δ2, respectively [19]. Here, ℳ,
N, δ1, and δ2 are the pre-set parameters in the system initia‐
tion.
IV. CASE STUDY
A. Basic Data
In this paper, users and an energy hub in a commercial
park, Fujian Province, China, are taken as the study objects.
The load data of electricity, cold, heat, and domestic hot wa‐
ter is collected from the commercial park. The basic parame‐
ters for calculation in this case are shown in Table I.
TABLE I
BASIC PARAMETERS IN THE CASE
Subject
IC engine
Recoverable unit of waste heat
Peak shaving device of cold load
Heat pump
Boiler
Preparation device of domestic hot water
Parameter
L
R
a
b
ηloss
α
COPLBC
COPLBH
COPLBhw
COPCRC
COPHPhw
ηGB
ηphe
Value
9.9 kWh ×m-3
0.40
0.60
0.40
0.24
0.4
1.4
0.9
0.8
3.5
2.0
0.8
0.8
B. Convergence Results
According to the intelligent algorithm proposed in this
model, when the number of iterations is calculated to some
extent, the results will converge. The iterative process of the
algorithm is recorded and the convergence is judged.
Figure 8 shows the iterative process of the calculation ac‐
curacy of the utilities of the energy hub. Results show that
the utilities are all stable at a fixed calculation accuracy val‐
ue in different operation modes. In three different operation
modes, the calculation accuracy of the utilities of the energy
hub begins to converge when the number of iterations reach‐
es the range of 20 to 40.
Figure 9 shows the the iterative process of the calculation
accuracy of the utility of the users. They also begin to con‐
verge when the number of iterations reaches the range of 20
to 40 in three different operation modes like the energy hub.
In the transition season operation mode, the utility starts to
converge first, which uses about 100 s, followed by the cen‐
tralized heating operation mode with about 130 s, and the
centralized cooling operation mode with about 200 s.
C. Selling Prices of Exergy and Purchasing Power of EC
The selling price of exergy is equal to the purchasing pow‐
er of EC in this model. The reason is that the energy hub us‐
es EC to trade with the user and EC possesses currency val‐
ue. Thus, the actual purchasing power of EC and the selling
price of exergy are equivalent. In the Stackelberg game mod‐
el, the strategy of the energy hub is the selling price of exer‐
gy. In the centralized cooling operation mode, exergy in‐
cludes electricity, cold, and domestic hot water; in the cen‐
tralized heating operation mode, exergy includes electricity,
heat, and domestic hot water; and in the transition season op‐
eration mode, exergy only includes electricity and domestic
hot water.
Figure 10 shows the selling prices of exergy for the user
in three different modes. The selling prices vary with the op‐
eration modes. In centralized cooling operation mode, the
price peak appears at 13: 00-14: 00, while the price peak in
centralized heating operation mode appears at 21: 00-22: 00,
which is consistent with practical situations where users
have more demands for cold in the afternoon in summer,
while they have more demands for hot water and heat at
0 20 40 60 80 100
No. of iterations
A
cc
ur
ac
y
Centralized cooling
Centralized heating
Transition season
10-4
10-5
10-2
100
10-1
10-3
Fig. 8. Iterative process of calculation accuracy of operator utilities.
0 20 40 60 80 100
10-4
10-5
10-2
10-1
10-3
No. of iterations
A
cc
ur
ac
y
Centralized cooling
Centralized heating
Transition season
Fig. 9. Iterative process of calculation accuracy of user utility.
925
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
night in winter, so the energy hub sets high exergy prices to
shift the loads from peak time to valley time.
D. Exergy Demands
Figure 11 shows the exergy demand of electricity. In all
three operation modes, the user has a demand for electricity.
In order to maximize user utilities, the exergy demand of
electricity has changed from the original demand in different
operation modes. In the original curve, the maximum value
appears at 14: 00. But in the centralized cooling, transition
season curve, and centralized heating curve, it shifts to 12:
00, 17:00, and 18:00, respectively.
Figure 12 shows the exergy demand of cold and Fig. 13
shows the exergy demand of heat, with the former situation
only in the centralized cooling mode while the later only ex‐
ists in the centralized heating mode. Both figures show that
the exergy demands shift from high price time to low price
time in order to maximize the utilities of users.
Figure 14 is the exergy demand of domestic hot water. It
also exists in three modes like electricity. The trends are al‐
most the same in the centralized cooling modes, the transi‐
tion season, and they are similar to the original demand, and
the load peak appears at night, but the load peak in the cen‐
tralized heating mode is higher than the other three modes.
The results are consistent with the living habits of users in
that they have more hot water at night, especially in winter.
E. Privacy and Security Analysis of Blockchain
In this subsection, the privacy and security of the pro‐
posed blockchain based exergy trading are analyzed.
First, in system initialization, each user and energy hub
has to obtain a certificate from a trusted authority, and only
registered participants can join in the exergy trading, which
can prevent lots of malicious users. Besides, to ensure indi‐
vidual privacy and security, each user can regenerate infor‐
mation keys periodically to avert the linking attack [17], and
the true addresses of the wallet are replaced by random
pseudonyms. Furthermore, each block in the exergy block‐
chain contains a cryptographic hash to the prior blocks in or‐
0 5 10 15 20 25
Time (hour)
2000
4000
6000
8000
10000
12000
14000
16000
18000
Ex
er
gy
 (k
J/k
g)
Optimized exergy
Original exergy
Fig. 12. Exergy demand of cold.
0 5 10 15 20 25
Time (hour)
1000
2000
3000
4000
5000
6000
Ex
er
gy
 (k
J/k
g)
Optimized exergy
Original exergy
Fig. 13. Exergy demand of heat.
500
1000
1500
2000
2500
3000
3500
4000
4500
Ex
er
gy
 (k
J/k
g)
Transition season
Centralized cooling
Centralized heating
Original exergy
0 5 10 15 20 25
Time (hour)
Fig. 14. Exergy demand of domestic hot water.
0.2
0.4
0.6
0.8
1.0
1.2
1.4
1.6
Pr
ic
e 
(C
N
Y
/(k
J/k
g)
) Transition season
Centralized cooling
Centralized heating
0 5 10 15 20 25
Time (hour)
Fig. 10. Selling prices of exergy and purchasing power of EC for user.
0 5 10 15 20 25
Time (hour)
6000
8000
10000
12000
14000
16000
18000
20000
22000
Ex
er
gy
 (k
J/k
g)
Transition season
Centralized cooling
Centralized heating
Original exergy
Fig. 11. Exergy demand of electricity.
926
LIU et al.: MULTI-PARTY ENERGY MANAGEMENT OF ENERGY HUB: A HYBRID APPROACH WITH STACKELBERG GAME AND BLOCKCHAIN
der to guarantee verifiability and traceability. Therefore, it is
costly for a malicious attacker to revise the data in block‐
chain, and an asymmetric encryption algorithm is employed
in order to guarantee the authenticity and integrity of trans‐
mitted information, which makes it difficult to tamper with
and falsify data.
V. CONCLUSION
This paper introduces an energy management model based
on the Stackelberg game framework in a commercial park
with blockchain. And EC in the transaction process between
the energy hub and the user as currency medium is pro‐
posed. Three operation modes are established according to
the seasons, and in three different modes, the model of exer‐
gy conversion, the utility of the user, and the utility of the
energy hub are established. Then the Stackelberg game is uti‐
lized to model the interaction between the energy hub and
the users, and to solve the model via a two-layer optimiza‐
tion algorithm. The equilibrium solution spreads through the
blockchain to the entire network. A credit-based blockchain
framework and concurrent block building consensus process
is explored to reduce the calculation cost and time delay,
and to promote the exergy trading efficiency. Case study re‐
sults show that the proposed algorithm finally achieves con‐
vergence. The energy hub and the users adjust the strategies
separately in order to maximize their own utilities. The sell‐
ing price of exergy for the user can be obtained which can
reflect the scheduling strategies of users in different opera‐
tion modes. Therefore, the results have shown the accuracy
and efficiency of the proposed method.
REFERENCES
[1] C. Shao, Y. Ding, J. Wang et al., “Modeling and integration of flexi‐
ble demand in heat and electricity integrated energy system,” IEEE
Transactions on Sustainable Energy, vol. 9, no. 1, pp. 361-370, Jan.
2018.
[2] B. Zhou, D. Xu, C. Li et al., “Optimal scheduling of biogas-solar-
wind renewable portfolio for multicarrier energy supplies,” IEEE
Transactions on Power Systems, vol. 33, no. 6, pp. 6229-6239, Nov.
2018.
[3] L. Ma, N. Liu, J. Zhang et al., “Real-time rolling horizon energy man‐
agement for the energy-hub-coordinated prosumer community from a
cooperative perspective,” IEEE Transactions on Power Systems, vol.
34, no. 2, pp. 1227-1242, Mar. 2019.
[4] M. H. Barmayoon, M. Fotuhi-Firuzabad, A. Rajabi-Ghahnavieh et al.,
“Energy storage in renewable-based residential energy hubs,” IET Gen‐
eration, Transmission & Distribution, vol. 10, no. 13, pp. 3127-3134,
May 2016.
[5] X. Zhang, M. Shahidehpour, A. Alabdulwahab et al., “Optimal expan‐
sion planning of energy hub with multiple energy infrastructure,”
IEEE Transactions on Smart Grid, vol. 6, no. 5, pp. 2302-2311, Sept.
2015.
[6] N. Liu, J. Wang, and L. Wang, “Hybrid energy sharing for multiple
microgrids in an integrated heat-electricity energy system,” IEEE
Transactions on Sustainable Energy, vol. 10, no. 3, pp. 1139-1151, Jul.
2019.
[7] M. D. Cook, G. G. Parker, R. D. Robinett et al., “Decentralized mode-
adaptive guidance and control for DC microgrid,” IEEE Transactions
on Power Delivery, vol. 32, no. 1, pp. 263-271, Feb. 2017.
[8] M. Razmara, M. Maasoumy, M. Shahbakhti et al., “Optimal exergy
control of building HVAC system,” Applied Energy, vol. 156, pp. 555-
565, Oct. 2015.
[9] Y. Zhou, “Research on the building heating and cooling system with
exergy analysis,” Ph.D. dissertation, Hunan University, Changsha, Chi‐
na, 2013.
[10] D. Song, L. Lin, and W. Bao, “Exergy conversion efficiency analysis
of a cement production chain,” Energy Procedia, vol. 158, pp. 3814-
3820, Feb. 2019.
[11] E. Sciubba, “Cost analysis of energy conversion system via a noval re‐
source-based quantifier,” Energy, vol. 28, no. 5, pp. 457-477, Apr.
2003.
[12] E. Sciubba, “Extended-exergy accounting applied to energy recovery
from waste: the concept of total recycling,” Energy, vol. 28, no. 13,
pp. 1316-1334, Nov. 2003.
[13] E. Sciubba, “Beyond thermoeconomics? The concept of extended exer‐
gy accounting and its application to the analysis and design of thermal
systems,” Exergy, vol. 1, no. 2, pp. 68-84, Jul. 2001.
[14] B. Chen and G. Q. Chen, “Exergy analysis for resource conversion of
the Chinese Society 1993 under the material product system,” Energy,
vol. 31, no. 8, pp. 1115-1150, Jul. 2006.
[15] C. H. Liu, Q. Lin, and S. Wen, “Blockchain-enabled data collection
and sharing for industrial IoT with deep reinforcement learning,”
IEEE Transactions on Industrial Informatics, vol. 15, no. 6, pp. 3516-
3526, Jun. 2019.
[16] H. Jang and J. Lee, “An empirical study on modeling and prediction
of Bitcoin prices with Bayesian neural networks based on blockchain
information,” IEEE Access, vol. 6, pp. 5427-5437, Dec. 2018.
[17] Z. Zhou, B. Wang, Y. Guo et al., “Blockchain and computational intel‐
ligence inspired incentive-compatible demand response in Internet of
electric vehicles,” IEEE Transactions on Emerging Topics in Computa‐
tional Intelligence, vol. 3, no. 3, pp. 205-216, Jun. 2019.
[18] N. Z. Aitzhan and D. Svetinovic, “Security and privacy in decentral‐
ized energy trading through multi-signatures, blockchain and anony‐
mous messaging streams,” IEEE Transactions on Dependable Secure
Computing, vol. 15, no. 5, pp. 840-852, Oct. 2018.
[19] Z. Su, Y. Wang, Q. Xu et al., “A secure charging scheme for electric
vehicles with smart communities in energy blockchain,” IEEE Internet
Things Journal, vol. 6, no. 3, pp. 4601-4613, Jun. 2019.
[20] L. Yu, W. Tsai, G. Li et al., “Smart-contract execution with concurrent
block building,” in Proceedings of IEEE Symposium on Service-Ori‐
ened System Engineering (SOE), San Francisco, USA, Apr. 2017, pp.
160-167.
[21] L. J. Zhou, N. Liu, B. Guo et al., “Optimized energy management
method of multi-operation mode for energy system in commercial ar‐
ea,” Southern Power Systems Technology, vol. 12, no. 96, pp. 97-103,
2018.
[22] S. Yang and W. Tao, Heat Transfer. Beijing, China: Higher Education
Press, 2006.
[23] N. Liu, M. Cheng, X. Yu et al., “Energy-sharing provider for PV pro‐
sumer custers: a hybrid approach using stochastic programming and
Stackelberg game,” IEEE Transactions on Industrial Electronics, vol.
65, no. 8, pp. 6740-6750, Aug. 2018.
[24] L. Ma, N. Liu, J. Zhang et al., “Energy management for joint opera‐
tion of CHP and PV prosumers inside a grid-connected microgrid: a
game theoretic approach,” IEEE Transactions on Industrial Informa‐
tion, vol. 12, no. 5, pp. 1930-1942, Oct. 2016.
[25] N. Liu, L. He, X. Yu et al., “Multiparty energy management for grid-
connected microgrids with heat- and electricity-coupled demand re‐
sponse,” IEEE Transactions on Industrial Information, vol. 14, no. 5,
pp. 1887-1897, May 2018.
[26] X. C. Deng and H. H. Guo, “Existence of the equilibrium solution of
a two-stage leaders-followers game,” Mathematics Economics, vol. 26,
no. 4, pp. 50-53, Dec. 2009.
[27] N. Liu, C. Wang, M. Cheng et al., “A privacy-preserving distributed
optimal scheduling for interconnected microgrids,” Energies, vol. 9,
no. 12, pp. 1031, Dec. 2016.
[28] Z. Ma, X. Wang, K. J. Deepak et al., “A blockchain-based trusted data
management scheme in edge computing,” IEEE Transactions on Indus‐
trial Information, vol. 16, no. 3, pp. 2013-2021, Mar. 2020.
[29] Y. Wang, Z. Su, and N. Zhang, “BSIS: blockchain-based secure incen‐
tive scheme for energy delivery in vehicular energy network,” IEEE
Transactions on Industrial Information, vol. 15, no. 6, pp. 3620-3631,
Jun. 2019.
Nian Liu received the B.S. and M.S. degrees in electric engineering from
Xiangtan University, Xiangtan, China, in 2003 and 2006, respectively, and
the Ph.D. degree in electrical engineering from North China Electric Power
University, Beijing, China, in 2009. He is a Professor with School of Electri‐
927
JOURNAL OF MODERN POWER SYSTEMS AND CLEAN ENERGY, VOL. 8, NO. 5, September 2020
cal and Electronic Engineering at North China Electric Power University,
Beijing, China. He is a member of State Key Laboratory of Alternate Elec‐
trical Power System with Renewable Energy Sources and a member of Stan‐
dardization Committee of Power Supply and Consumption in Power Indus‐
try of China. He was a Visiting Research Fellow at The Royal Melbourne
Institute of Technology (RMIT) University, Melbourne, Australia, from 2015
to 2016. He has authored or co-authored more than 160 journal and confer‐
ence publications and has been granted for more than 10 patents of China.
He is an Editor of IEEE Transactions on Smart Grid, IEEE Transactions on
Sustainable Energy, IEEE Power Engineering Letters, and Journal of Mod‐
ern Power Systems and Clean Energy (MPCE). His research interests in‐
clude multi-energy system integration, microgrids, cyber-physical energy
system and renewable energy integration.
Lu Tan received the B.S. degree from North China Electric Power Universi‐
ty, Beijing, China, in 2019. She is currently working toward the M.S. de‐
gree in the School of Electrical and Electronic Engineering, North China
Electric Power University, Beijing, China. Her research interests include en‐
ergy management of microgrids, multi-energy system integration.
Linjie Zhou received the B.S. degree from Hebei University of Technology,
Tianjin, China, in 2017. She is currently working toward the M.S. degree in
the School of Electrical and Electronic Engineering, North China Electric
Power University, Beijing, China. Her research interests include energy man‐
agement of microgrids and the optimal operation of integrated energy sys‐
tem.
Qifang Chen received the B.S. and M.S. degrees in communication engi‐
neering and electric engineering respectively, from Xiangtan University,
Xiangtan, China, in 2010 and 2013, and the Ph.D. degree in electrical engi‐
neering from North China Electric Power University, Beijing, China, in
2017. Currently, he is with the School of Electrical Engineering of Beijing
Jiaotong University, Beijing, China. His research interests include micro-
grid, renewable energy vehicles and integrated energy system.
928