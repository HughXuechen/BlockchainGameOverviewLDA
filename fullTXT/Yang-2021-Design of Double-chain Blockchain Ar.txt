bec52fe8-3c8d-4cd3-acb7-b67d175aaf51
第 45卷 第 9期 2021年 5月 10日 Vol. 45 No. 9 May 10，2021
http：//www.aeps-info.com
双链式区块链架构设计及其点对点交易优化决策实现
杨洪明 1，2，阳泽峰 1，漆 敏 3，罗翼婷 1，张诗鸣 4
（1. 长沙理工大学电气与信息工程学院，湖南省长沙市 410076；
2. 教育部基于分布式光储的能源互联网运行与规划国际合作联合实验室，长沙理工大学，湖南省长沙市 410114；
3. 国网四川省电力有限公司自贡供电公司，四川省自贡市 643000；
4. 国网福建省电力有限公司经济技术研究院，福建省福州市 350011）
摘要：在开放的售电侧市场中，具有电能生产和消费双重特性的产消者开展灵活对等的点对点交
易。针对单链式区块链无法同时满足产消者交易的网络安全校核与去中心化问题，提出一种交易
链和电能链耦合运行的双链式区块链及其点对点交易决策模型。其中交易链 (公有链)实现产消者
自主博弈的点对点交易，以市场方式最大化各产消者之间的经济利益；电能链 (联盟链)以网络潮流
为约束，实现市场交易方案的安全校核和调整。基于以太坊区块链开发平台，搭建 IEEE 14节点配
电系统点对点交易仿真场景。仿真结果表明，所设计的双链式区块链比单链式具有更高的交易处
理效率和性能，能实现产消者点对点自主交易，保证了交易方案的安全自动执行。
关键词：双链式区块链；点对点交易；博弈决策；网络约束；耦合运行
0 引言
随着大量的分布式可再生能源、分布式储能设
备和具有可控性的用电设备接入需求侧，传统的电
能消费者转变成兼具电能生产和消费双重特性的电
能产消者（简称产消者）。拥有分布式可再生能源、
储能设备和可控性负荷设备的产消者将作为一种新
兴的市场主体参与市场竞争［1］。产消者通过考虑自
身经济效益最大化为目标，自主选择交易对象，向其
他产消者或电网公司购/售电能。在配电系统中，产
消者数量庞大，单笔交易规模小，且产消者的发用电
特性具有明显的差异性和不确定性。若采用传统集
中式交易，即交易中心负责所有交易的组织、磋商和
结算工作，势必需要建设十分庞大的交易中心来完
成。交易运行成本高、效率低，难以满足多元市场主
体间自由磋商、主动协调、相互信任的新要求，而需
要一种去中心化、安全、可信的新型交易方式予以
支撑。
区块链是一种全新的分布式基础架构与记账技
术，为多方协作提供信任基础，具有公正、公开和智
能化管理的特征，支撑用户以分布方式自主进行交
易［2］。目前，国内外能源企业正积极开展能源区块
链 试 验 项 目 。 美 国 LO3 Energy 与 Consensus
Systems合作设计了基于区块链技术的分布式光伏
售电平台 TransActive Grid［3］，将以太坊区块链技术
应用于能源交易。国家电网有限公司开展了基于区
块链的光伏补贴和共享储能等业务［4］。中国南方电
网有限责任公司利用区块链技术在绿证交易和电动
汽车等方面取得了一定进展［5］。
区块链技术在电能交易工程示范应用的同时，
国内外学者开展了初步的理论探索。首先，结合区
块链去中心化、协调自治和不可篡改的特点，探讨了
区块链在能源互联网中的应用前景［6］，设计了基于
区块链的配电系统分布式能源市场架构［7-8］。针对
分布式发电容量小、波动性大的特点，探讨了区块链
应用在分布式能源市场的可能性［9］，提出了点对点
电力交易模式［10-11］。其次，针对分布式能源交易运
行效率问题，提出了基于区块链技术的信誉值激励
方法［12］。针对分布式能源交易安全问题，提出了配
售电交易平台［13］，以区块链技术实现交易的安全结
算，保证合同总账和分账之间数据的一致性［14］。
上述研究探讨了区块链技术应用于电力交易的
方法，以分布式记账的形式保证交易过程的公开透
明与安全可信，但并没有涉及点对点交易必须遵循
电力网络安全约束的研究。针对交易的安全校核问
题，有研究提出了基于区块链的电能交易和阻塞管
DOI：10. 7500/AEPS20200508002
收稿日期：2020-05-08；修回日期：2020-10-08。
上网日期：2020-12-25。
国家自然科学基金资助项目（71931003）；湖南省科技项目
（2019CT5001）。
19
2021，45（9） ·区块链技术在电力系统中的应用·
理方法［15］和考虑安全约束的分布式电力交易方
法［16］。以上方法虽然考虑了系统安全约束，但交易
方接受由调度中心给出的交易校核与调整结果，电
能交易的去中心化程度不高，并且没有考虑调整结
果的可信问题。
为了降低交易运行成本，满足点对点交易去中
心化、安全与可信的需求，同时满足电力网络约束条
件，本文提出了一种新的电能链和交易链耦合协同
运行的双链式区块链。在此基础上，构建了基于双
链式区块链的产消者点对点交易决策模型，其中交
易链（公有链）实现产消者自主博弈的点对点交易，
电能链（联盟链）以网络潮流为约束，实现市场交易
方案的安全校核和调整。
1 兼顾经济和物理属性的双链式区块链
1. 1 双链式区块链架构设计
电能作为特殊商品参与市场交易时，除了具备
一般商品交易的经济属性外，还必须遵循电力网络
的物理约束。为此，本文提出兼顾经济和物理属性
的双链式区块链结构，以有效解决市场达成交易所
产生的网络安全校核问题，如图 1所示。
对比现有的单链式区块链，本文所提出的双链
式区块链结构具有如下特点：
1）交易信息和物理信息分开部署，交易链和电
能链耦合且独立运行。现有单链式区块链上交易方
案安全校核时，各区块除了每个节点（产消者）的交
易信息以外，还需存储系统所有的物理信息，造成区
块链容量剧增，性能下降。所提出的双链式区块链
结构中，交易链采用完全去中心化的公有链，只存储
每个节点的交易信息，实现产消者点对点交易方案
的自主决策和存储。电能链采用多中心化的联盟
链，各区块只存储了系统的物理信息，实现交易方案
的多中心化安全校核。同时，区块链上部署智能合
约，自动触发交易链上交易达成，校核权节点进行交
易方案的校核以及调整后的交易自动结算，详见
2.3节。
2）点对点交易自主决策的去中心化交易链设
计。每个产消者以追求自身利益最大化为目标，与
不同产消者之间自行达成电能交易需求。交易链上
每个节点（对应每个产消者）都带有一条完整的区块
信息，区块存储了产消者地址、产消者的交易电量、
电价等信息。所有交易链节点通过共识机制相互竞
争产生记账权节点，当有新交易发生时，记账权节点
通过共识机制实现交易链所有节点信息的自动更
新。同时，产消者达成的所有交易通过交易链区块
可以进行追溯，且不可人为篡改，无需强制性的交易
中心，即可实现产消者交易电价和电量的自行决策
与自我管理。
3）网络约束安全校核的多中心化电能链设计。
兼容传统上由电网调度中心完成网络安全校核的实
际特征，采取了多中心的联盟链，完成多中心化的安
全校核。该方式仍然由调度中心实施安全校核，又
可以加入市场主体认可的部门，如电力监管部门、交
易中心，甚至在透明和公开的成熟市场下加入市场
主体信任的产消者，验证校核结果的公平性与可信
性。当前，调度中心掌握了全部的系统物理数据和
电网运行状态，监管机构仅仅在行政上给予监督，交
� � �
� �
44
3�
*K
*�
$"
K�
*6J1
��J1(@B�7%)
�
��
��
��
��
��
��
��JN(7%N)
�
��
��
��
��
��
��
*6Ji
�44
3�
*K
*�
$"
K�
��
��
�
44
3�
*K
*�
$"
K�
*6Jk
���7%��
�7%����J
�6	3(?���)
F*24
�"
52
�"
51
�"
5N
�"5
N�1
��J
*6J
����"
')��"
	3��"
�"57%
图 1 点对点交易双链式区块链
Fig. 1 Double-chain blockchain for peer-to-peer transactions
20
杨洪明，等 双链式区块链架构设计及其点对点交易优化决策实现
http：//www.aeps-info.com
易中心只负责接收调度中心校核之后的数据（现有
工作基于调度给出的调整数据是完全真实可靠的），
没有承担验证交易调整信息是否可信和公平的职
能。因此，所设计的多中心化电能链在一定程度上
增加了电力系统调度的透明性，更好体现市场交易
调整的公平性。
电能链上每个节点带有一条完整的区块信息，
存储了系统物理数据，如配电网结构、支路阻抗、传
输线路功率限值等。区块信息的具体设定由市场开
放程度和系统安全运行条件共同决定，一般可以将
动态安全稳定校核全权交给调度中心，而将基本的
网架结构、线路参数和断面传输极限等信息公开（这
些数据在美国等成熟市场中对参与主体发布）。电
能链上校核权节点首先实施交易链所提供的交易方
案的校核和调整。然后，电能链上的其他节点根据
区块信息验证交易调整的可信和公平，即只有当大
多数节点验证同意校核权节点所实施的交易调整，
交易调整区块才能被认证为有效。因而，多中心化
或多个节点联盟链构建的电能链避免了单节点校核
的垄断情况（仅由调度中心实施），有效提高交易方
与校核方之间的信任度，防止完全由单节点校核所
产生的不公平、不透明交易调整。
根据每个节点完成安全校核的实际情况，区块
链会向全网发布信用评价值，以提供给所有节点，详
见 2.4节。同时，为了保证电能链的稳定运行和电
网安全运行，由调度中心作为电能链的校核权节点，
实施网络安全校核，其他部门是否作为电能链上的
节点，视其信用评价值、产消者选举情况和电网实际
运行状况而定。
1. 2 交易链与电能链耦合运行机制
交易链上的所有节点通过竞争选举产生记账权
节点，实施市场交易记录。电能链上的校核权节点
实施交易的网络安全校核和调整。以记账权节点和
校核权节点作为耦合，形成交易链与电能链的耦合
运行机制，如图 2所示。首先，每个产消者通过与其
他产消者之间的博弈和谈判，形成各自经济利益最
大的市场交易方案M，达到市场Nash均衡，详见 2.1
节。交易链采用权益证明（proof of stake）共识机
制，周期性选举记账权节点，且节点获得记账权的概
率与其电能交易份额占比正相关。记账权节点将更
新的交易方案M打包成区块信息，并向交易链上所
有节点广播，经一定数量的节点签名确认后，成为交
易链上的一个区块。
同时，电能链上的校核权节点作为一个节点加
入交易链（交易链作为公有链，所有节点可以自由加
入或退出），获取待校核的交易区块信息，并向所有
电能链节点发布。根据系统物理信息，实施交易方
案M的安全校核与调整。若市场达成的交易M满
足电力网络安全约束，则交易方案无须调整，校核权
节点的交易调整区块信息为 0。若市场交易不满足
电力网络安全约束，则调整交易方案，详见 2.2节。
7%1
7%2 7%3
7%1
7%i7%k
�	
��
��
��
A�
��
�
�
7%0
*6J�"
51
�"
5i
*4�	
@B�7%
(�@���*)
44
3�
*K
*�
$"
K�
���
	�� 
N
Y
M1
M 	M1
M
M
ΔM�0
ΔM 0
��
��
A�
��
�@��
��J
*6J
���7%
�	
��
��
��
A�
��
�
�	
��
��
��
A�
��
�
图 2 电能链与交易链耦合运行
Fig. 2 Coupling operation of power and transaction blockchains
21
2021，45（9） ·区块链技术在电力系统中的应用·
电能链为联盟链，节点的可信任度高，采用权威证明
（proof of authority）共识机制，指定校核权节点拥有
电能链的记账权限。由校核权节点所形成的交易调
整区块信息 ΔM，向所有电能链节点发布。链上其
他节点仅对交易调整信息进行共识验证。
然后，电能链上校核权节点作为交易链上的一
个节点，将交易调整区块信息发布至交易链，由记账
权节点接收并验证信息的真实性，验证通过后实施
交易链上所有节点的交易调整区块信息的一致更
新，并按照调整后的交易方案M 1自动执行并结算。
安全校核结束后，校核权节点会自动退出交易链。
为此，校核权节点将交易链和电能链紧密耦合，实现
双链上区块信息的一致更新和相互信任。
交易链和电能链之间数据的安全交互和信任机
制，遵循区块链跨链技术的具体实现。这里，采用公
证人机制实现跨链，跨链双方选举校核权节点作为
共同信任的第三方。校核权节点接收交易链上的交
易区块信息进行校核，并将校核后的交易调整区块
信息发布至交易链。跨链过程中，须校验校核权节
点所递交的区块头信息，包括公私钥技术加密的数
字签名和具有唯一性的Merkle树根，数字签名可保
证数据来源的合法性，Merkle树根用于验证交易内
容的完整性，从而保证交易链与电能链之间的通信
安全，保证跨链过程中数据源的真实可信。
2 考虑网络安全校核的点对点交易优化决
策及其双链式区块链实现
2. 1 基于完全去中心化交易链的点对点交易优化
决策建模
在市场交易中，每个产消者根据智能电表采集
的分布式电源发电功率和负荷功率以及下一时段的
预测值，以最大化自身收益为目标，优化决策各自的
购电或售电功率。产消者 i在时刻 t的点对点交易
优化决策模型为：
max Si= τd，i P d，i- ∑
j= 1，j≠ i
N
τi，j P i，j -
τgrid，i P grid，i- C g，i ( P g，i ) （1）
s.t. ∑
j= 1，j≠ i
N
Pi，j + P grid，i+ P g，i- P d，i= 0 （2）
P g，i，min ≤ P g，i≤ P g，i，max （3）
{Pi，j=-Pj，i
τ i，j= τj，i≥ 0
（4）
式中：Pi，j和 P grid，i分别为产消者 i与产消者 j和电网
公司达成的交易量，其中正值表示产消者 i向产消
者 j或电网公司购买的功率，负值则表示售出的功
率；τi，j和 τgrid，i 为相应的交易价格，涵盖了交易经过
配电网输送所需承担的过网费（依据分布式交易政
策，按照电压等级以及台区范围制定）；P d，i 为产消
者 i所需提供的负荷功率；τd，i为用电价格；P g，i为产
消者 i的发电功率；C g，i ( ⋅ )为发电成本函数；P g，i，max
和 P g，i，min分别为产消者 i的最大和最小发电出力；N
为点对点交易所处配电系统节点总数，这里假设每
个产消者处于不同的节点上，节点编号与产消者编
号一致。
以上产消者点对点交易优化决策在交易链中的
具体执行过程，如图 3所示。首先，每个产消者将当
前时刻的购/售电信息 xi上传至交易链节点对应的
区块中（这里 xi是产消者愿意公开发布的策略性信
息）。通过记账权节点，实现交易链所有信息的共识
和区块的更新，达到信息分布式存储和完全去中心
化。其次，产消者读取节点对应的区块信息，包括历
史交易信息和其他产消者发布的策略性信息 x- i，调
整自身的购/售电策略。如此反复，通过与其他产消
者之间的谈判，达到市场均衡点 x ∗。
�@��
��J
7%1 7%i 7%N
�������
�@��
� �
�"51
0*���x1
����x1 x-1  A	 A	��x-N xN  ��
�6*= 7��0
�"5i
0*���xi
�6*= 7��0
�"5N
0*���xN
�6*= 7��0
x-i  A	 ����xi
�	
��
�	
��
��
��
�
�	
��
�	
��
��
��
�
�	
��
�	
��
��
��
�
图 3 基于完全去中心化交易链的产消者点对点优化决策
Fig. 3 Peer-to-peer optimization decision of prosumers based on completely decentralized transaction chain
2. 2 基于多中心化电能链的网络安全校核及点对
点交易调整建模
基于去中心化交易链，所有产消者市场达成的
交易方案 x ∗在具体实施和执行之前，必须通过网络
安全校核，满足电力系统的安全约束。为此，设计交
易链与电能链的耦合运行，提出基于多中心化电能
链的网络安全校核方法，实现对市场达成方案M的
公平校核和合理调整。
电能链选取多中心化的联盟链，所有节点区块
存储点对点交易所在配电系统的物理数据。调度中
心机构（配电系统以外的第三方非盈利机构）、大型
发电公司（配电系统以外的第三方盈利企业）和产消
者（配电系统内的盈利企业）都可以作为电能链节
点。电能链节点由全体产消者节点投票选出，并根
据产消者节点信誉值（参与每次交易的诚信度，诚信
度高的产消者节点投票权重高）综合拟定。电能链
节点确定后，由校核权节点，执行具体交易的安全
校核。
电力系统安全校核分为静态和动态 2个方面，
这里重点考虑线路传输功率上下界约束的静态安全
校核，动态安全则反映在传输功率限值上。交易校
核集合 ΦM 由所有产消者达成的市场交易功率，功
率注入节点和流出节点组成，包括产消者之间的双
边交易集合ΦM 1以及产消者与电网公司达成的交易
集合ΦM 2，即：
ΦM= ΦM 1 ∪ΦM 2 =
{ P ∗
i，j≥ 0，∀i，j，i≠ j }∪ { P ∗
grid，i，∀i } （5）
式中：P ∗
i，j 和 P ∗
grid，i 分别为经过优化决策达成市场均
衡点 x ∗后产消者 i与产消者 j或电网公司的交易量。
配电系统中产消者的节点注入功率 Pi为：
Pi= ∑
j= 1，j≠ i
N
P ∗
i，j+ P ∗
grid，i （6）
基于电力网络潮流方程，计算每条线路上的传
输功率 Pl，进行上下界约束校核，即若满足
-Pl，max ≤ Pl ≤ Pl，max l= 1，2，⋯，N （7）
则所有市场交易通过安全校核，按原交易计划执行；
若式（7）不满足，则以交易调整量最小为目标，执行
调整决策，具体调整模型和求解过程见文献［17］。
在实际基于区块链的市场交易过程中，交易链上产
消者自行达成的交易区块信息 x ∗，经过与之耦合的
电能链上校核权节点的安全校核，形成区块调整
信息。
2. 3 交易自动执行的智能合约部署
智能合约是部署在区块链上的一种交易合同触
发机制，满足触发条件时，实现交易方案的自动执
行、资金的自动转移和现金的自动结算等功能。它
在没有第三方的情况下进行可信交易，交易可追踪
且不可逆转。为了自动执行点对点交易决策及安全
校核，将点对点交易执行过程编写成智能合约，并部
署在交易链和电能链耦合的区块链上。点对点交易
智能合约包括交易封装报价、优化决策、安全校核、
交易结算等 4个功能模块，具有无合同执行期、合同
谈判期、合同校核期、合同签订期、合同执行期、偏差
考核期等 6种状态，如图 4所示。
智能合约的触发机制可以设置为特定时间下的
规定执行动作，如提前一日的 12：00开始合同谈判
并确认交易方案，其内容包括产消者双方所处节点
（功率注入节点和功率流出节点）、交易功率、交易价
格、交易时间等；提前一日的 18：00，开始合同的安
全校核，确认每个交易的调整功率；提前一日的
22：00，根据合同谈判期确认的交易方案和合同校
核期确认的每笔交易功率调整方案，签订正式交易
合同；实际交易当日，按照签订的正式合同自动执
行，实现资金的自动结算和转移。
由于点对点交易的产消者包括具有间歇、波动
的分布式风光发电机组、随机变化的用电负荷，实际
功率值往往与所签订的合同功率存在偏差。为此，
交易后一日 24：00，智能合约会对产消者的偏差电
量进行考核。根据实际功率与合同功率 P̄ i 的偏差
功率 ΔP̄ i，计算偏差电费 Δπi，分成两部分计算，即
±αP̄ i 以内的偏差电费（α为偏差考核惩罚所设置的
合同电量百分数，如 3%）以及 ±αP̄ i 以外的偏差
电费。
2. 4 交易链和电能链节点信用值激励机制
交易链和电能链上的每个节点（包括参与市场
交易的产消者、交易中心和电网调度等第三方机构）
每完成一次电能交易或安全校核时，则需要进行一
次该节点信用值评价。信用值体现了产消者的交易
质量、第三方机构的校核质量及其可信任度，直接关
系到节点在区块链的交易或校核中被选择的优先程
�		�=�
		0@�
		�=�
��5��
0@A�	+
		����
A�	+		�
���7��=
��K��*F�
		*F+��E
=5��30
		A��
		���
���"5A�U
-@%�%����
*6J���7%
��F*24��
3�U-@ ��
��L+A��(
���
12:00
	��
24:00
����
����
���
22:00
���
18:00
图 4 智能合约的运作机理
Fig. 4 Operation mechanism of intelligent contract
22
杨洪明，等 双链式区块链架构设计及其点对点交易优化决策实现
http：//www.aeps-info.com
2. 2 基于多中心化电能链的网络安全校核及点对
点交易调整建模
基于去中心化交易链，所有产消者市场达成的
交易方案 x ∗在具体实施和执行之前，必须通过网络
安全校核，满足电力系统的安全约束。为此，设计交
易链与电能链的耦合运行，提出基于多中心化电能
链的网络安全校核方法，实现对市场达成方案M的
公平校核和合理调整。
电能链选取多中心化的联盟链，所有节点区块
存储点对点交易所在配电系统的物理数据。调度中
心机构（配电系统以外的第三方非盈利机构）、大型
发电公司（配电系统以外的第三方盈利企业）和产消
者（配电系统内的盈利企业）都可以作为电能链节
点。电能链节点由全体产消者节点投票选出，并根
据产消者节点信誉值（参与每次交易的诚信度，诚信
度高的产消者节点投票权重高）综合拟定。电能链
节点确定后，由校核权节点，执行具体交易的安全
校核。
电力系统安全校核分为静态和动态 2个方面，
这里重点考虑线路传输功率上下界约束的静态安全
校核，动态安全则反映在传输功率限值上。交易校
核集合 ΦM 由所有产消者达成的市场交易功率，功
率注入节点和流出节点组成，包括产消者之间的双
边交易集合ΦM 1以及产消者与电网公司达成的交易
集合ΦM 2，即：
ΦM= ΦM 1 ∪ΦM 2 =
{ P ∗
i，j≥ 0，∀i，j，i≠ j }∪ { P ∗
grid，i，∀i } （5）
式中：P ∗
i，j 和 P ∗
grid，i 分别为经过优化决策达成市场均
衡点 x ∗后产消者 i与产消者 j或电网公司的交易量。
配电系统中产消者的节点注入功率 Pi为：
Pi= ∑
j= 1，j≠ i
N
P ∗
i，j+ P ∗
grid，i （6）
基于电力网络潮流方程，计算每条线路上的传
输功率 Pl，进行上下界约束校核，即若满足
-Pl，max ≤ Pl ≤ Pl，max l= 1，2，⋯，N （7）
则所有市场交易通过安全校核，按原交易计划执行；
若式（7）不满足，则以交易调整量最小为目标，执行
调整决策，具体调整模型和求解过程见文献［17］。
在实际基于区块链的市场交易过程中，交易链上产
消者自行达成的交易区块信息 x ∗，经过与之耦合的
电能链上校核权节点的安全校核，形成区块调整
信息。
2. 3 交易自动执行的智能合约部署
智能合约是部署在区块链上的一种交易合同触
发机制，满足触发条件时，实现交易方案的自动执
行、资金的自动转移和现金的自动结算等功能。它
在没有第三方的情况下进行可信交易，交易可追踪
且不可逆转。为了自动执行点对点交易决策及安全
校核，将点对点交易执行过程编写成智能合约，并部
署在交易链和电能链耦合的区块链上。点对点交易
智能合约包括交易封装报价、优化决策、安全校核、
交易结算等 4个功能模块，具有无合同执行期、合同
谈判期、合同校核期、合同签订期、合同执行期、偏差
考核期等 6种状态，如图 4所示。
智能合约的触发机制可以设置为特定时间下的
规定执行动作，如提前一日的 12：00开始合同谈判
并确认交易方案，其内容包括产消者双方所处节点
（功率注入节点和功率流出节点）、交易功率、交易价
格、交易时间等；提前一日的 18：00，开始合同的安
全校核，确认每个交易的调整功率；提前一日的
22：00，根据合同谈判期确认的交易方案和合同校
核期确认的每笔交易功率调整方案，签订正式交易
合同；实际交易当日，按照签订的正式合同自动执
行，实现资金的自动结算和转移。
由于点对点交易的产消者包括具有间歇、波动
的分布式风光发电机组、随机变化的用电负荷，实际
功率值往往与所签订的合同功率存在偏差。为此，
交易后一日 24：00，智能合约会对产消者的偏差电
量进行考核。根据实际功率与合同功率 P̄ i 的偏差
功率 ΔP̄ i，计算偏差电费 Δπi，分成两部分计算，即
±αP̄ i 以内的偏差电费（α为偏差考核惩罚所设置的
合同电量百分数，如 3%）以及 ±αP̄ i 以外的偏差
电费。
2. 4 交易链和电能链节点信用值激励机制
交易链和电能链上的每个节点（包括参与市场
交易的产消者、交易中心和电网调度等第三方机构）
每完成一次电能交易或安全校核时，则需要进行一
次该节点信用值评价。信用值体现了产消者的交易
质量、第三方机构的校核质量及其可信任度，直接关
系到节点在区块链的交易或校核中被选择的优先程
�		�=�
		0@�
		�=�
��5��
0@A�	+
		����
A�	+		�
���7��=
��K��*F�
		*F+��E
=5��30
		A��
		���
���"5A�U
-@%�%����
*6J���7%
��F*24��
3�U-@ ��
��L+A��(
���
12:00
	��
24:00
����
����
���
22:00
���
18:00
图 4 智能合约的运作机理
Fig. 4 Operation mechanism of intelligent contract
23
2021，45（9） ·区块链技术在电力系统中的应用·
度。具有高信用值的节点更容易在交易中获得主动
权，且此类节点可获得一定金额的信用值激励。
节点信用值评价综合考虑交易链上的交易完成
度和电能链上的安全校核贡献度 2个指标。节点 i
的交易完成度为：
ηi= 1-
|| ΔP̄ i
P̄ i
（8）
安全校核贡献度定义为 ri，当节点 i成功完成一
次校核时，ri取 1；当未成功完成时，ri取 0。综上所
述，节点 i的信用值 Ri评价模型表述为：
Ri=
β
J ∑J ηi +
γ
K ∑K ri （9）
式中：J为节点总交易次数；K为节点参与安全校核
的次数；β和 γ为权重系数。
3 算例分析
通过将点对点交易决策过程编写成智能合约，
发布至以太坊区块链智能开发平台，搭建交易链和
电能链耦合运行的双链式区块链，模拟 IEEE 14节
点配电系统点对点交易决策过程，如图 5所示。以
13条支路的辐射状配电系统为基础［18］，仿真交易场
景包括 5个产消者以及大电网，均对应一个交易链
节点；电能链节点数设为 3，其中电网调度中心作为
电能链的校核权节点，其余 2个节点由产消者 2和
产消者 4担任。仿真测试的具体功能开发如附录 A
表A1所示。
节点 8、10、11、12、13分别接入额定功率为 250、
250、150、400、100 kW的光伏产消者。产消者向电
网公司售电的价格为 0.4元/（kW·h），向电网公司
购电的价格为 1.0元/（kW·h），市场规定和设备技
术约束限定的最大允许交易调整量 ΔPmax = 8 kW。
智能合约触发时间如图 4所示，偏差电量考核百分
数设置为 3%。
3. 1 双链式与单链式区块链的性能对比分析
基于以太坊仿真平台，分别部署双链式和单链
式架构的区块链，进行性能仿真测试，仿真平台代码
编译及功能开发界面如附录 A图 A1所示。仿真中
区块大小为 1 MB，每笔交易所占字节大小为 1 KB，
系统物理数据所占字节大小为 500 KB，区块创建时
间为 1 min。双链式和单链式区块链的性能对比结
果如表 1所示。
在双链式区块链中，交易数据与物理数据分链
部署，交易链每秒可处理交易数量为 13笔，而单链
式区块链每秒处理的交易数量为 6笔。同时，区块
确认时间包括节点间的通信和信息验证时间。单链
式区块链上的区块确认包括交易和校核调整信息的
确认过程，总确认时间为 29.64 s。双链式区块链中
交 易 信 息 的 确 认 在 交 易 链 中 进 行 ，确 认 时 间 为
14.45 s；校核调整信息的确认在电能链中进行，由于
电能链节点数较少，确认时间短，为 4.72 s。双链式
区块链总的确认时间短于单链式区块链。由此可
见，在点对点交易场景下，双链式区块链具有更高的
交易处理效率和性能。
3. 2 基于双链式区块链的点对点交易优化决策
结果
交易前一日 12：00开放市场，各产消者按自身
需求发布购售电信息，由智能合约的封装报价功能
保证产消者的购电报价信息只被售电的产消者知
晓，即通过公私钥加密后的报价信息在区块链网络
中广播。以太坊等主流区块链地址为 42位，这里采
用 简 化 后 的 8 位 地 址 描 述 ，如 产 消 者 1 地 址 为
0xx00x01，电网公司地址为 0xx00x00。产消者在
11：00时刻的初始报价信息如表 2所示。
表 3展示了 11：00时刻产消者之间确定的交易
方案（“ -”表示两者之间未发生交易）。交易前一日
��1
1
2
5
7 10
11 12 13
9 14
6 8
3 4
��2 ��3 � ��1 ��2 ��3 � ��1 ��2 ��3
��J
�"51 �"52 �"53
�"54
�*4
�"55
7%1 7%i 7%N
��JE�44
图 5 IEEE 14节点配电系统点对点交易仿真场景
Fig. 5 Simulation scenario of peer-to-peer transaction
in IEEE 14-bus distribution system
表 1 双链式和单链式区块链的性能对比
Table 1 Performance comparison between double-chain and single-chain blockchains
区块链
单链式
双链式交易链
双链式电能链
类型
公有链
公有链
联盟链
运行模式
单链运行
与电能链耦合运行
与交易链耦合运行
节点数/个
6
6
3
区块数据
交易+物理数据
交易数据
物理数据
区块大小/KB
1 024
1 024
1 024
每秒交易处理数
6
13
13
区块确认平均时间/s
29.64
14.45
4.72
24
杨洪明，等 双链式区块链架构设计及其点对点交易优化决策实现
http：//www.aeps-info.com
18：00，根据智能合约中的安全校核功能，电能链校
核权节点对当前交易方案实施安全校核，并对不满
足网络安全约束的交易方案进行调整。产消者 2因
自身光伏机组发电功率无法满足负荷需求，向其他
产消者或电网公司购入功率，从而导致配电系统节
点 10注入功率变大，造成线路 L3-L8、L8-L10发生
功率越限。
表 4给出 11：00时刻经电能链安全校核后的交
易调整功率情况。产消者 2共裁剪了 20.7 kW 功
率，按比例分配，与产消者 3的交易裁剪功率为
5.4 kW、与产消者 4的交易裁 剪 功率为 6.3 kW、与
大电网的交易裁剪功率为 9 kW。然而，产消者 2与
电网公司之间所需的交易裁剪功率无法满足机组技
术约束，安全校核无法通过，造成点对点交易失败。
此时，校核权节点给出产消者 2的点对点交易
范围：产消者 2购买的功率不得大于 94.3 kW。产消
者 2重新优化决策 x ∗ 后，达成新的功率交易方案。
同表 3相比较，不同之处在于向大电网和产消者购
买的功率由原来的 115 kW降低为 94.3 kW。重新
优化决策 x ∗后的新交易方案未造成各线路功率越
限，无须再对交易功率进行裁剪，点对点交易通过安
全校核。
3. 3 智能合约交易费用结算
交易前一日 22：00，基于交易链确认的交易方
案和电能链确认的功率调整方案，产消者签订正式
的交易合同，经所有产消者签名认证后，将其存储在
交易链部署的智能合约中。交易当日，智能合约自
动执行交易费用结算，并对产消者进行偏差考核，计
算偏差电费。表 5记录了 11：00时刻各产消者的交
易情况，包括交易双方地址、合同功率、合同价格、实
际功率、偏差功率、市场上/下调价格、合同电费、偏
差电费、结算金额（合同电费和偏差电费之和）等。
11：00时刻共发生了 5笔交易，涉及 6个市场参与主
体。其中，产消者 3、4和电网公司售出功率，产消者
1、2、5购入功率。
表 3 11:00时刻产消者交易功率
Table 3 Transaction power of prosumers at 11:00
参与者
产消者 1
产消者 2
产消者 3
产消者 4
产消者 5
大电网
交易功率/kW
产消者
1
-
-
-10
-
-
-
产消者
2
-
-
-30
-35
-
-50
产消者
3
10
30
-
-
55
-
产消者
4
-
35
-
-
-
-
产消者
5
-
-
-55
-
-
-
大电网
-
50
-
-
-
-
表 2 11:00时刻产消者初始报价
Table 2 Initial offers of prosumers at 11:00
产消者
1
2
3
4
5
产消者地址
0xx00x01
0xx00x02
0xx00x03
0xx00x04
0xx00x05
初始报价/(元·(kW·h)-1)
0.800 0
0.810 0
0.830 0
0.850 0
0.820 0
需求功率/kW
20
120
-100
-50
60
表 4 11:00时刻产消者的交易调整功率
Table 4 Transaction adjusted power of
prosumers at 11:00
参与者
产消者 1
产消者 2
产消者 3
产消者 4
产消者 5
大电网
交易功率/kW
产消者
1
-
-
0
-
-
-
产消者
2
-
-
5.4
6.3
-
9.0
产消者
3
0
5.4
-
-
0
-
产消者
4
-
6.3
-
-
-
-
产消者
5
-
-
0
-
-
-
大电网
-
9.0
-
-
-
-
表 5 智能合约交易记录
Table 5 Smart contract transaction record
产消者地址
0xx00x01
0xx00x02
0xx00x03
0xx00x04
0xx00x05
0xx00x00
交易方地址
0xx00x03
0xx00x03
0xx00x04
0xx00x00
0xx00x01
0xx00x02
0xx00x05
0xx00x02
0xx00x03
0xx00x02
合同功
率/kW
10.00
30.00
35.00
34.30
-10.00
-30.00
-55.00
-35.00
55.00
-34.30
合同价格/
(元·(kW·h)-1)
0.802 3
0.815 4
0.850 3
1.000 0
0.802 3
0.815 4
0.825 4
0.850 3
0.825 4
1.000 0
实际功
率/kW
9.70
96.00
-100.40
-33.80
57.00
-34.30
偏差功
率/kW
-0.30
1.70
-5.40
1.20
2.00
0
合同均价/
(元·(kW·h)-1)
0.802 3
0.906 3
0.820 1
0.850 3
0.825 4
1.000 0
上/下调价格/
(元·(kW·h)-1)
0.106 0
0.414 0
0.106 0
0.414 0
0.414 0
0
合同电费/
元
8.023 0
88.522 5
-77.891 0
-29.760 5
45.397 0
-34.300 0
偏差电
费/元
-0.240 7
1.540 7
-4.140 9
1.160 7
1.795 7
0
结算金额/
元
7.782 3
90.063 2
-82.031 9
-28.599 8
47.192 7
-34.300 0
25
2021，45（9） ·区块链技术在电力系统中的应用·
若产消者之间不进行点对点交易，而仅仅采用
传统购售电模式，以售电价格 0.4元/（kW·h）和购
入价格 1元/（kW·h）与电网公司进行实际功率的直
接结算。11：00时刻产消者 3、4的售电收入分别为
40.16、13.52元；产消者 1、2、5的购电费用分别为
9.7、96、57元。对比表 5的结算金额可知，传统购/
售电模式下出售功率的产消者收益降低，购入功率
的产消者支付升高。由此可见，产消者之间基于区
块链执行点对点交易有效促进了产消者参与市场交
易的积极性，提升了分布式风光发电的就地消纳
水平。
4 结语
基于区块链技术在分布式电力交易中的应用，
本文提出兼顾网络物理属性和交易经济属性的双链
式区块链架构及其点对点交易决策实现。基于以太
坊区块链智能开发平台，搭建 IEEE 14节点配电系
统点对点交易仿真场景。仿真结果表明，所设计的
双链式区块链比单链式具有更高的交易处理效率和
性能，所提方法实现了点对点交易决策、安全校核和
费用结算，从而有效促进产消者自主参与市场交易
的积极性，提升分布式可再生能源的就地消纳水平。
双链式区块链的实现是一个十分复杂的计算机
算法，耦合电能链和交易链的共识机制还有待进一
步完善。为了更有效地提高电能链的交易校核与调
整的去中心化程度，面向区块链技术的分布式校核
与调整方法也将是下一步研究的重点。
本文在纂写过程中得到湖南省和长沙市
科技项目 (2019WK2011)及泛在电力物联网
湖南省重点实验室（2019TP1016_2019GK50
15）资助，特此感谢！
附录见本刊网络版（http：//www.aeps-info.com/
aeps/ch/index.aspx），扫英文摘要后二维码可以阅读
网络全文。
参考文献
［1］MORSTYN T， MCCULLOCH T M. Multiclass energy
management for peer-to-peer energy trading driven by prosumer
preferences［J］. IEEE Transactions on Power Systems，2019，
34（5）：4005-4014.
［2］袁勇，王飞跃 .区块链技术发展现状与展望［J］.自动化学报，
2016，42（4）：481-494.
YUAN Yong，WANG Feiyue. Development status and prospect
of blockchain technology［J］. Acta Automatic Sincia，2016，42
（4）：481-494.
［3］MENGELKAMP E， GATTTNER J， ROCK K， et al.
Designing microgrid energy markets：a case study：the Brooklyn
microgrid［J］. Applied Energy，2018，210：870-880.
［4］国家电网公司 .区块链技术助力泛在电力物联网建设［EB/
OL］.（2019-12-04）［2019-12-12］. http：//www. sgcc. com. cn/
html/sgcc_mobile/col2019042502/2019-12/04201912041015045
43540587_1.shtml.
State Grid Corporation of China. Blockchain technology helps the
construction of ubiquitous electric power IoT［EB/OL］.（2019-
12-04） ［2019-12-12］. http：//www. sgcc. com. cn/html/
sgcc_mobile/col2019042502/2019-12/04/2019120410150454354
0587_1.shtml.
［5］南方电网公司 .南方电网公司积极探索区块链技术应用［EB/
OL］.（2019-10-28）［2019-12-12］. http：//www. csg. cn/xwzx/
nygc/201910/t20191029_305529.html.
China Southern Power Grid Corporation. China Southern Power
Grid Corporation actively explores blockchain technology
applications ［EB/OL］. （2019-10-28）［2019-12-12］. http：//
www.csg.cn/xwzx/nygc/201910/t20191029_305529.html.
［6］王胜寒，郭创新，冯斌，等 .区块链技术在电力系统中的应用：前
景与思路［J］.电力系统自动化，2020，44（11）：10-24.
WANG Shenghan， GUO Chuangxin， FENG Bin， et al.
Application of blockchain technology in power system：prospects
and ideas［J］. Automation of Electric Power Systems，2020，44
（11）：10-24.
［7］DONG Zhaoyang，LUO Fengji，LIANG Gaiqi. Blockchain：a
secure，decentralized， trusted cyber infrastructure solution for
future energy systems［J］. Journal of Modern Power Systems
and Clean Energy，2018，6（5）：958-967.
［8］ZIA M F， BENBOUZID M， ELBOUCHIKHI E， et al.
Microgrid transactive energy：review，architectures，distributed
ledger technologies， and market analysis［J］. IEEE Access，
2020，8：19410-19432.
［9］肖谦，陈政，朱宗耀，等 .适应分布式发电交易的分散式电力市
场探讨［J］.电力系统自动化，2020，44（1）：208-218.
XIAO Qian，CHEN Zheng，ZHU Zongyao，et al. Discussion on
decentralized electricity market for distributed generation
transactions［J］. Automation of Electric Power Systems，2020，
44（1）：208-218.
［10］SILVESTRE M L D，GALLO P，IPPOLITO M G，et al. A
technical approach to the energy blockchain in microgrids［J］.
IEEE Transactions on Industrial Informatics，2018，14（11）：
4792-4803.
［11］王蓓蓓，李雅超，赵盛楠，等 .基于区块链的分布式能源交易关
键技术［J］.电力系统自动化，2019，43（14）：53-64.
WANG Beibei，LI Yachao， ZHAO Shengnan， et al. Key
technologies on blockchain based distributed energy transaction
［J］. Automation of Electric Power Systems，2019，43（14）：
53-64.
［12］祁兵，夏琰，李彬，等 .基于区块链激励机制的光伏交易机制设
计［J］.电力系统自动化，2019，43（9）：132-139.
QI Bing， XIA Yan， LI Bin， et al. Photovoltaic trading
mechanism design using Blockchain-based incentive mechanism
［J］. Automation of Electric Power Systems，2019，43（9）：
132-139.
［13］韩冬，张程正浩，孙伟钦，等 .基于区块链技术的智能配售电交
26
杨洪明，等 双链式区块链架构设计及其点对点交易优化决策实现
http：//www.aeps-info.com
易平台架构设计［J］.电力系统自动化，2019，43（7）：89-99.
HAN Dong，ZHANG Chengzhenghao，SUN Weiqin，et al.
Framework design of smart distribution trading platform based
on blockchain technology［J］. Automation of Electric Power
Systems，2019，43（7）：89-99.
［14］LUO Fengji， DONG Zhaoyang， LIANG Gaoqi， et al. A
distributed electricity trading system in active distribution
networks based on multi-agent coalition and blockchain［J］.
IEEE Transactions on Power Systems，2019，34（5）：4097-
4108.
［15］邰雪，孙宏斌，郭庆来 .能源互联网中基于区块链的电力交易
和阻塞管理方法［J］.电网技术，2016，40（12）：3630-3638.
TAI Xue， SUN Hongbin， GUO Qinglai. Electricity
transactions and congestion management based on blockchain in
Energy Internet［J］. Power System Technology， 2016， 40
（12）：3630-3638.
［16］杨选忠，张浙波，赵申轶，等 .基于区块链的含安全约束的分布
式电力交易方法［J］.中国电力，2019，52（10）：31-39.
YANG Xuanzhong，ZHANG Zhebo，ZHAO Shenyi，et al.
Blockchain-based transactive method in distributed power
considering security constraints［J］. Electric Power，2019，52
（10）：31-39.
［17］张永平，焦连伟，倪以信，等 .区域电力市场双边交易阻塞管理
实用计算方法［J］.电力系统自动化，2003，27（14）：18-22.
ZHANG Yongping， JIAO Lianwei， NI Yixin， et al． A
practical approach for inter-regional bilateral contracts
congestion management［J］. Automation of Electric Power
Systems，2003，27（14）：18-22.
［18］苏隽，关睿，韩冰，等 .考虑电热耦合效应的配电网潮流计算
［J］.电力系统自动化，2015，39（19）：48-53.
SU Jun， GUAN Rui， HAN Bing， et al. Monitoring
architecture of microgrid and adaptive service method based on
DPWS［J］. Automation of Electric Power Systems，2015，39
（19）：48-53.
杨洪明(1972—)，女，通信作者，博士，教授，博士生导师，
主要研究方向：电力市场、新能源发电并网、电力系统运行与
控制。E-mail：yhm5218@163.com
阳泽峰(1998—)，男，硕士研究生，主要研究方向：电力市
场、电力系统运行与控制。E-mail：565917589@qq.com
漆 敏(1994—)，男，硕士研究生，主要研究方向：电力市
场、电力系统运行与控制。E-mail：1169719105@qq.com
（编辑 王梦岩）
Design of Double-chain Blockchain Architecture and Its Implementation of Peer-to-peer Transaction
Optimization Decision
YANG Hongming1，2，YANG Zefeng1，QI Min3，LUO Yiting1，ZHANG Shiming4
(1. School of Electrical Engineering and Information, Changsha University of Science and Technology, Changsha 410076, China;
2. International Joint Laboratory of Ministry of Education for Operation and Planning of Energy Internet based on Distributed
Photovoltaic-Storage Energy, Changsha University of Science and Technology, Changsha 410114, China;
3. Zigong Power Supply Company of State Grid Sichuan Electric Power Company Limited, Zigong 643000, China;
4. Economic and Technological Research Institute of State Grid Fujian Electric Power Company Limited, Fuzhou 350011, China)
Abstract: In the open electricity sales side market, the prosumers with the dual characteristics of electricity production and
consumption implement flexible peer-to-peer transactions. As single-chain blockchains cannot simultaneously satisfy the network
security check and decentralization of prosumer transactions, a double-chain blockchain for coupling operation of the transaction
chain and the power chain and its peer-to-peer transaction decision model are proposed. The peer-to-peer transactions of prosumers
are achieved based on their independent game through the trading chain (public chain) to maximize their respective economic
interests in the market. The security check and adjustment of the market transaction scheme are achieved through the power chain
(alliance chain) with the constraint of power flow. Based on the Ethereum blockchain development platform, the simulation
scenarios for peer-to-peer transactions with IEEE 14-bus distribution network are implemented. The simulation results show that
the designed double-chain blockchain has higher transaction processing efficiency and performance than single-chain blockchain,
which can achieve autonomous peer-to-peer transaction of prosumers and ensure the safe and automatic execution of the transaction
scheme.
This work is supported by National Natural Science Foundation of China (No. 71931003) and the Science and Technology
Projects of Hunan Province (No. 2019CT5001).
Key words: double-chain blockchain; peer-to-peer transaction; game decision; network constraint; coupling operation
27