标题
第 42 卷　 第 12 期
2021 年 12 月
电　 力　 建　 设
Electric Power Construction
Vol. 42　 No. 12
Dec. 2021
http: / / www. cepc. com. cn
基金项目:河北省重点研发计划项目(20310103D); 中央高校基本科研业务费专项资金资助(2020MS119)
基于博弈策略的能源区块链
安全交易机制
李刚1,2, 赵琳颖1, 关雪1, 鲁斌1，2，辛锐3,4, 程凯3,4
(1. 华北电力大学计算机系,河北省保定市 071003;
2. 复杂能源系统智能计算教育部工程研究中心,河北省保定市 071003;
3. 国网河北省电力有限公司信息通信分公司,石家庄市 050021;
4. 河北省电力物联网信息通信技术创新中心,石家庄市 050021)
摘　 要:能源区块链的先期探索给能源互联网的建设提供了良好的技术支撑,然而大规模参与主体的不断涌入,能源交
易的安全、公平、效率等问题再次迎来新的挑战,博弈论因考量了交易主体之间的策略互动及利益依存关系,有望为该
问题的解决提供新思路。 首先,以能源交易的利益最大化为目标函数,构建多能源交易策略的博弈模型,依据能源供需
量及报价,求解能源用户和能源商户策略博弈的纳什均衡值,为交易机制提供价格参考。 其次,结合能源互联网的特
性,构建基于联盟链的弱中心化多主体能源交易机制,并对能源区块结构及共识机制进行改进以实现高效可靠的交易
流程。 最后,在模拟场景下进行算例仿真,仿真结果表明所提出的安全交易机制在保障买卖双方利益的同时,加快了区
块的共识速度,为能源交易平台的建设提供帮助。
关键词: 能源互联网; 区块链; 博弈论; 安全交易机制; 共识机制
Security Transaction Mechanism of Energy Blockchain
Applying Game Strategy
LI Gang1,2, ZHAO Linying1, GUAN Xue1, LU Bin1,2, XIN Rui3,4, CHENG Kai3,4
(1. Department of Computer, North China Electric Power University, Baoding 071003, Hebei Province, China;
2. Engineering Research Center of Intelligent Computing for Complex Energy Systems,
Ministry of Education, Baoding 071003, Hebei Province, China; 3. State Grid Hebei Electric Power
Company Limited Information and Communication Branch, Shijiazhuang 050021, China;
4. Hebei Electric Power Internet of Things Information and Communication Technology
Innovation Center, Shijiazhuang 050021, China)
ABSTRACT: The early exploration of the energy blockchain has provided good technical support for the construction of the
energy internet. However, as the continuous influx of large-scale participants, the safety, fairness and efficiency of energy
transactions once again face new challenges. Game theory considers the advantages of strategic interaction and interest
dependence between transaction subjects, and is expected to provide new solutions. Firstly, the objective function of
maximizing the benefits of energy trading is to construct a multi-energy trading strategy game model. According to energy
supply and demand and quotation, the Nash equilibrium value of the strategy game between energy users and energy
providers is solved, which provides a price reference for the trading mechanism. Combining the characteristics of the energy
internet, this paper builds a weakly centralized multi-agent energy transaction mechanism based on the alliance chain, and
improves the energy block structure and consensus mechanism to achieve an efficient and reliable transaction process.
Simulation results show that the secure transaction mechanism not only protects the interests of buyers and sellers, but also
speeds up the consensus of the block, with a view to provide help for the construction of the energy trading platform.
This work is supported by Key R &D Program of Hebei Province (No. 20310103D) and Fundamental Reseavch Funds
for Central University (No. 2020MS119) .
KEYWORDS: energy internet; blockchain; game theory; secure transaction mechanism; consensus mechanism
中图分类号:TM 732; TK 01　 　 　 　 文献标志码: A　 　 　 　 　 文章编号: 1000 -7229(2021)12 -0127 -09
DOI: 10. 12204 / j. issn. 1000 -7229. 2021. 12. 014
电 力 建 设 第 42 卷
http: / / www. cepc. com. cn
0　 引　 言
新一代信息技术给能源互联网的发展带来了重大
契机,能源系统正在由封闭模式过渡转变到开放模式。
以能源电力科学和信息科学为基础的能源互联网,旨
在建立一种多种能源形式(节点)共同参与的共享互联
网络[1],进而达到信息流和能量流的双向流通与互动。
然而,当前参与主体的多样性、能源数据的安全性以及
交易信息的保密性等诸多实际问题制约着能源互联网
的发展,迫切需要找到新的解决途径[2]。
区块链(blockchain,BC)技术的分布式、不可篡
改、匿名性等特性与能源互联网的业务需求极为贴
合,为其安全问题提供了一种新的解决方案[3]。 目
前,区块链技术在金融[4]、物联网[5-6]、数据存储[7] 等
方面已有较多应用,现已逐渐扩展到能源交易领域。
例如,文献[8]提出了基于联盟链技术的电力交易方
法;文献[9]提出了基于双向拍卖定价机制的智能合
约算法;文献[10]提出了融合雷电网络与区块链生
态系统的电动汽车充电交易机制等。
由于能源互联网中存在多方参与主体,交易双方
的利益目标不同,仅从整体角度考量交易过程并不能
切实反映真实状态,因此可引入博弈理论对交易双方
的协商过程进行阐述,进而为交易市场提供合理的能
源供需策略参考。 文献[11]借助主从博弈优化了区
域综合能源系统的运行方案;文献[12]通过主多从
博弈模型探究了售电商与用户之间的策略互动行为;
文献[13] 针对微电网能源管理场景提出了基于
Stackelberg 的最优定价模型。 然而,上述研究依旧在
传统的中心化模式背景下进行探索,难以保证用户隐
私安全以及交易处理性能。
因此,本文结合能源互联网交易市场的应用特性
和安全需求,拟将博弈策略引入能源区块链的安全交
易机制中,保障交易双方的利益需求。 首先,运用博弈
理论求解买卖双方定价策略的唯一纳什均衡解,为交
易的撮合提供价格参考;然后,设计基于联盟链的弱中
心化多主体能源交易机制,通过对区块结构及实用拜
占庭容错(practical byzantine fault tolerance,PBFT)共
识机制的优化,提升能源交易效率;最后,依据算例分
析证明本文所提安全交易机制的可行性、有效性。
1　 能源区块链
能源互联网可分为能源网络层和信息管理层 2
个层面,其基本架构如图 1 所示。
能源网络层是由储能装置、天然气网、供热网、电
气化交通网、智慧电网和能源输送配置网等互联共
享、相互耦合形成的复杂网络体系[14];信息管理层包
图 1　 能源互联网基本架构
Fig. 1　 Basic architecture of an energy Internet
含信息互联网络、综合能源管控平台、能源市场交易
平台等。
通过能源网络层实现能量输配、信息传递等功
能,并将汇总信息通过能源输送配置网络传输至信息
管理层。 用户可通过信息互联网实时准确地获取能
源流动状况,利用综合信息管控平台实现源 网 荷
储的灵活协调,借助能源交易平台形成开放、平等、自
由的多元主体市场体系,发展高效、循环、绿色的新型
商业模式[15]。
由于区块链技术的去中心化、自治协同、多元化
市场、智能合约的特征极为贴合能源互联网的业务需
求,因此,区块链技术可与能源互联网形成天然互补
优势,极大降低第三方信任机制的保障成本,保障能
源互联网业务的高效性[16]。
本文从特征融合以及技术需求两方面阐述区块
链技术与能源互联网交叉融合的可行性。
1)特征融合:能源互联网与区块链技术同样具
备分布式、协同合作、公平共享、智能运行的优势。 能
源互联网中主要包括分布式能源服务商、用户侧节
点、微电网 3 部分,它们之间各自决策、公平合作、能
源共享、平等交易,并根据控制系统智能运行;区块链
技术各节点间分布运行,平等运用数据资源,根据智
能合约自动化运行,通过共识机制达成一致,因此,能
源互联网与区块链技术能够在特征上完美融合。
2)技术需求:能源互联网面临节点众多、交易数
据冗杂的难题,可以通过区块链 P2P 网络进行交易
信息传输以及存储,极大增加了数据安全性;分布
式能源节点之间存在的信任风险可以通过共识机
制和密码学原理来保证能源交易的一致性和隐私
性;能源服务商以及电力用户侧双方的信息可以通
过智能合约技术进行自动化匹配处理,有效提高交
易效率。
因此,区块链技术能够在能源互联网的应用场景
821
第 12 期 李刚,等:基于博弈策略的能源区块链安全交易机制
http: / / www. cepc. com. cn
中实现新的价值,能源互联网也可通过区块链实现更
优的交易性能,两者之间可以实现互补。
2　 能源交易主体策略博弈模型
2. 1　 博弈论基本概念
博弈论是现代经济学的基础理论组成部分[17],
其基础定义包含参与者、行动、信息、策略、支付、结果
和均衡。 其中,参与者、行动、结果合称“博弈规则”,
可以用来求解多方博弈主体的最优均衡解[18]。
纳什均衡是一种非合作的多方互利博弈,包括所
有参与者的最优策略组合[19]。 本文提出的多能源交
易策略的博弈模型标准定义如下:
{T,U,F t,{STi},{SUj
},WTi,WUj
}
s. t. Ti ∈ T,U j ∈ U
　 　 max(∑
n
i = 1
WTi + ∑
m
j = 1
WUj
)
　 　 F t > Fbuy
t > 0,∀t
　 　 ∑
n
i = 1
∑
m
j = 1
Δλ < 0
ì
î
í
ï
ï
ï
ï
ï
ï
ï
ï
ïï
(1)
式中: T 为能源用户集合; U 为能源商户集合; F t 为 t
时刻的能源存储量; STi
{ } 为能源用户策略集;
SUj
{ } 为能源商户策略集; WTi 能源用户利润; WUj
为
能源商户利润;Δλ 为能源交易平台中各参与节点的
安全约束;n 为用户数;m 为商户数;Fbuy
t 为 t 时刻能
源交易量。
2. 2　 交易策略模型构建
本文依托博弈理论,构建了一个多能源交易策略
的博弈模型,如图 2 所示。 本模型符合能源交易市场
中“先能源竞价后用能调整”的循环博弈规律,通过求
解贴合双方利益需求的最优策略,为交易机制提供合
理参考。 模型中包含如工业用户、产消者、分布式能
源、商业用户、居民用户等 n 个能源用户和如电网、天
然气网等 m 个能源商户,分别用集合 T = {T1,
T2,…,Tn} 和 U = {U1,U2,…,Um} 表示,其中 Ti 代
表各能源用户, U j 代表各能源商户。 将最大化能源
互联网平台的总利益作为目标函数,如式(2)所示。
maxWtotal = max(∑
n
i = 1
WTi + ∑
m
j = 1
WUj
) (2)
式中: Wtotal 为系统的总利益。
1)能源用户模型。
以能源用户的收益最大化为目标,需考量自身消
费需求、预期交易成本等因素。
依据能源用户 Ti对电能和天然气能的偏好系数
计算需求总和,如式(3)所示。
MTi = [αe
Tix
e
Ti -
βe
Ti
2 (xe
Ti)
2] + [αg
Tix
g
Ti -
βg
Ti
2 (xg
Ti)
2]
(3)
式中: αe
Ti 、 βe
Ti 和 αg
Ti、β
g
Ti代表用户 Ti 对电能、天然气
的需要值及满意级别,均为非负数;xe
Ti、x
g
Ti分别为能
源用户 Ti 消耗的电量和天然气量。
设能源商户 U j 提出的单位电价及单位天然气价
为 pe
Uj
及 pg
Uj
,则其成本函数如式(4)所示。
Call
Ti = Cbuy
Ti + Crun
Ti + Cenv
Ti
Cbuy
Ti = xe
Tip
e
Uj
+ xg
Tip
g
Uj
Crun
Ti = ∑
k
Vt,k + ψ Vt,es
ì
î
í
ï
ï
ï
ï
(4)
式中: Cbuy
Ti 为购能成本; Crun
Ti 为运行成本; Cenv
Ti 为环境
成本; Vt,k 为第 k 类设备的运行成本; ψ 为储能系统
的单位损耗成本; Vt,es 为储能系统的损耗值。
图 2　 能源交易主体策略博弈模型
Fig. 2　 Strategy game model between energy transaction entities
921
电 力 建 设 第 42 卷
http: / / www. cepc. com. cn
　 　 收益函数定义如式(5)所示。
WTi = MTi - Call
Ti =
[αe
Tix
e
Ti -
βe
Ti
2 (xe
Ti)
2] + [αg
Tix
g
Ti -
βg
Ti
2 (xg
Ti)
2] -
[(xe
Tip
e
Uj
+ xg
Tip
g
Uj
) + (∑Vt,k + ψ Vt,es )]
(5)
2)能源商户模型。
设能源商户 U j 输出的电量及天然气量分别是 oe
Uj
和 og
Uj
,计量函数如式(6)所示。
∑
m
j = 1
oe
Uj
= (1 + ηe)∑
n
i = 1
xe
Ti
∑
m
j = 1
og
Uj
= (1 + ηg)∑
n
i = 1
xg
Ti
ì
î
í
ï
ï
ï
ï
(6)
式中: ηe 和 ηg 表示电能、天然气传输途中的消耗参数。
因能源商户在其日常生产运行、器械购入维护等
方面的成本无法精准计量,因而,本文通过一个可微函
数对其进行描述。 能源商户 Uj 成本函数如式(7)
所示。
CUj
= φUj
(oe
Uj
+ og
Uj
) + δUj
+ Cbuy
Uj
(7)
式中: φUj
表示可变化成本的系数; δUj
表示固定成本的
系数; Cbuy
Uj
为能源商户从电网、天然气网的购能支出。
能源商户 U j 的售能效用函数如式(8)所示:
MUj
= oe
Uj
pe
Uj
+ og
Uj
pg
Uj
(8)
能源商户 U j 的收益函数如式(9)所示:
WUj
= MUj
- CUj
=
oe
Uj
pe
Uj
+ og
Uj
pg
Uj
-
[φUj
(oe
Uj
+ og
Uj
) + δUj
+ Cbuy
Uj
] (9)
2. 3　 模型求解
以博弈理论为基础,结合能源互联网交易场景,
本文所构建的博弈模型中的必要元素如下。
参与者:所有能源用户 Ti ∈ T 和所有的能源商
户 U j ∈ U ,均具有个体理性。
策略:能源用户参考单位电价及单位天然气价,弹
性修改其购电量 xe
Ti 和天然气量 xg
Ti ,能源商户参考能
源用户能源需求调整电能报价 pe
Uj
和天然气报价 pg
Uj
。
支付:收益函数如式(5)、(9)所示,能源商户与
能源用户之间通过策略博弈实现双方最优均衡。
能源用户 Ti 的最优策略应满足:
max
xe
Ti
,xg
Ti
WTi (10)
s. t.
xe
Ti ∈ [xe,min
Ti ,xe,max
Ti ]
xg
Ti ∈ [xg,min
Ti ,xg,max
Ti ]{ ∀Ti ∈ T (11)
式中:xe,min
Ti 、xe,max
Ti 和 xg,min
Ti 、xg,max
Ti 分别为用户 Ti 消耗的
电能和天然气最小值和最大值。 式(11)为能源用户
的策略空间 STi ,包含用电量 xe
Ti 和天然气量 xg
Ti 。
能源商户 U j 的最优策略应满足:
max
pe
Uj
,pg
Uj
WUj
(12)
s. t.
pe
Uj
≥0
pg
Uj
≥0
∑
m
j = 1
oe
Uj
= (1 + ηe)∑
n
i = 1
xe
Ti
∑
m
j = 1
og
Uj
= (1 + ηg)∑
n
i = 1
xg
Ti
ì
î
í
ï
ï
ï
ïï
ï
ï
ï
ï
(13)
求能源用户收益函数关于 xe
Ti 和 xg
Ti 的一阶偏导
数,得:
∂WTi
∂xe
Ti
= αe
Ti - βe
Tix
e
Ti - pe
Uj
∂WTi
∂xg
Ti
= αg
Ti - βg
Tix
g
Ti - pg
Uj
ì
î
í
ï
ïï
ï
ïï
(14)
当式(14)值为 0 时,即为最优均衡解。 求解可得:
xe
Ti =
αe
Ti - pe
Uj
βe
Ti
xg
Ti =
αg
Ti - pg
Uj
βg
Ti
ì
î
í
ï
ïï
ï
ïï
(15)
根据用电量 xe
Ti ≥0 和用天然气量 xg
Ti ≥ 0 的性
质,能得到单位电价及单位气价应符合:
0 ≤ pe
Uj
≤ min(αe
Ti)
0 ≤ pg
Uj
≤ min(αg
Ti)
{ (16)
式(16)为能源商户策略空间 SUj
,包含单位电价
pe
Uj
和单位天然气价 pg
Uj
。
根据纳什均衡定义,若全部参与主体均满足利益
函数最大化,则不需再进行策略博弈,组合全部参与主
体策略,得到该问题的纳什均衡解。 设 X 为所有能源
用户的策略集合, P 是所有能源商户的策略集合,则
(X∗,P∗) 为纳什均衡的充分必要条件如式(17)所示。
WTi(X
∗
Ti ,P
∗) ≥ WTi(XTi,X
∗
-Ti,P
∗)
WUj
(X∗,P∗
Uj
) ≥ WUj
(X∗,PUj
,P∗
-Uj
)
∀XTi ∈ STi,∀PUj
∈ SUj
,∀Ti ∈ T,∀U j ∈ U
ì
î
í
ï
ï
ïï
(17)
式中: XTi 为能源用户 Ti 的策略集合;X∗
Ti 为在给定其
他用户选择的情况下第 Ti 个参与者的最优策略;X∗
-Ti
为除 Ti 以外其他能源用户的最优策略;PUj
为能源商
户 U j 的策略集合;P∗
Uj
为在给定其他能源商户的情况
031
第 12 期 李刚,等:基于博弈策略的能源区块链安全交易机制
http: / / www. cepc. com. cn
下第 U j 个商户的最优策略;P∗
-Uj
为除 U j 以外其他商
户的最优策略。 能源商户的策略空间对于利益函数
具有约束性,因此,需要转换成无约束问题,可借助拉
格朗日(Lagrange)方程求解。
对式(12)在满足式(13)约束条件下,构造的拉
格朗日方程如式(18)所示。
LUj
= oe
Uj
pe
Uj
+ og
Uj
pg
Uj
- [φUj
(oe
Uj
+ og
Uj
) +
δUj
+ Cbuy
Uj
] + μe
Uj
[∑
m
j = 1
oe
Uj
- (1 + ηe) ×
∑
n
i = 1
xe
Ti] + μg
Uj
[∑
m
j = 1
og
Uj
- (1 + ηg)∑
n
i = 1
xg
Ti] (18)
式中: μe
Uj
、 μg
Uj
为电能、天然气的拉格朗日乘子,令其
为非负数。
式(18)的互补松弛条件如式(19)所示。
μe
Uj
[∑
m
j = 1
oe
Uj
- (1 + ηe)∑
n
i = 1
xe
Ti] = 0
∑
m
j = 1
oe
Uj
- (1 + ηe)∑
n
i = 1
xe
Ti = 0
μg
Uj
[∑
m
j = 1
og
Uj
- (1 + ηg)∑
n
i = 1
xg
Ti] = 0
∑
m
j = 1
og
Uj
- (1 + ηg)∑
n
i = 1
xg
Ti = 0
ì
î
í
ï
ï
ï
ï
ïï
ï
ï
ï
ï
ï
(19)
综上,可将目标函数式(2)转换为:
max{[αe
Tix
e
Ti -
βe
Ti
2 (xe
Ti)
2] + [αg
Tix
g
Ti -
βg
Ti
2 (xg
Ti)
2] -
[(xe
Tip
e
Uj
+ xg
Tip
g
Uj
) + (∑
k
Vt,k + ψ | Vt,es | )] +
oe
Uj
pe
Uj
+ og
Uj
pg
Uj
- [φ(oe
Uj
+ og
Uj
) + δUj
+
Cbuy
Uj
(PUj
)] + μe
Uj
[∑
m
j = 1
Oe
Uj
- (1 + ηe)∑
n
i = 1
xe
Ti] +
μg
Uj
[∑
m
j = 1
og
Uj
- (1 + ηg)∑
n
i = 1
xg
Ti]} (20)
在本文所构建的交易博弈模型中,能源用户根据
价格策略合理分配使用能源,能源公司通过用能策略
制定电价,求唯一纳什均衡解,实现最大利益目标函
数式(2)。
3　 基于能源区块链的安全交易机制
3. 1　 基于联盟链的弱中心化多主体能源交易
机制
　 　 电力系统与国民经济和信息安全息息相关,因此
不宜实现交易数据完全公开透明,确保督查机构具有
足够的权限便可[20]。 而私有链无法适应能源互联网
体系结构的万物互联,因此,本文基于联盟链提出了
具备弱中心化管理机构的能源交易机制,如图 3 所示,
图 4 为适应本文所提交易机制的区块结构。
图 3　 弱中心化多主体能源交易机制
Fig. 3　 Weakly centralized multi-agent energy
trading mechanism
能源用户和能源商户向能源交易平台发送加入
申请,弱中心化管理机构对其进行身份验证和用户注
册,形成交易资源池 F = {FT1,FT2,…,FTn}。 管理机
构对交易双方的服务请求进行安全及交易量等物理
约束审核,如式(1),对接收到的买卖意向进行调节
反馈;将满足约束条件的交易申请发送至能源交易区
块链中,并对买卖双方进行身份核对;能源用户按照
降序排列,能源商户按照升序排列,依据价格优先、时
间优先原则自主触发智能合约完成交易;把生成的交
易数据封装入区块,通过共识机制实现全网广播,并
同步更新资源讯息。 其中,弱中心化管理机构仅负责
买卖意向收集、交易监管协调等辅助功能,并不直接
干涉用户与商户之间的交易协定,在保障能源互联网
安全的同时实现交易的去中心化。
为更好提升上述基于联盟链的弱中心化多主体
能源交易机制的性能,本文设计了一种适用于能源互
联网的共识机制及智能合约算法。
3. 2　 PBFT 算法改进
共识机制的选择是能源区块链安全中极为重要的
一环,它可以大大提高能源交易的共识效率和稳定性,
从而提高整个框架的可靠性。 本文从节点管理、拜占
庭容错、中心化、性能、恶意节点、拓展性等方面[21-23]对
131
电 力 建 设 第 42 卷
http: / / www. cepc. com. cn
图 4　 能源区块链结构
Fig. 4　 Energy blockchain structure
常见的 Raft、工作量证明(proof of work, PoW)、权益
证明(proof of stake, PoS)、委托股权证明(delegated
proof of stake, DPoS)等共识算法进行比较,如表 1
所示。
表 1　 共识算法比较
Table 1　 Comparison of consensus algorithms
由表 1 可以看出,PBFT 具备节点管理权限、共
识效率高、安全系数高、性能优越,更加符合能源互联
网对于数据安全方面的实际应用要求。
常规的 PBFT 对于网络传输速度与稳定性有较高
要求,且采用 C / S 架构不符合区块链 P2P 架构特点。
本文基于联盟链节点大多可信这一特点,对 PBFT 算
法进行改进,主节点无需接收客户端服务请求后再广
播给其他节点,而是客户端直接进行广播,从而减少网
络通信代价。 通过循环方式进行主节点选取,保障区
块链数据一致性的同时,又能提升共识效率。
能源区块链接收到交易信息后将其打包入区块
并向全网进行广播。 假设共有 M 个节点,在完成每
一轮共识后,通过式 (21 ) 从中选取一个主节点
Nmaster 。 在区块生成 t 时间后客户端对全部共识节点
广播 pre-prepare 消息,共识节点进行消息验证并将验
证信息返回主节点 Nmaster 。
Nmaster = Lmod M( ) + 1 (21)
式中: L 为区块链长度; Lmod M 表示 L 对 M 取余。
Nmaster 收到来自超过 2f + 1 个不同共识节点的验
证消息后向全网广播 commit 消息,其中 f 表示区块
链中允许出错的最多节点数,满足 f < M / 3 的限制。
同步节点验收消息通过后向其他节点进行广播,客户
端收到超过 f + 1 数量的同步节点的验证消息后,双
方协商结束,数据上链。
智能合约根据节点交易数据进行交易匹配,匹配
成功后交给验证节点验证,确认能源流与信息流双向
流通。
验证成功后的数据上链永久存储在区块链网络
中,实现交易信息的可追溯,否则该区块将被丢弃并
重新开始共识过程。
3. 3　 智能合约
智能合约是一种多方用户通过计算机语句制定
交易协议,并实现与真实世界价值流通的合同形式。
考虑到能源互联网交易中的实际物理约束,本文设计
的智能合约在上述多能源交易策略博弈的基础上,采
用基于连续双边拍卖机制的交易算法。
假设有 n 个能源用户、 m 个能源商户节点,双方
可以在区块链网络中随时发送购能或售能消息,其中
包括预期的报价 pe
t 、pg
t 和预期用量 xe
t 、 xg
t 。
将能源用户的报价按由大至小的降序形成集合
pTi = {pTi,1,pTi,2,…,pTi,n} ,能源商户的报价按由小至
大的升序形成集合 pUj
= {pUj,1
,pUj,2
,…,pUj,m
} 。 双方
参考博弈出的最优策略,按照价格优先、时间优先的
准则,得到交易流程 p = {m,n,pU,pT,最优策略} 。
会出现以下几种情况:
1)当 pTi,1 < pUj,1
时,表示当前所有买方报价全部
低于所有卖方售价,拍卖无法执行,继续等待新的报
价出现;
231
第 12 期 李刚,等:基于博弈策略的能源区块链安全交易机制
http: / / www. cepc. com. cn
2)当 pTi,n ≥ pUj,m
时,表示当前所有买方报价高于
所有卖方售价,拍卖集合可以执行完全,直到任意一
方集合为空;
3)当 pUj,m
≥ pTi,1 ≥ pUj,1
≥ pTi,n 时,表示买方报价
与卖方售价集合有部分重合,设重合元素为 pTi,r ,则
1 ≤ r≤ n ,拍卖集合可以执行部分,直到 pT 集合移到
r 处,停止匹配,等待新的报价出现。
因此,为保障交易的有效进行,双方报价应符合
pTi,n > pUj,1
且 pUj,m
< pTi,1 的条件约束。
将该算法部署在本文交易机制中的能源区块
链上,为交易平台中的多方参与主体之间达成的协
议自动生成智能合约,在保障平台运行生态化的条
件下实现公平有效的利益分配,提升能源交易的运
行效率。
4　 算例分析
本文通过 10 个能源用户、10 个能源商户共 20
个参与节点对所提出的交易机制进行模拟验证。 其
中损耗参数 ηe 为 0. 04、 ηg 为 0. 06,能源商户可变成
本系数 φUj
为 18. 5 元,固定成本系数 δUj
为 10 元。 本
模型不考虑能源商户间的价格竞争,只考虑交易双方
之间的博弈过程,因此所有能源商户的初始值相同。
为验证数值的可靠性和唯一性,分别在初始条件
pe
0 = 0. 023 元 / (kW·h)、pg
0 = 0. 017 元 / (kW·h) 以
及 pe
0 = 1. 134 元 / (kW·h) 、 pg
0 = 1. 081元 / (kW·h)
的情况下进行迭代,结果如图 5 所示,说明迭代结果
与初始选值无关,可证最优解唯一性,能为能源交易
提供可靠参考。
图 5　 能源交易参考价格
Fig. 5　 Reference price of energy trading
设定两条独立的交易链分别对电、气两种能源交
易场景进行处理,其交易机制相同,因此本文仅对电
能交易进行分析。 能源交易主体根据自身状态和能
源交易参考价格进行报价,其交易信息如表 2 所示,
左侧为能源用户交易信息,右侧为能源商户交易
信息。
表 2　 能源交易主体交易信息
Table 2　 Transaction information of energy
transaction entities
参考电能的交易博弈策略,遵循时间优先及价格
优先原则,在市场条件处于供大于求的情况下,本次
实验共产生了 10 个能源交易,交易结果如图 6 所示。
图 6　 能源交易结果
Fig. 6　 Energy trading results
对比各能源用户的预期成本及实际交易成本,如
图 7 所示,图中上方柱形为通过本文所提交易机制进
行交易后能源用户的总交易成本,下方柱形为能源用
户的总预期成本,依据上下两柱形的差额部分可以较
明显看出各能源用户都不同程度节省了成本,基本证
明了交易机制的可靠性。
图 7　 能源用户交易成本对比
Fig. 7　 Comparison of transaction costs of energy users
331
电 力 建 设 第 42 卷
http: / / www. cepc. com. cn
PBFT 算法的容错能力为 1 / 3 节点,结合算例设
计,实验中的错误节点最多不超过 3 个。 因此本文通
过 JAVA 编程对常规 PBFT 及本文设计的改进 PBFT
进行 1 ~ 3 个失效节点、1 ~ 3 个恶意节点条件下的共
识完成时间测试,测试结果如图 8 所示。
图 8　 共识时间对比
Fig. 8　 Consensus time comparison
从图 8 的分析结果来看,改进 PBFT 算法由于优
化了 P2P 网络,减少了网络传播开销,在节点失效和
恶意节点两种条件下与原始 PBFT 算法相比,时间间
隔缩短了约 50% ,共识速度更快。
5　 结　 论
本文以我国能源互联网建设为背景,从能源商户
和能源用户之间存在的策略互动及利益依存行为出
发进行了分析研究。 构建了一种考虑能源储存量及
安全约束的能源交易主体策略博弈模型,求解能源交
易利益最大化的唯一纳什均衡解,为能源交易提供价
格参考;然后结合区块链技术在能源交易中的优势,
构建了基于联盟链的弱中心化多主体能源交易机制,
保障交易的安全性,通过对区块结构及 PBFT 共识机
制的改进,提高了交易效率;最后通过 20 个参与节点
的算例分析证明了本文所提交易机制的可用性。
本文工作表明,基于区块链的能源交易机制通过
博弈策略的优化,能够为解决当前多能源交易市场中
存在的利益分配不均、信息不对称、交易过程不够公
平可信等问题提供参考;提出的改进 PBFT 算法能够
有效提升区块链的共识速度。
后续将进一步分析综合能源系统中各能源耦合
下的交易形态,助推“新基建”背景下能源区块链的
建设发展。
6　 参考文献
[1] 田世明, 栾文鹏, 张东霞, 等. 能源互联网技术形态与关键技术
[J] . 中国电机工程学报,2015, 35(14):3482-3494.
TIAN Shiming, LUAN Wenpeng, ZHANG Dongxia, et al. Energy
Internet technology form and key technologies[ J] . Proceedings of
the Chinese Society of Electrical Engineering, 2015, 35(14): 3482-
3494.
[2] 颜拥, 赵俊华, 文福拴, 等. 能源系统中的区块链:概念、应用与
展望[J] . 电力建设, 2017, 38(2): 12-20.
YAN Yong, ZHAO Junhua, WEN Fushuan, et al. Blockchain in
energy system: Concept, application and outlook [ J ] . Electric
Power Construction, 2017, 38(2): 12-20.
[3] 周国良, 李刚, 吕凛杰, 等. 区块链背景下能源互联网信息基础
架构研究与事件[M] . 北京:清华大学出版社, 2020:10-23.
[4] IMANUVILOV O Y, YAMAMOTO M. Energy internet towards
smart grid 2. 0 [ C ] / / 2013 Fourth International Conference on
Networking and Distributed Computing. Los Angeles:IEEE,2013:
105-110.
[5] 查煜坤, 智慧, 房小彤. 基于区块链的物联网智能终端协作计算
方案[J] . 北京邮电大学学报, 2021, 44(2): 89-94.
ZHA Yukun, ZHI Hui, FANG Xiaotong. A blockchain-based IoT
smart terminal collaborative computing scheme [ J ] . Journal of
Beijing University of Posts and Telecommunications, 2021, 44(2):
89-94.
[6] MEMON R A, LI Jianping, AHMED J, et al. Cloud-based vs.
blockchain-based IoT: A comparative survey and way forward[ J] .
Frontiers of Information Technology & Electronic Engineering,
2020, 21(4): 563-587.
[7] 王千阁, 何蒲, 聂铁铮, 等. 区块链系统的数据存储与查询技术
综述[J] . 计算机科学, 2018, 45(12): 12-18.
WANG Qiange, HE Pu, NIE Tiezheng, et al. Overview of data
storage and query technology in blockchain systems [ J] . Computer
Science, 2018, 45(12): 12-18.
[8] 黄虹, 文康珍,刘璇,等. 泛在电力物联网背景下基于联盟区块链
的电力交易方法[J] . 电力系统保护与控制,2020,48(3):22-28.
HUANG Hong, WEN Kangzhen, LIU Xuan, et al. Power trading
method based on consortium blockchain under ubiquitous power
internet of things[J] . Power System Protection and Control,2020,48
(3):22-28.
[9] 马腾, 刘洋, 许立雄, 等. 基于区块链的配电侧多微电网电能去
中心化交易模型[J] . 电网技术, 2021, 45(6): 2237-2247.
MA Teng, LIU Yang, XU Lixiong, et al. Blockchain-based
decentralized transaction model of multi-microgrid power on the
distribution side[J] . Power Grid Technology, 2021, 45(6): 2237-
2247.
[10] 李刚, 黄奕敏, 郑顾平, 等. 雷电网络在电动汽车充电交易中的
技术前景[J] . 电力建设, 2018, 39(9): 78-86.
LI Gang, HUANG Yimin, ZHENG Guping, et al. Technical
prospects of raiden network in electric vehicle charging transaction
[J] . Electric Power Construction, 2018, 39(9): 78-86.
[11] 顾洁, 白凯峰, 时亚军. 基于多主体主从博弈优化交互机制的区
域综合能源系统优化运行 [ J] . 电网技术, 2019, 43 ( 9 ):
3119-3134.
GU Jie, BAI Kaifeng, SHI Yajun. Optimal operation of regional
integrated energy system based on multi-agent master-slave game
optimization interaction mechanism [ J ] . Power System
Technology, 2019, 43(9): 3119-3134.
[12] 代业明, 高红伟, 高岩, 等. 具有电力需求预测更新的智能电网
431
第 12 期 李刚,等:基于博弈策略的能源区块链安全交易机制
http: / / www. cepc. com. cn
实时定价机制[J] . 电力系统自动化, 2018, 42(12): 58-63.
DAI Yeming, GAO Hongwei, GAO Yan, et al. Smart grid real-
time pricing mechanism with power demand forecast update [ J] .
Automation of Electric Power Systems, 2018, 42(12): 58-63.
[13] LIU Nian, YU Xinghuo, WANG Cheng, et al. Energy sharing
management for microgrids with PV prosumers: A Stackelberg
game approach[ J] . IEEE Transactions on Industrial Informatics,
2017, 13(3): 1088-1098.
[14] 杨方, 白翠粉, 张义斌. 能源互联网的价值与实现架构研究
[J] . 中国电机工程学报, 2015, 35(14): 3495-3502.
YANG Fang, BAI Cuifen, ZHANG Yibin. Research on the value
and implementation framework of the energy Internet [ J ] .
Proceedings of the CSEE, 2015, 35(14): 3495-3502.
[15] 杨东伟, 樊涛, 朱辉, 等. 区块链在能源互联中的应用探索
[M] . 北京: 科学出版社, 2018: 5-9.
[16] 张宁, 王毅, 康重庆, 等. 能源互联网中的区块链技术:研究框
架与典型应用初探[ J] . 中国电机工程学报, 2016, 36 (15):
4011-4023.
ZHANG Ning, WANG Yi, KANG Chongqing, et al. Blockchain
technology in the energy Internet: Research framework and a
preliminary study of typical applications [ J] . Proceedings of the
CSEE, 2016, 36(15): 4011-4023.
[17] 张维迎. 博弈论与信息经济学[M] . 上海:上海人民出版社,
2012: 20-45.
[18] 刁勤华,林济铿, 倪以信, 等. 博弈论及其在电力市场中的应用
[J] . 电力系统自动化, 2001,25(1): 19-23.
DIAO Qinhua, LIN Jikeng, NI Yixin, et al. Game theory and its
application in power market [ J] . Automation of Electric Power
Systems, 2001,25(1): 19-23.
[19] 卢强, 陈来军, 梅生伟. 博弈论在电力系统中典型应用及若干展
望[J] . 中国电机工程学报, 2014, 34(29): 5009-5017.
LU Qiang, CHEN Laijun, MEI Shengwei. Typical applications and
prospects of game theory in power systems[ J] . Proceedings of the
CSEE, 2014, 34(29): 5009-5017.
[20] 窦晓波, 曹水晶, 刘之涵, 等. 弱中心化的配电网市场交易机制、
模型与技术实现 [ J] . 电力系统自 动 化, 2019, 43 ( 12 ):
104-112.
DOU Xiaobo, CAO Crystal, LIU Zhihan, et al. Weakly
centralized distribution network market transaction mechanism,
model and technology realization[J] . Automation of Electric Power
Systems, 2019, 43(12): 104-112.
[21] MARKO V. The quest for scalable blockchain fabric: Proof-of-
work vs. BFT replication [ C] / / Inte-rnational workshop on open
problems in network security. Springer, Cham, 2015: 112-125.
[22] GRAMOLI V. From blockchain consensus back to Byzantine
consensus[ J] . Future Generation Computer Systems, 2020, 107:
760-769. .
[23] ZHENG Z, XIE S, DAI H, et al. An overview of blockchain
technology: Architecture, consensus, and future Trends [ C ] / /
2017 IEEE International Congress on Big Data ( BigData
Congress) . Honolulu:IEEE,2017: 557-564.
收稿日期:2021-08-12
作者简介:
李刚(1980),男,博士,副教授,硕士研究生导师,通信作者,主要
研究方向为智能电网与大数据、信息物理能源系统、故障预测与健康
管理,E-mail:ququ_er2003@ 126. com;
赵琳颖(1997),女,硕士研究生,主要研究方向为智能电网与大数
据、能源区块链,E-mail:hello_z11@ 163. com;
关雪(1997),女,硕士研究生,主要研究方向为智能电网与大数
据、能源区块链,E-mail:guanxueguanxue@163. com;
鲁斌(1975),男,教授,博士生导师,主要研究方向为人工智能、电
力大数据分析,E-mail:lubin@ ncepu. edu. cn;
辛锐(1983),男,硕士,教授级高级工程师,主要研究方向为电力
信息技术;
程凯(1990),男,硕士,工程师,主要研究方向为信息安全技术,
E-mail:smileck@126. com。
(编辑　 张小飞)
531