Blockchain Enabled Distributed Demand Side Management in Community Energy System With Smart Homes
Received January 28, 2020, accepted February 12, 2020, date of publication February 20, 2020, date of current version March 2, 2020.
Digital Object Identifier 10.1109/ACCESS.2020.2975233
Blockchain Enabled Distributed Demand Side
Management in Community Energy System
With Smart Homes
MUHAMMAD AFZAL 1, (Member, IEEE), QI HUANG 1, (Senior Member, IEEE),
WAQAS AMIN1, KHALID UMER1, ASIF RAZA1, AND MUHAMMAD NAEEM 2
1Sichuan Provincial Key Lab of Power System Wide-Area Measurement and Control, School of Mechanical and Electrical Engineering,
University of Electronic Science and Technology of China, Chengdu 611731, China
2Department of Electrical and Computer Engineering, COMSATS University Islamabad at Wah Campus, Wah Cantt 47040, Pakistan
Corresponding author: Qi Huang (hwong@uestc.edu.cn)
This work was supported by the Sichuan Youth Science and Technology Innovation Team Fund under Grant 2017TD0009.
ABSTRACT Existing work in energy demand side management focuses on the interaction between the
utility grid and consumers. However, the previous technique is not focused on energy trading in local
community of a renewable energy generation, distributed demand side management and not suitable for
real-time environment. This paper presents a distributed demand side management system among multiple
homes in community microgrid, with the integration of the internet of things smart meter and in the presence
of renewable energy sources. The proposed energy consumption game is formulated for minimizing the cost
of electricity in the individual home and the total cost of energy consumption in the whole community.
The smart home users are playing game by optimizing their own daily energy consumption of appliances.
The multiple participants include the self renewable generation of users, shared community microgrid and
optional utility company. Each participant applies its best strategy to minimize energy consumption cost and
users can maintain their own privacy of energy consumption. Moreover, the proposed scheme is distributed
on blockchain, which provides a trusted communication medium between the participants. It enforces the
autonomous monitoring of smart appliances and the billing of electricity consumption via smart contracts.
Solidity smart contract is deployed to facilitate the execution of transactions without the involvement of
third party in the smart community. Comparison of the results show that the proposed approach minimizes
the total cost of energy consumption as well as each user’s energy consumption cost.
INDEX TERMS Distributed demand side management, community microgrid, appliances scheduling, smart
home, Internet of Things, blockchain, smart contracts.
I. INTRODUCTION
The energy demand is increased steadily over the coming
years. This energy demand driven from humans, industries,
agriculture and electric vehicles is expected the growth will
be increased in the order of 40% by the year 2030. This
demand relies on increased energy to strengthen the human
lifestyle, the emergence of electric vehicles as the primary
means of transportation and machines will facilitate the
process of automation. In the conventional power system,
electricity is generated from fossil fuels [1] and accelerates
global warming (environmental issue [2]). This conventional
The associate editor coordinating the review of this manuscript and
approving it for publication was Shuaihu Li .
system has reduced flexibility and will hardly adapt to
demand growth.
The problem solved to bring the energy generation close
to the home by sustainable renewable energy resources
(RES) [3]. An increased proportion of the renewable energy
system will mitigate the environmental problem and change
the consumer oriented market to the prosumer oriented
market. Microgrid serves one user with its generation and
demand. The emerging community microgrid provides the
energy to multiple users [4]. Also, generate green energy in
community microgrid with solar, wind with energy storage
devices. When the demand is not fulfilled in a local gen-
eration, then bought the energy from the utility grid. This
is worked with the grid-connected and stand-alone system.
37428 This work is licensed under a Creative Commons Attribution 4.0 License. For more information, see http://creativecommons.org/licenses/by/4.0/ VOLUME 8, 2020
https://orcid.org/0000-0002-6635-2426
https://orcid.org/0000-0002-8637-0269
https://orcid.org/0000-0001-9734-4608
https://orcid.org/0000-0002-4411-2632
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
In community microgrid, this provides the electricity in
time of power outages, strengthen the central grid to func-
tion better, enhance community economics by reducing the
electricity rates and improve the environment by renewable
energy mix [5].
In the past, most of the work done on the electricity genera-
tion side and consumer loads are notmanageable. The flat rate
pricing will not motivate consumers to schedule the appli-
ances and electricity usage for cost minimization. The flow
of electricity and dataflow (information) are in bidirectional
in smart grid (SG). The dataflow between homes and utility
grid have manage with optimization at each consumer and
improve the entire system via peak reduction [6]. Actually,
it is impractical to ask consumer to optimize the schedule of
appliances neither they are system operator nor economist.
For this reason, need a fully automated load management
system is required for consumers to take the benefits with
scheduling the smart appliances. The energy management
system is essential part of the SG that consumers use to
manage electricity. The technical and economic constraints
consider for best schedule of smart appliances. Community
microgrid provide an opportunity for small scale distributed
RES to trade energy locally. The realization of microgrid
markets necessitate safe and smart information system for
their appropriate operation [7].
Now industry 4.01 automate thewhole systemwith integra-
tion of internet of things (IoTs,) blockchain, machine learn-
ing and data management with cyber physical system [8].
The complete power system is fully automated, secure and
smart. Recently, IoTs scope is expanded with the variety
of applications such as power system, smart home, health
care, smart shopping and smart agriculture etc. The different
types of IoTs devices provide the different services related
to sensing, measurement, monitoring and controlling tasks.
The IoTs are generating a lot of data on the Internet. For
this, users need the distributed, lightweight, scalable solutions
to secure from cyber attacks, security, privacy, reliable and
cheap system [9]. Blockchain technology is used for secure
communication to handle the data in distributed and secure
way. Blockchain technology is used to implement various
policies to protect consumer privacy and limit unauthorized
operations in a decentralized environment [10]–[12].
A price incentive non cooperative game theoretic model
is proposed for energy storage system without relaying on
a central entity to achieve decentralized scheduling [13] and
state machine driven smart contract is used for P2P trading.
In [14], an efficient distributed system through P2P informa-
tion exchange in market by non cooperative game using smart
contracts. In [15], decentralized management of demand
response programs in energy system using Ethereum smart
contracts to enforce the rewards or penalties for prosumers
and balancing the energy demand and production. Blockchain
based energy internet distributed energy trading scheme is
1https://innovate.ieee.org/innovation-spotlight-ieee-fueling-fourth-
industrial-revolution/
proposed to achieves the match of transactions under the
premise of privacy-protecting [16]. In a community of smart
building using blockchain technology, the energy manage-
ment algorithm is decentralized, which enabled the secure
communication medium between users and provide the mon-
itoring and billing of electricity via smart contracts [17].
In [18], a distributed demand side management scheme is
proposed using blockchain technology to facilitate P2P trans-
actions and to maximize the payoff utility of individual par-
ticipant and the whole residential system. In [19], used the
centralized optimization approach to schedule the appliances
in multiple homes. This approach provide the issue of home
users privacy leakage in community microgrid because all
users home appliances are controlled from community con-
troller and share the information of loads consumption to vio-
late their privacy. A third party or someone figure out a users
living pattern, habits of energy consumption, behaviours and
activities by sniffing the users information may also incur
additional risks, e.g., burglary.
In this work, a game theoretic mathematical model is
proposed to schedule the appliances of an individual home
in a smart community based on electricity price and to
improve the participant’s privacy. The domestic users, being
part of the smart community market, are benefiting from the
reduced cost. The main principle is that the renewable energy
produced is consumed locally in the community microgrid
and transactions are executed on blockchain without the
need of a central control entity. The proposed approach pro-
vides lower cost of electricity to the users and increases
the flexibility in the local community market. Domestic
user’s behavior towards community goals (cost minimiza-
tion) is managed by game theory. Ethereum smart con-
tracts are used for autonomous monitoring, billing, exchange
of energy and to handle the communication between par-
ticipants in a distributed way. The smart contract code is
written in solidity on Remix IDE. The nomenclature are
provided in TABLE 1. The contribution are summarized
as follows
• Construct the game theory model to solve the partici-
pant’s privacy problem and reduce the cost of individual
participant.
• A mathematical model is proposed to schedule the
appliances in a smart community on basis of electricity
price.
• The blockchain approach address the problem of decen-
tralized energy and exchange the energy in a distributed
(exchange between the participants) way.
• Smart contract are deployed for the monitoring the
energy exchange and transactions settlement in the elec-
tricity trading system.
The organization of this paper is as follows. Themethodology
for community microgrid appliances scheduling for multiple
domestic prosumers/ consumers is described in section II.
The energy consumption game is formulated in III. A pro-
posed solutions are presented in section IV. Blockchain tech-
nology for energy management and appliances scheduling
VOLUME 8, 2020 37429
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
TABLE 1. Nomenclature.
is presented in V. The case study and simulation results are
shown in section VI. Conclusion is given in section VII.
II. METHODOLOGY
Energy management is a key objective in this paper to
minimize the electricity cost by appliance scheduling using
dynamic pricing schemes. The proposed framework using
blockchain technology for the smart community energy sys-
tems is shown in Figure 1. Two types of controllers are used in
smart community which are community controller and local
home energy consumption scheduler (HECS) for each home
in community. The community controller is used to exchange
the pricing signal, available electricity in community micro-
grid and electricity purchase or sell to utility grid; balance
the supply and demand in a smart community. Internet of
thing smart meters (IoTs) are used as HECS to exchange
the information between market participants i.e., con-
sumers/prosumers, community microgrid and the utility grid.
These IoT-SMs are used to control the information in bidirec-
tional, control the home appliances and act as control centre
in distributed market. Consumers share their energy con-
sumption profile to the energy provider and maintained the
privacy. The non cooperative game is proposed for appliance
scheduling of each users home maintaining the users privacy.
Suppose, there are N number of homes/users in a com-
munity with different types of energy resources and some
of them are prosumers. Some of users home is equipped
with rooftop PV system with local generation. Each user
has a smart IoT meter and smart IoTs appliances as per end
user requirements. The user communicates IoTs appliances,
user smart meter, community microgrid and utility grid via
advanced metering infrastructure. Different types of smart
appliancesA ∈ Am,nm are operating in each home. Each home
in a community has different appliances setAm,nm and pricing
signal for electricity purchasing from community microgrid
and utility grid. Each home has different willing time slot for
appliances operation. All the information of user is private at
HECS controller.
FIGURE 1. Community microgrid framework with blockchain.
37430 VOLUME 8, 2020
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
A. ENERGY RESOURCES
There are many kinds of sources available to generate energy
to fulfil the requirement of consumers. The proposed energy
system with self renewable generation from rooftop solar,
wind, etc., of multiple users is called prosumers. Sometimes,
energy is not fully utilized so surplus energy can share with
neighbours or in the absence of self renewable generation
from rooftop solar or high energy demand, then prosumer
becomes a consumer. The consumers buy the energy from
community microgrid or from utility grid. Energy is gener-
ated from solar, wind with energy storage etc., in community
microgrid and provides to multiple users. The purpose is to
fulfilled the energy demand locally in time of power out-
ages, strengthen the central grid to function better, enhance
community economics by reducing the electricity rates and
improve the environment by renewable energy mix. Energy
bought from utility grid for continuous availability for users
in the absence of local generation.
B. CLASSIFICATION OF SMART APPLIANCES
As potential users of smart appliances have diversified in
houses such as washing machine, boilers, dish washer, refrig-
erators, TVs, cooling & heating devices, and lighting appara-
tus [20], [21], perform the tasks for user accessibility. There
are two major types of appliances are categorized below:
The shiftable appliances are scheduled and controlled
by energy management system over scheduling periods
(T = 24). These appliances are scheduled from one time
slot to other time slot in order to reduce the electricity bill.
Shiftable appliances have a specific energy consumption load
profile, in which the assured consumption cycle is flexible
delays. The washing machine, vacuum cleaner, dishwasher
and dryer etc., are the example of shiftable appliances.
Suppose, the set of manageable appliances is denoted as
Am,n and am = 1, . . . ,Am,n for n ∈ N for each user.
Pm,n =
∑
am∈Am
PAm,n (1)
The energy consumption of non shiftable appliance is
constant during the operation period t ∈ T . Non shiftable
appliances cannot be shifted to off peak hours for scheduling
and reducing the cost. Such as power consumption profiles
of electrical appliances such as lights, fans, refrigerators and
televisions etc. Let a set of non shiftable appliances of user
n ∈ N identified as
Pnm,n =
∑
anm∈Anm
PAnm,n (2)
In context of community microgrid, community owned elec-
tricity is generated fromRES (solar, wind etc.). The aspiration
of the optimization model is to schedule the limited resource
of energy for the operation of appliances based on their period
preference and cost of electricity. Appliances are operating
based on 24-hours ahead time of use (TOU) electricity tariff.
Here, Pn,t is the total individual power consumption profile
of user n ∈ N in t ∈ T time slot.
Pna = Pm,n + Pnm,n
Pn,ta =
T∑
t=1
Pn,ta (3)
In community of N users, PT is the total combined power
profile of all users in community. Let denotePn,t be the power
profile of user n ∈ N at time t ∈ T , then
PT =
∑
n∈N
∑
t∈T
∑
a∈A
Pn,ta ∀t ∈ T (4)
Each user has own energy consumption schedule to reduce
the bill and different demand peaks in a different time slots
in day. Aggregated power profile are used to determine the
peak-to-average (PAR) ratio [22]. This represents the shape
characteristic of all demand of whole system. PAR is defined
in equation (5). For this, first calculate the peak and average
load levels as
Ppeak = maxPT
Pavg =
1
T
N∑
n=1
T∑
t=1
Pn,t ∀t ∈ T
PAR =
Ppeak
Pavg
(5)
C. PRICING
Pricing signal got from communitymicrogrid. The utility grid
are optional in our work. The amount of electricity to import
and export at community level. Dynamic pricing scheme
is used for electricity purchase from community grid. Its
assumed, electricity pricing are known and cannot be changed
after announced. These prices are based on flat rate, TOU,
critical peak pricing (CPP) or real time pricing (RTP). The
consumers are free to select the pricing scheme. The cost of
same load may different at different time slot in a day. The
electricity is cheap in day time in community microgrid and
expensive to purchase from utility grid and vice versa in night
time. The price of energy depend on the energy consumed and
time of utilization of energy in a day.
Cn,t
E =

CR = 0.3 if Rsa = 1,
CB = 0.7 elseif Eba = 1,
CG > CB > CR otherwise.
(6)
where Cn,t
E is the tariff of electricity, Rsa and Eba are decision
variable to check the availability of renewable energy and
energy storage in the community microgrid. CR and CB are
electricity price from the community microgrid and CG is
electricity purchased from utility grid.
D. PROBLEM FORMULATION
The objective function minimize the operational cost of the
appliances in community and individual user. The users
in community give the preferences in terms of their idles
VOLUME 8, 2020 37431
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
operating modes. The objective function in equation (7) and
constraints are formulated in equation (8-13).
minCn =
∑
n∈N
∑
t∈T
∑
l∈L
∑
a∈A
(
α
n,t
la P
n,t
la C
n,t
E
−β
n,t
R Gn,tR Cn,t
R + γ
n,t
C Sn,tS Cn,t
C
)
(7)
where N represents the total number of users, where T repre-
sents the time, L represents the types of loads andA is the total
number of appliances in smart community, αn,tla is decision
variable for appliances scheduling, Pn,tla is the power profile
of domestic load appliances with respect to time t and Cn,t
E is
the cost of electricity with respect to time t . In the second part
of objective function, βn,tR is decision variable for renewable
energy, Gn,tR is self generated energy from renewable energy
resources and Cn,t
R is cost self generated energy in time slot t .
In the third part of objective function, γ n,tC is decision variable
for energy storage, Sn,tS is electricity storage at time t and Cn,t
C
is electricity storage cost at time t .
1) DECISION VARIABLE
The constraint C1 is decision variable of appliance ON and
OFF. When decision variable is 1, appliance is ON and 0 for
appliance OFF. The constraint C2 is decision variable of user
for self generation energy. When βn,tR = 1, user is a prosumer
and βn,tR = 0 for user is a consumer. The consumer buy
the energy from community microgrid or from utility grid.
When γ n,tC = 1 energy storage is available to store energy
and γ n,tC = 0 the energy battery is not available.
C1 : α
n,t
la ∈ {0, 1} ∀l, t ∈ T
C2 : β
n,t
R ∈ {0, 1} ∀t ∈ T
C3 : γ
n,t
C ∈ {0, 1} ∀t ∈ T (8)
2) POWER BALANCE CONSTRAINTS
The power balance equation is presented in equation (9) for
house hold energy system. This equation justify the power
balance equation for user. Pn,t + γ n,tC Sn,tC are energy con-
sumption demand profile and battery charging load prifile
are equal to available power source from power grid Pn,tG ,
communitymicrogridPn,tC , self generated energy from renew-
able resources Gn,tR and discharing the energy storage battery
(1− γ n,tC ).
C4 : Pn,t + γ
n,t
C Sn,tC = Pn,tG + P
n,t
C + β
n,t
R Gn,tR
+ (1− γ n,tC )Sn,tD ∀t ∈ T (9)
3) OPERATION PERIOD PREFERENCE
The binary matrix is used for the willing factor of appliances
operation. This will provide the willing time slot W n,t
la to
operate the appliances a during t time slot. Therefore, home
user want to operate any appliance more during a day, replace
it by more appliances. These appliances operate based on
operation period preference.
C5 : α
n,t
la = W n,t
la α
n,t
la (10)
4) APPLIANCES SEQUENCE PRIORITY
The appliance can start their operation when an other appli-
ance to complete the operation cycle. A dryer machine will
not start unless thewashingmachine has finished its operation
cycle. Si is the group of these kind of loads. Decision variable
select single appliances from each group in each time slot.
C6 :
∑
a∈Si
α
n,t
la = 1 ∀l, t ∈ T (11)
5) APPLIANCES TASK COMPLETION
The smart appliances power consumption and operation
duration is mandatory to know for power profile calculation.
Different operation duration of different appliances in domes-
tic load. tla is the operation time of ath appliances in T time
slot in C7. α
n,t
la is decision variable to turn ON or OFF of
smart appliances. The constraint C7 and C8 are continuous
time to accomplished the task and its has to remain ON at
time T , until it finished the task. It give the start time and
end time of appliances. For example, if washing machine
start operating, then it operate continuously till the final
allocated time slot. C8 is formulated for continuous operation
of specific appliances in required time slot. ts is the starting
time of appliances.
C7 :
T∑
t=1
α
n,t
la = tla ∀l, t
C8 :
ts+tla−1∑
t=ts
α
n,t
la = tla ∀l, t ∈ T (12)
6) PEAK CLIPPING AND VALLEY FILING
C9 is valley filling. The constraints C10 is peak clipping and
this is the reduction of energy consumption loads during the
peak demand. This constraint assure the peak demand after
scheduling is less than or equal to the initial peak value Pmax.
C9 :
∑
l
∑
a
α
n,t
la P
t
la ≥ Pmin ∀t ∈ T
C10 :
∑
l
∑
a
α
n,t
la P
t
la ≤ Pmax ∀t ∈ T (13)
The objective function in equation (7) and constraints are
linear in this optimization problem. This problem is solved
in a centralized fashion using branch and bound algorithm
and give the unique solution. This minimize the cost of users
in whole community system. Recall that for multiple optimal
solution of users in next section.
III. ENERGY CONSUMPTION GAME
In equation (7), to obtain an optimal solution of users and
their schedules using the centralized optimization approach
to solve the problem by incorporating the constraints from
equation (8-13). This centralized optimization problem is
based on aggregated load of whole community. The users
privacy leakage is the one of main problem in centralized
approach and users share all the information with the central
37432 VOLUME 8, 2020
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
controller. Due to these problems, solving the objective func-
tion in distributed way at energy consumption users using its
HECS. Use game theoretic approach, to exchange minimal
information between HECS and energy sources. The objec-
tive is to use the HECS function to arrange domestic energy
consumption based on the individual needs of consumers. It is
also important to ensure that users are actually encouraged
to use HECS features and implement it to reduce costs. The
main focus in this work is energy cost minimization problem
of individual user without privacy leakage.
Each user billing cost depend on the offered billing pric-
ing, available energy resources and consumption vector of
shiftable appliances in T time slot. Each user optimize their
own energy schedule to minimize the cost. A non cooperative
game is modeled between the users in a community. All the
users in smart community microgrid are players andN is a set
of players. Each game among users for energy consumption
is concerned about three component as
• Players: All the registered users in smart community
microgrid and N are set of players.
• Strategies: Each user n ∈ N selects its energy consump-
tion scheduling to maximize its payoff
• Payoffs:Pn(Pn,P−n) for each user nmaximize its payoff
by minimizing its energy consumption cost bounded by
constraints from equation (8-13)
In game theory model, payoff defined by players own energy
consumption profile. Each player want to maximize own
payoffs and aggregated power profile PT is broken into the
power consumption schedule of nth user is Pn,tla and the other
users in community is P−n,tla to minimize the cost. γ n,tC = 0
in our case.
Pn(Pn,P−n) =
∑
t∈T
∑
l∈L
∑
a∈A
(
α
n,t
la C
n,t
E (Pn,tla + P
−n,t
la )
−β
n,t
R Gn,tR Cn,t
R
)
(14)
In a non cooperative game, Nash equilibrium is the solution
of game for two or more players where none of the player
can increase his utility by deviating the point. If the energy
consumption game is at unique Nash equilibrium, none of
the player can increase his utility by deviating from the
energy consumption schedule (P∗n,∀n ∈ N ). The strict Nash
equilibrium exist for energy consumptions players if and only
if equation (15) is satisfied. This Nash equilibiurm is the
solution of cost minimization problem in (7).
Pn(P∗n;P∗−n) ≥ Pn(Pn;P∗−n) ∀n ∈ N (15)
IV. DISTRIBUTED ALGORITHMS
The users are willing to cooperate and allow the HECS to
schedule the appliance to pay less. The energy consumption
game Nash equilibrium among the users is same as the opti-
mal solution of problem (7) with linear constraint. Iterative
approach to minimize the individual home electricity cost
using the appliances scheduling in a community of N home
users. Appliances scheduling and market clearing for one
day using iterative approach. In this section, proposed an
algorithm to implement at each home energy scheduling to
attain the Nash equilibrium and obtain the scheduling vector
for appliances scheduling.
In this paper, two algorithms are used for energy trading
and appliances scheduling in community. Algorithm 1 is used
to update the energy availability, pricing to consumers and
update the load vector PT. Algorithm 2 is used in player end
for appliances end to update the scheduling vector.
Algorithm 1 Energy Exchange Algorithm
1: Begin
2: Send the information about availability the resources to
consumers
3: Send the pricing signal to each user n
4: Get the initial schedule from users/consumers,
5: Calculate the aggregated energy load Ptof N users,
6: Repeat
7: for no user changes their schedule Do
8: Single user n to run algorithm 2
9: Update and broadcast the load vector Pt
10: end
11: end
Algorithm 2 HECS for Each User n ∈ N
1: N is number of users, Pn is energy consumption vector
of nth user and P−n is other users consumption vector
2: Randomly initialize Pn and P−n,
3: Repeat
4: for each n ∈ N Do
5: Solve the optimization problem (7) using Branch and
bound algorithm
6:
7: Update Pn schedule.
8: Announce schedule Pn to the
9: other home energy schedule units across the community.
10: end
11: end
12: Update P−n accordingly.
13: end
14: Until no HECS unit announces any new schedule.
15: end
V. BLOCKCHAIN IMPLEMENTATION FOR ENERGY
MANAGEMENT AND APPLIANCES SCHEDULING
The energy market generally leads to more flexible price
variations, a more diverse energy scheduling, a more frequent
energy trade and the liquidation of this energy transactions.
Each user in proposed system model is abled to maximize his
utilities through information exchange and transactions set-
tlement in the electricity trading system via smart contracts.
This system does not optimize the scheduling and electricity
trading directly. For this, create the Community Blockchain
Trading Chain (CBTC) which is used for trading the
VOLUME 8, 2020 37433
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
electricity in community microgrid and make the settlement
of transactions. This is also used to store the appliance
scheduling interval on blockchain or Off blockchain to oper-
ate where prices of electricity is low. Blockchain technology
stores the data of all nodes, i.e., energy generated from RES,
on-peak hours, off-peak hours, load demand and electricity
tariff.
The domestic users are interlinked with energy manage-
ment smart controller. In Figure 1, the purple line indicates
the information flow (money, dispatch etc.) and black line
shows the electricity flows in smart community. Each pro-
sumer/ consumer has its own HECS (IoTs smart meter) for
information exchange in community microgrid. HECS inter-
acts with users, energy providers, collects information from
smart appliances and operate automatically. This controller
is used to manage the electricity demand to schedule the
manageable appliances loads. This helps to optimize the local
energy market in P2P manner and make the pricing agree-
ment with community microgrid or utility. The users directly
purchase the electricity from producers or energy providers
(community microgrid or utility) and smart contract handles
the process with predefined negotiation rules. The smart
contract checks the availability of required electricity and
also check the prices of electricity automatically. The smart
contracts are immutable is the advantage in proposed system.
Firstly, define the agrement using smart contracts, then send
the money to the predefined address that work as escrow
account. The electricity process is takes place after this pro-
cess. The IoT-SMs control the flow of energy from producers
and consumers and also control the consumer domestic smart
appliances. Finally, implemented blockchain technology
which is suitable for the efficiency of the proposed manage-
ment approach. The advantage of our proposed approach fel-
lows as i) it distributed the energy in a decentralized way for
the community ii) it transmit the transaction peer to peer iii) it
reduce the cost and improve the security iv) it provides the
traceability of electricity usage which provide the facility to
the supervision of the transaction v) The smart contract auto-
matically executes without the interaction of the third party.
VI. RESULTS AND DISCUSSION
A. OPTIMUM SCHEDULING AND COST BENEFITS
Matlab is used to implementing the proposed scheduling in
centralized and distributed coordination scenario. The objec-
tive function and incorporating all constraints is solved and
attain the optimal scheduling. In this work, a day of 24 hours
is divided in 96 time slots and one time slot interval is equal to
15 minutes. Total time slots are calculating by 24*60/15=96.
The time is start from mid night 12 AM.
The price of energy is the input parameter used to take the
decision for appliances scheduling. Dynamic pricing scheme
is used to trade the energy from community microgrid and
utility grid. The cost of same load may different at different
time slot in a day. The electricity is cheap in day time and
expensive to purchase from utility grid and vice versa in night
time. The price of energy depend on the energy consumed
and time of utilization of energy in a day. In this work,
selection of energy tariff depend on the equation (6) basis
on available energy sources and cost of electricity are shown
in Figures 2-3. The energy tariff has been taken in CNY/kWh
for 24 hours and CNY is the Chinese yuan. Each home has
different willing time slots for appliances operation is an other
parameter to take decision. This willing time slot depend on
the preference of appliance operation basis on equation (13).
The manageable appliances shift the operation time slot from
peak demand time to off peak demand to minimize the energy
cost. The energy consumption profile of shiftable appliances
are given in Table 2. The energy consumption profile data of
shiftable appliances and non shift appliance are taken from
[20], [21], [23] which are used for appliances scheduling of
individual participant in community microgrid.
Figures 2 and 3 illustrate the optimal energy management
of smart appliances. In Figure 2, only shows the shiftable
appliances scheduling results. The results differentiate in
terms of demand graphs between the optimal energy man-
agement of our scenario.
FIGURE 2. Only shiftable appliances scheduling.
TABLE 2. Shiftable appliances power profile.
37434 VOLUME 8, 2020
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
FIGURE 3. Optimal scheduling of whole single home appliances load.
Energy consumption has increased in the time slot where
electricity prices are low and renewable energy is available.
This has led to the peak time of energy consumption has
shifted and also reduces electricity consumption prices of
consumers. The optimal scheduling of whole single home
appliances load is depicts in Figure 3 where load of all
shiftable and non shiftable appliances. Increase the utilization
of energy in case of less price and availability of renewable
energy.
The shiftable smart appliances pattern are depicts in
Figure 4. This pattern show the scheduling of individual
shiftable appliance. These smart appliances are shifted in day
time at the time slot, when renewable energy is available
and electricity tariff is low. Appliances sequence constraint
in equation (11) is satisfied. Dryer operate after finishing the
task of washing machine as shows in Figure 4.
FIGURE 4. Appliances sequence pattern.
The different sources of electricity are available in our pro-
posed model. Rooftop PV solar panel of 2kW is considered to
generate electricity. The solar PV generation work in day time
depending on the solar radiation and temperature. The solar
energy generation profile is given in [24]. In Figure 5, 2kW
power generation profile is plotted for single home which
varies from 0 to 1.85kW.
FIGURE 5. PV panel profile.
Figure 6 shows the net optimal energy demand and energy
import from community microgrid or utility grid. The local
energy generation reduces the energy import to minimize the
electricity bill. The appliance scheduling pattern are same as
discussed in previous but final demand curve is different due
the effect of power supply by local generation and decrease
the net demand.
FIGURE 6. Reduce the import of energy to minimizing the energy cost.
Optimum and non optimum electricity bill of all users are
shown in Figure 7 for smart community. The each home
user pay the less electricity bill to the community microgrid
or utility grid when HECS is enabled in the smart meter.
Therefore, participants would be pleased to take part in the
proposed energy demand management system.
B. IMPLEMENTATION OF BLOCKCHAIN TECHNOLOGY
Each user in proposed system model is abled to maximize his
utilities through information exchange in the electricity trad-
ing system. This system does not optimize the scheduling and
electricity trading directly. For this, create the CBTC which
VOLUME 8, 2020 37435
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
FIGURE 7. Electricity bill.
is used for trading the electricity in community microgrid
and make the settlement of transactions. This is also used
to store the appliance scheduling interval on blockchain or
Off blockchain to operate where prices of electricity is low.
For this, proposed system is implemented using Ethereum
blockchain framework.
Remix is Ethereum integrated development environment
(IDE).2 This is a powerful open source tool for writing solid-
ity contracts directly from the browser. Remix support is used
in the browser and is written natively in JavaScript. In remix
IDE, supports testing, debugging and deploying of smart
contracts for different applications. The smart contracts are
written in Solidity language. This language is object oriented
and high level for writing the smart contracts. Smart contracts
are predefined programmes which govern the behaviours of
user account with in Ethereum state.
MetaMask,3,4 is a tool which provide the bridge to visit
the distributed web. This is used to run Ethereum dApps
in browser without running full Ethereum node. MetaMask
providing user interface to manage the identities and provide
the secure transactions in main Ethereum network or some
test network. In this work, install the MetaMask add-on in
Chrome browser. First of all, create the wallet account for
community grid, utility grid and home users for transactions
as shown in Figure 8. The Ropsten Test network5 is a testing
network which run the same protocol as Ethereum and used
for testing before deploying in main network. MetaMask
Ether Faucet6 is used to get the ETHs and send automatically
in wallet address. The system component and description of
proposed system is described below:
1) Accounts (Wallet address) are created for user using
Metamask. In this work, two node are energy provider
2https://remix.ethereum.org/
3https://metamask.io/
4https://drive.google.com/file/d/0Bz90riPGRHquNDVXVE81RmppaUk/
view
5https://ropsten.etherscan.io/
6https://faucet.metamask.io/
FIGURE 8. MetaMask Ethereum dApps.
FIGURE 9. Ethereum transactions workflow using Remix.
and other nodes are consumers. The local operator
(community controller) to assign accounts to each users
as new registration for energy provider or energy con-
sumers. Blockchain network retain the copy of ledger
and participate in consensus process.
2) Users can create own available energy and price; send
to P2Pmarket for trading energy. Other could see it own
trading panel.
3) Users could take offer by invoking the function buyen-
ergy() basis on lowest price. After this, transaction is
completed. The information of recent block and trans-
action is updated in blockchain network system.
4) Dapp is a front end application that allows a smart
home in a community to interact with blockchain. This
facilitating the automated control of distributed system
in community for trading and monitoring.
5) Ledger is decentralized database which store the shared
data including energy data, pricing for all homes.
6) Smart contracts are auto executed based on ledger
data. This make the energy and financial transac-
tions between energy provider and energy consumers.
This send the control signals to toggle automatically
ON/OFF of appliances to participate in smart commu-
nity. The main purpose of deploying the smart contract
system for energy trading could be possible between
the community microgrid and utility in efficient way
without the involvement of third party. The smart IoTs
appliances store the data in ledger. The functions,
37436 VOLUME 8, 2020
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
FIGURE 10. Registered consumer transaction detail.
FIGURE 11. Transactions record in blockchain ledger.
events, state variable and modifiers are main element
in smart contracts.
The whole trading process and scheduling is done by sys-
tem itself with a little manual intervention. The operation cost
of system is lower, information is traceable and secure. Ether-
scan7 is a Block Explorer for Ethereum blockchain which is
used to verify the every transaction information is stored in
this work. This is allowed the users to lookup, confirm and
validate the transactions in Ethereum blockchain. Figure 9
shows the smart contract running in Ethereum network,
the transactions flow and how Metamask signs the trans-
actions using owner private key. Figure 10 is a blockchain
transaction. This transaction tells the information about level
of difficulty for mining, transaction hash function, gas limit
used for the transaction to run on Ethereum. The nonce
ensure to store the information permanently in blockchain.
The specific transaction detail see in Etherscan. The proposed
7https://etherscan.io/
smart community energy trading and appliances scheduling
system is implemented in the form of smart contract on
blockchain technology. The smart community trading algo-
rithm is written in solidity and tested on Ethereum blockchain
platform. Figure 11 shows the transactions record in Ether-
scan for contract creation,8 in next two transactions give the
permission to register energy providers and consumers in
community market. Energy provider offer the energy price,
quantity, timestamp and day and consumers buy the energy
from seller on basis for energy price, quantity and time.
VII. CONCLUSION AND FUTURE DIRECTIONS
Distributed demand sidemanagement system amongmultiple
home users in a community microgrid with the internet of
things smart meter is proposed in this paper. The appliances
are scheduled in the smart community by using game theory.
The main advantage to use the game theory to reduce the
80xddF7c075Fa18Df6B30bf826b6349192CC4f01536
VOLUME 8, 2020 37437
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
cost of electricity of individual homes. Furthermore, the exe-
cution of smart contract which automatically communicates
between the participants. However, the proposed scheme
apply solidity smart contract is deployed for the settlement
of transactions. The adaption of the blockchain technology,
exchange the energy between the participants and create trust
among the users or organizations. The presented results show
that the total cost of energy consumption of the whole com-
munity as well as each user’s individual cost is minimized,
and the energy consumption profile is improved. In the future,
compare the transaction cost of the blockchain technology
using smart contract. Moreover, to design a framework which
support themore scalability in terms of sharing the energy and
reduce the cost.
REFERENCES
[1] K. G. Boroojeni,M. H. Amini, A. Nejadpak, S. S. Iyengar, B. Hoseinzadeh,
and C. L. Bak, ‘‘A theoretical bilevel control scheme for power networks
with large-scale penetration of distributed renewable resources,’’ in Proc.
IEEE Int. Conf. Electro Inf. Technol. (EIT), May 2016, pp. 510–515.
[2] B. P. Koirala, E. Koliou, J. Friege, R. A. Hakvoort, and P. M. Herder,
‘‘Energetic communities for community energy: A review of key issues and
trends shaping integrated community energy systems,’’ Renew. Sustain.
Energy Rev., vol. 56, pp. 722–744, Apr. 2016.
[3] A. Shrestha, R. Bishwokarma, A. Chapagain, S. Banjara, S. Aryal, B.Mali,
R. Thapa, D. Bista, B. P. Hayes, A. Papadakis, and P. Korba, ‘‘Peer-to-Peer
energy trading inMicro/Mini-grids for local energy communities: A review
and case study of nepal,’’ IEEE Access, vol. 7, pp. 131911–131928, 2019.
[4] N. K. Meena, J. Yang, and E. Zacharis, ‘‘Optimal planning and operational
management of open-market community microgrids,’’ Energy Procedia,
vol. 159, pp. 533–538, Feb. 2019.
[5] M. Knowledge, ‘‘Community microgrids: A guide for mayors and city
leaders seeking clean, reliable and locally controlled energy,’’ Energy
Efficiency Markets LLC, Richmond, VA, USA, Tech. Rep., 2015.
[6] E. Shirazi, A. Zakariazadeh, and S. Jadid, ‘‘Optimal joint scheduling of
electrical and thermal appliances in a smart home environment,’’ Energy
Convers. Manage., vol. 106, pp. 181–193, Dec. 2015.
[7] R. Schleicher-Tappeser, ‘‘How renewables will change electricity markets
in the next five years,’’ Energy Policy, vol. 48, pp. 64–75, Sep. 2012.
[8] U. Cali and O. Cakir, ‘‘Energy policy instruments for distributed ledger
technology empowered Peer-to-Peer local energy markets,’’ IEEE Access,
vol. 7, pp. 82888–82900, 2019.
[9] Z. Li, M. Shahidehpour, and X. Liu, ‘‘Cyber-secure decentralized energy
management for IoT-enabled active distribution networks,’’ J. Mod. Power
Syst. Clean Energy, vol. 6, no. 5, pp. 900–917, Jul. 2018.
[10] W. Ejaz andf A. Anpalagan, ‘‘Internet of Things for smart cities: Overview
and key challenges,’’ in Internet of Things for Smart Cities (SpringerBriefs
in Electrical and Computer Engineering). Cham, Switzerland: Springer,
2019, doi: 10.1007/978-3-319-95037-2.
[11] A. S. Musleh, G. Yao, and S. M. Muyeen, ‘‘Blockchain applica-
tions in smart Grid–Review and frameworks,’’ IEEE Access, vol. 7,
pp. 86746–86757, 2019.
[12] M. Fan and X. Zhang, ‘‘Consortium blockchain based data aggrega-
tion and regulation mechanism for smart grid,’’ IEEE Access, vol. 7,
pp. 35929–35940, 2019.
[13] X. Yang, G. Wang, H. He, J. Lu, and Y. Zhang, ‘‘Automated demand
response framework in ELNs: Decentralized scheduling and smart con-
tract,’’ IEEE Trans. Syst., Man, Cybern., Syst., vol. 50, no. 1, pp. 58–72,
Jan. 2020.
[14] Y. Li, W. Yang, P. He, C. Chen, and X. Wang, ‘‘Design and management of
a distributed hybrid energy system through smart contract and blockchain,’’
Appl. Energy, vol. 248, pp. 390–405, Aug. 2019.
[15] C. Pop, T. Cioara, M. Antal, I. Anghel, I. Salomie, and M. Bertoncini,
‘‘Blockchain based decentralized management of demand response pro-
grams in smart energy grids,’’ Sensors, vol. 18, no. 2, p. 162, Jan. 2018.
[16] X. Lu, L. Shi, Z. Chen, X. Fan, Z. Guan, X. Du, and M. Guizani,
‘‘Blockchain-based distributed energy trading in energy Internet: An SDN
approach,’’ IEEE Access, vol. 7, pp. 173817–173826, 2019.
[17] O. Van Cutsem, D. HoDac, P. Boudou, andM.Kayal, ‘‘Cooperative energy
management of a community of smart-buildings: A blockchain approach,’’
Int. J. Electr. Power Energy Syst., vol. 117, May 2020, Art. no. 105643.
[18] S. Noor, W. Yang, M. Guo, K. H. van Dam, and X.Wang, ‘‘Energy demand
side management within micro-grid networks enhanced by blockchain,’’
Appl. Energy, vol. 228, pp. 1385–1398, Oct. 2018.
[19] M. Afzal, K. Umer, W. Amin, M. Naeem, D. Cai, Z. Zhenyuan, and
Q. Huang, ‘‘Blockchain based domestic appliances scheduling in commu-
nity microgrids,’’ in Proc. IEEE Innov. Smart Grid Technol.—Asia (ISGT
Asia), May 2019, pp. 2842–2847.
[20] F. A. Qayyum, M. Naeem, A. S. Khwaja, A. Anpalagan, L. Guan, and
B. Venkatesh, ‘‘Appliance scheduling optimization in smart home net-
works,’’ IEEE Access, vol. 3, pp. 2176–2190, 2015.
[21] M. Afzal, M. Naeem, M. Iqbal, M. Sharif, and Q. Huang, ‘‘Efficient
energy resource scheduling for sustainable diversified farming,’’ J. Renew.
Sustain. Energy, vol. 9, no. 4, Jul. 2017, Art. no. 044902.
[22] A.-H. Mohsenian-Rad, V. W. S. Wong, J. Jatskevich, R. Schober, and
A. Leon-Garcia, ‘‘Autonomous demand-side management based on game-
theoretic energy consumption scheduling for the future smart grid,’’ IEEE
Trans. Smart Grid, vol. 1, no. 3, pp. 320–331, Dec. 2010.
[23] R. Stamminger, G. Broil, C. Pakula, H. Jungbecker, M. Braun,
I. Rüdenauer, and C. Wendker, ‘‘Synergy potential of smart appliances,’’
Rep. Smart-A Project, pp. 1949–3053, 2008.
[24] M. C. Bozchalui, S. A. Hashmi, H. Hassen, C. A. Canizares, and
K. Bhattacharya, ‘‘Optimal operation of residential energy hubs in smart
grids,’’ IEEE Trans. Smart Grid, vol. 3, no. 4, pp. 1755–1766, Dec. 2012.
MUHAMMAD AFZAL (Member, IEEE) received
the B.S. degree in computer engineering and
the M.S. degree in electrical engineering from
COMSATS University Islamabad at Wah Cantt,
Wah Cantt, Pakistan, in 2010 and 2016, respec-
tively. He is currently pursuing the Ph.D. degree
with the Sichuan State Provincial Laboratory of
Power System Wide-Area Measurement and Con-
trol, School of Mechanical and Electrical Engi-
neering, University of Electronic Science and
Technology of China, Chengdu, China.
His current research interests include optimization of energymanagement,
energy informatics, power market, and blockchain technology in the energy
systems.
QI HUANG (Senior Member, IEEE) was born
in Guizhou, China. He received the B.S. degree
in electrical engineering from Fuzhou University,
in 1996, the M.S. degree from Tsinghua Univer-
sity, in 1999, and the Ph.D. degree from Arizona
State University, in 2003.
He is currently a Professor with the University
of Electronic Science and Technology of China
(UESTC), the Executive Dean of the School of
Mechanical and Electrical Engineering, UESTC,
and the Director of the Sichuan State Provincial Lab of Power System
Wide-Area Measurement and Control. His current research and academic
interests include power system instrumentation, power system monitoring
and control, energy informatics, and power market.
WAQAS AMIN received the B.S. and M.S.
degrees in electrical engineering from The Univer-
sity of Lahore (UOL), Pakistan, in 2010 and 2016,
respectively. He is currently pursuing the Ph.D.
degree with the Sichuan State Provincial Labo-
ratory of Power System Wide-Area Measurement
and Control, School of Mechanical and Electrical
Engineering, University of Electronic Science and
Technology of China, Chengdu, China. He was
a Lecturer with UOL, from 2010 to 2017. His
current research interests include energy management, distributed electricity
trading, and blockchain technology in power systems.
37438 VOLUME 8, 2020
http://dx.doi.org/10.1007/978-3-319-95037-2
M. Afzal et al.: Blockchain Enabled Distributed Demand Side Management in Community Energy System
KHALID UMER received the B.S. degree in elec-
trical engineering from the University of Engineer-
ing and Technology (UET), Lahore, in 2013, and
the M.S. degree in electronic science and technol-
ogy from the University of Electronic Science and
Technology of China (UESTC), in 2016. He is cur-
rently pursuing the Ph.D. degree with the Sichuan
State Provincial Laboratory of Power System
Wide-Area Measurement and Control, School of
Mechanical and Electrical Engineering, UESTC.
His current research interests include P2P energy trading, energy manage-
ment, blockchain, distributed optimization, game theory, and microgrids.
ASIF RAZA received the B.E. degree in
electrical engineering from the Quaid-e-Awam
University of Engineering, Science and Technol-
ogy, Nawabshah, in 2014, and the M.E. degree
in electrical engineering from the Mehran Uni-
versity of Engineering and Technology, Jamshoro,
Pakistan, in 2017. He is currently pursuing the
Ph.D. degree with the Sichuan Provincial Key
Lab of Power System Wide-Area Measurement
and Control, School of Mechanical and Electrical
Engineering, University of Electronic Science and Technology of China. His
research interests include operation, control, and integration of renewable
energy sources with VSC multiterminal HVDC system and dc microgrids.
MUHAMMAD NAEEM received the B.S. and
M.S. degrees in electrical engineering from the
University of Engineering and Technology at Tax-
ila, Taxila, Pakistan, in 2000 and 2005, respec-
tively, and the Ph.D. degree from Simon Fraser
University, Burnaby, BC, Canada, in 2011. From
2000 to 2005, he was a Senior Design Engineer
with Comcept (Pvt.) Ltd., Islamabad, Pakistan,
where he participated in the design and develop-
ment of smart card-based GSM and CDMA pay
phones with the Department of Design. From 2012 to 2013, he was a
Postdoctoral Research Associate with the Wireless Networks and Commu-
nications Research (WINCORE) Laboratory, Ryerson University, Toronto,
ON, Canada. Since 2013, he has been an Assistant Professor with the
Department of Electrical Engineering, COMSATS University Islamabad at
Wah Campus, Wah Cantt, Pakistan, and a Research Associate with the
WINCORE Laboratory. He is also a Microsoft Certified Solution Developer.
His research interests include the optimization of wireless communication
systems, nonconvex optimization, resource allocation in cognitive radio
networks, and approximation algorithms for mixed-integer programming in
communication systems. Hewas a recipient of the NSERCCGS Scholarship.
VOLUME 8, 2020 37439