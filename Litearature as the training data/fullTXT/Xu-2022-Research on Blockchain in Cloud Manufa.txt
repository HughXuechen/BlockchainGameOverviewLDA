9---徐杨杨
计算机科学与探索
ww
w.c
eaj
.or
g
计算机科学与探索
Journal of Frontiers of Computer Science and Technology
1673-9418/2022/16(10)-2298-12
doi: 10.3778/j.issn.1673-9418.2102071
区块链在云制造资源分配的研究
徐杨杨 1,2，王 艳 1,2+
1. 江南大学 轻工过程先进控制教育部重点实验室，江苏 无锡 214122
2. 江南大学 物联网工程学院，江苏 无锡 214122
+ 通信作者 E-mail: wangyan88@jiangnan.edu.cn
摘 要：云制造平台中，虚拟化的制造资源在交易过程中难以保证交易数据的真实性和安全性，而且依赖云制
造平台运营商（CPO）的统一调配。该集中式框架容易出现单点故障，并且存在隐私数据泄露的风险。针对这
些问题，结合区块链的去中心化和不可篡改性的优点，创新性地探索区块链技术在云制造中的应用，提出了一
种基于区块链的云制造资源分配方法。首先，提出了一种基于区块链的去中心化的云制造交易平台框架，研
究了制造资源/需求发布过程中的椭圆曲线数字签名算法（ECDSA），分析了制造资源与需求匹配的机理。然
后，利用智能合约（SC）设计了面向云制造的制造资源校验合约和制造资源交易合约，并使用 Solidity 完成在
Remix 平台中的实验测试。测试结果表明，提出的方法可以为虚拟化的制造资源交易提供一种安全可靠的保
障。最后，探索了在去中心化的架构下，制造资源供应方（MRS）和制造资源需求方（MRD）供需平衡的博弈问
题，并在 MATLABR2019b 上进行仿真，仿真结果表明制造资源供应方和需求方的博弈可以达到纳什均衡，并
且较已有的研究有较快的收敛速度。
关键词：区块链；云制造；智能合约（SC）；资源分配；博弈
文献标志码：A 中图分类号：TP391
Research on Blockchain in Cloud Manufacturing Resource Allocation
XU Yangyang1,2, WANG Yan1,2+
1. Key Laboratory for Advanced Process Control for Light Industry, Ministry of Education, Jiangnan University, Wuxi,
Jiangsu 214122, China
2. School of Internet of Things Engineering, Jiangnan University, Wuxi, Jiangsu 214122, China
Abstract: In cloud manufacturing platform, virtual manufacturing resources have difficulty to guarantee the authen-
ticity and security of transaction data in the process of transaction, and have dependency on the unified deployment
of cloud manufacturing platform operators (CPO). The centralized framework is prone to single point of failure and
the risk of privacy data leakage. In view of these problems, combined with the advantages of decentralization and
tamper-proofing of blockchain, the application of blockchain technology in cloud manufacturing is innovatively ex-
plored, and a resource allocation method of cloud manufacturing based on blockchain is proposed. Firstly, a decen-
tralized cloud manufacturing trading platform framework based on blockchain is proposed, the elliptic curve digital
signature algorithm (ECDSA) in the process of manufacturing resource/demand issuance is studied, and the mech-
anism of matching between manufacturing resources and manufacturing demand is analyzed. Then, the manu-
facturing resource verification contract and manufacturing resource trading contract for cloud manufacturing are
基金项目：国家重点研发计划（2018YFB1701903）。
This work was supported by the National Key Research and Development Program of China (2018YFB1701903).
收稿日期：2021-03-02 修回日期：2021-04-16
开放科学(OSID)
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
云制造 [1-2]依托云计算、物联网、大数据、虚拟化
等先进技术，为制造业提供一种新的生产模式。基
于云制造平台，物理世界中的制造资源和制造能力
通过数字孪生技术 [3]被抽象化为可以用于消费的虚
拟资源，集中在云平台的资源池中，由云平台运营商
统一调配，从而可以打破地理条件的约束。云制造
旨在产品的整个生命周期内向用户提供各种灵活
的、可定制的制造服务[4]。
作为学术界和工业界共同关注的前沿问题，有
关云制造的研究工作主要集中在可信性、资源分配
和服务质量等方面。文献 [5]为了有效表征合作信
任，通过对历史服务评价数据的监测，构建了评价指
标体系，将服务满意度量化，并提出了基于服务满意
度的信任评价模型。文献[6]研究了云制造平台中制
造资源的可信性问题，从信用和可靠性两方面评估
制造资源的可信度。文献[7]为了解决云制造平台上
复杂产品制造任务匹配过程中偏好信息的模糊性和
不确定性，提出了一种基于双犹豫模糊偏好信息的
双边匹配模型。文献[8]针对云制造平台在制造资源
分配过程的能耗问题，提出了一种基于能耗感知的
资源分配方法。文献[9]根据云制造具有复杂特征的
资源调度问题，提出了一种资源竞价机制，保证了云
制造市场的公平性。文献[10]考虑到不同的制造云
服务具有相似的功能和不同的服务质量，提出了一
种关联感知的制造云服务描述模型，用以描述单个
服务对其他相关服务的依赖性。文献[11]研究了云
制造过程中扰动对服务质量的影响，利用离散马尔
科夫跳变系统实现对资源的动态优化。
上述有关云制造的相关理论研究与探索，虽然
在可信性、资源分配和服务质量方面取得一定的进
展，但是其依赖的底层系统架构依然是集中式的框
架体系。在该框架下，云制造平台由运营商经营，制
造资源供应方和需求方均由平台运营商调配。其最
大特点是系统中的决策依赖于少量的节点，因此，其
本质上无法避免单点故障。目前，主要通过冗余备
份解决单点故障问题，但是需要付出昂贵的维护成
本，并且无法从根本上解决单点故障。除此之外，系
统中少数节点掌握过多的权限，容易成为黑客攻击
的目标，存在保密数据泄露的风险。
区块链技术是一种全新的去中心化基础架构和
分布式计算范式[12]。在公有链中，所有节点具有相同
的地位，满足一定条件才可以获得记账权。其他节
点负责验证，验证通过后更新本地的数据。区块链
网络通过发布奖励来刺激节点挖矿的积极性，因此，
即便网络中没有中心节点的调度，区块链网络仍然
能保证数据存储的完整性和一致性。同时，区块链
技术是一种创造信任的技术，在弱信任的网络中，节
点可以按照客观的标准，譬如算力、币龄等，获得大
多数节点的认可。它提供了一种安全的方式来交换
任何种类的商品、服务或交易。区块链上的数据具
有不可篡改性，存储在区块中的数据通过哈希运算
得到唯一的身份编码，并且区块以链式结构连接，通
过这种方式强化已存储的数据的安全性。
区块链技术有着广阔的应用前景。翁晓泳利用
区块链的去中心化特性和不可篡改特性，设计了一
种双链结构，保护云平台中的共享数据[13]。陈飞等人
利用区块链的数据可溯性设计了食品溯源系统 [14]。
任艳丽等人为了解决区块链中过期的数据，根据改
进的门限环签名方案和基于空间证明的共识机制提
出了可删除的区块链 [15]。文献[16]对区块链在制造
业和工程上的应用做了系统的综述研究。文献[17]
指出区块链技术可以满足高可信度、高数据安全的
分布式系统的需求，并且提出了建立一种对工业资
源进行可信管控的系统平台。文献[18]在基于区块
链的云制造平台中，探索了非零和理性定价策略以及
不同负载水平对平台各方收益的影响。文献[19-21]
主要针对云制造平台中的信任问题，结合区块链设
计出一种可信的服务交易方式。文献[22-23]针对第
designed with the smart contract (SC), and the experimental test on the Remix platform is completed with Solidity.
The test results show that the proposed method can provide a secure and reliable guarantee for virtual manufacturing
resource trading. Finally, the game problem of supply and demand balance of manufacturing resource suppliers
(MRS) and manufacturing resource demanders (MRD) is explored in the decentralized architecture, and the simu-
lation is carried out on MATLABR2019b. The simulation results show that the game of manufacturing resource
suppliers and manufacturing resource demanders can reach Nash equilibrium, and the convergence speed is faster
than the existing research.
Key words: blockchain; cloud manufacturing; smart contract (SC); resource allocation; game
2299
计算机科学与探索
ww
w.c
eaj
.or
g
Journal of Frontiers of Computer Science and Technology 计算机科学与探索 2022, 16(10)
三方平台的集中式架构和信任问题，提出了分布式
对等网络架构，以提高系统的安全性和可扩展性。
文献[24]提出了一种基于区块链的工作流管理系统
来集中共享不同客户的异构物流资源。文献[25]提
出了基于区块链技术的服务组合模型。作为一种新
型的制造架构，通过将原始的服务组合问题划分为
多个子问题，每个子问题包含服务/任务池的一部分，
从而克服了集中化机制。
区块链技术可以为云制造系统的信任问题和数
据安全等问题提供一种有效的解决方案。然而将区
块链的去中心化特性和数据不可篡改特性用于云制
造的研究相对较少。因此，本文提出了一种基于区
块链的去中心化的云制造交易平台框架。本文的工
作和创新点如下：
（1）提出了一种基于区块链的去中心化的云制
造交易平台框架，研究了制造资源/需求发布过程中
的椭圆曲线数字签名算法，以及制造资源与需求匹
配的流程。
（2）利用智能合约设计了面向云制造的制造资
源校验合约和制造资源交易合约，并完成在 Remix平
台中的实验测试。
（3）探索了在去中心化的架构下，制造资源供应
商和制造资源需求者供需平衡的博弈问题，并在
Matlab上进行仿真，仿真结果表明制造资源供应方和
需求方的博弈可以达到纳什均衡，并且较已有的研
究有较快的收敛速度。
1 区块链
区块链是一种去中心化的分布式账本，具有共
同维护、不可篡改、公开透明、安全和匿名性等优点，
核心组件是智能合约和共识机制，其结构如图 1 所
示。区块头存放与共识有关的数据项，其中当前区
块哈希值是该区块的唯一标识。区块体主要存放节
点打包的交易记录。
按照去中心化程度，区块链可以分为公有链、联
盟链和私有链 [26]。公有链是一种完全去中心化的网
络，网络中的节点地位均等，可以随时加入或退出网
络，以比特币和以太坊为代表。联盟链是一种多中心
化的网络，中心数由组建联盟链的初始成员确定，节
点的加入需要特定机构批准，以超级账本为代表。私
有链是一种中心化的网络，适用于规模较小的团体。
智能合约（smart contract，SC）是一种嵌入到硬件
上可自动执行的代码。广义上讲，智能合约是无需
中介、自我验证、自我执行合约条款的计算机交易协
议 [27]。智能合约赋予区块链更强的拓展性和更高的
灵活性，允许开发人员在区块链网络中开发业务逻
辑。智能合约以区块链的不可篡改性作为底层支
撑，整个生命周期包括合约创建、合约部署、合约调
用、状态更新 [28]。在合约的整个生命周期内，各个环
节以交易的形式被记录到区块链中。
共识算法是区块链系统中的必要组成部分，共
识是对区块链网络中的数据或状态达成一致的过
程。作为分布式网络的区块链系统无法同时满足一
致性、可用性和分区容错性，因此需要一种机制在满
足分区容错性的基础上，在一致性和可用性之间进
行妥协。目前，区块链系统中的共识算法大致可分
为基于证明和基于投票的算法 [29]。著名的基于证明
的共识算法有工作量证明算法、股权证明算法、委托
权益证明算法等，基于投票的共识算法主要是拜占
庭容错算法[30]。
2 基于区块链的云制造资源分配
传统的云制造平台参与用户可以划分为制造资
源供应方（manufacturing resource suppliers, MRS）、制造
资源需求方（manufacturing resource demanders, MRD）、
云平台运营方（cloud platform operators, CPO）。MRS
将可用资源注册给 CPO，由 CPO根据 MRD的需求统
筹调配制造资源，如图 2 所示，是一种集中式的架
构。本文提出的基于区块链的云制造平台通过智能
合约，在没有第三方直接参与的情况下，可实现制造
资源的分配。如图 3 所示，MRS 和 MRD 就资源价格
和资源供应量达成一致后，签署智能合约，同时将合
图 1 区块链结构
Fig.1 Blockchain structure
2300
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
约保存到区块链中，保证合约数据不被篡改。CPO
负责监督 MRS 和 MRD 的交易行为，并通过核查 SC
校验用于交易的制造资源。当双方发生交易争端
时，可通过CPO和查看 SC判定争议对象。
区块链技术的引入，可以强化 MRD和 MRS之间
的信任，实现双方的直接交易，弱化了传统云制造平
台中第三方的作用，极大地降低了信用成本。依靠
非对称数字加密和通信技术，MRS和 MRD 可以实时
掌握制造资源的使用情况。
2.1 制造资源/需求发布
为了增强制造资源/需求发布的安全性，本文使
用椭圆曲线数字签名算法（elliptic curve digital signa-
ture algorithm，ECDSA）保障 MRS 和 MRD 之间的数
据传输不被篡改。以 MRD 向 MRS 发送请求资源消
息 M 为例，具体步骤如下：
MRD 在有限域 GF(p) 上确定阶数为 p 的椭圆曲
线 E(a,b) ，其中 a 和 b 为曲线参数，并在椭圆曲线
E(a,b) 上确定基点 G 。 GF(p) ={0,1,⋯,p - 1} ，p 是素
数且 p ∈ N 。下文中的 p均与此处相同。不失一般性，
本文选取曲线 E(0,17) = x3 - y2 + 17 = 0 ，如图4所示。
MRD选择一个随机数 KSD 作为私钥，1 ≤ KSD < p，
并计算公钥 KPD ：
KPD = KSD × G （1）
选择安全的哈希函数，将请求信息 M 进行哈希
运算，获取信息摘要 m ：
m = SHA1(M) （2）
随机选择一个整数 z ，1 ≤ z < p 。计算 z 映射到
椭圆曲线的坐标 (x1,y1) ：
(x1,y1)= z × G （3）
从而获得数字签名的第一部分 r ：
r = x1 （4）
若 rmod p = 0 ，mod 为取模运算，重新执行该步骤，否
则执行下一步。
MRD使用私钥 KSD 计算数字签名的另一部分 s：
s = z-1(m + r × KSD)mod p （5）
若 s = 0 ,返回第二步，否则执行下一步。
MRD 将资源请求消息 M 、签名 (r, s) 、MSD 的公
钥 KPD 、椭圆曲线 E(a,b) 和基点 G 发送给MRS。
MRS 使用 MRD 的公钥 KPD 和签名信息对接收
到的消息 M* 进行验证。计算：
M* = m × G + r × KPD
s
（6）
若 M* = z × G ，则验证通过，否则验证失败。
算法 1 ECDSA算法
输入：M 。
图 2 传统云制造平台架构
Fig.2 Traditional cloud manufacturing
platform architecture
图 3 基于区块链的云制造平台架构
Fig.3 Blockchain-based cloud manufacturing
platform architecture
图 4 椭圆曲线
Fig.4 Elliptic curve
2301
计算机科学与探索
ww
w.c
eaj
.or
g
Journal of Frontiers of Computer Science and Technology 计算机科学与探索 2022, 16(10)
输出：M 、(r, s) 、KPD 、E(a,b) 、G 。
1. 初始化 E(a,b) ，G ，p
2. do
3. 随机生成 KSD ，计算 KPD
4. 计算 m = SHA1(M)
5. do
6. 生成随机整数 z
7. 计算 (x1,y1) = z × G
8. while x1 mod p = 0
9. 计算 s = z-1(m + r × KSD)mod p
10. while s = 0
2.2 制造资源与制造需求匹配过程
考虑以下场景：MRD需要生产一批产品，产品加
工任务 Task 可以分解为 n 个子任务 Task ={Task1,
Task2,⋯,Taskn} 。每个子任务需要不同的加工设备
和加工时间。因此，MRD 需要将该制造需求信息
MMRD 通过上一节提出的 ECDSA进行加密，并在区块
链网络中发布。为了保障 MRD身份的匿名性，MRD
的地址信息通过哈希函数加密，得到MRDadd。
MRDadd = HASH(KPD) （7）
MMRD ={D,P1,TMRD,MRDadd,[EMRD(a,b),G],KPD} （8）
其中，D =[d1,d2,⋯,dn] 表示 MRD 的子任务的制造资
源需求量，P1 = [p11,p12,⋯,p1n] 表示 MRD 第一轮愿意
给每个子任务的制造资源的购买单价，TMRD ={TMRD1,
TMRD2,⋯,TMRDn}表示每个子任务的加工时间段，MRDadd
表示 MRD 的地址信息；[EMRD(a,b),G] 表示 MRD 用于
签名的信息数据，EMRD(a,b) 表示椭圆曲线，G 是基
点；KPD 表示MRD的公钥信息。
步骤 1 MRD使用 ECDSA对制造需求信息 M 进
行数字签名，并将签名和该需求信息广播到网络中。
步骤 2 MRS 在收到 MRD 的制造资源请求消息
MMRD′后，首先验证该消息的合法性，通过 MRD 提供
的公钥 KPD 验证该消息是否是 MRD发送的消息。若
消息不合法，则不予回应；若消息合法，则 MRS 查看
请求信息 MMRD′，并将能够提供给 MRD 的制造资源
信息 MMRS 回复给MRD。
MMRS ={S,Q1,TMRS,MRSadd,[ES(a,b),G],KPS} （9）
其中，S =[s1, s2,⋯, sn] 表示 MRS 可以提供的制造资
源；Q1 = [q11,q12,⋯,q1n] 表示 MRS 对每个请求资源的
第一轮出售单价；TMRS =[TMRS1,TMRS2,⋯,TMRSn] 表示资
源的可用时间段。
步骤 3 MRD 在收到 MRS 的制造资源供应消息
MMRS′后，首先验证该消息的合法性，通过 MRS 提供
的公钥 KPS 验证该消息是否是 MRS 发送的消息。若
消息不合法，则不予回应；若消息合法，则 MRD 查看
回复信息 MMRS′ ，并对有争议的地方，例如价格，向
MRS发送消息进行协商。
MMRD ={P2,MRDadd,[ED(a,b),G],KPD} （10）
P2 = [p21,p22,⋯,p2n] 表示 MRD的第二轮报价。价
格协商可能会持续几个回合，MRS和 MRD 之间的博
弈最终会达到一个平衡点。若此刻双方都能接受平
衡时刻的价格，则交易达成共识，进入下一步骤；若
至少有一方不能接受平衡点价格，则交易失败，MRD
重新向网络中发布资源请求消息。
步骤 4 MRS 和 MRD 双方签署用于交易的智能
合约。
在制造资源与需求的匹配过程中，按照价格，交
易双方自主完成匹配与交易。合约签署后，被存放
到区块链中，保证交易记录不被篡改，如图 5所示。
算法 2 制造资源与需求匹配算法
输入：MMRD 。
输出：匹配成功与否。
1. do
2. MRD发送 MMRD
3. MRS验证 MMRD′
4. if MMRD ≠MMRD′
5. 舍弃 MMRD′，break
6. else
图 5 制造资源与制造需求匹配机理
Fig.5 Matching mechanism between manufacturing
resources and manufacturing demand
2302
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
7. MRS发送 MMRS
8. MRD验证 MMRS′
9. if MMRS ≠MMRS′
10. 舍弃 MMRS′，break
11. else if
12. MRD赞同 MMRS′，达成共识，匹配成功，
break
13. else
14. 匹配不成功，break
15. while 匹配不成功
2.3 面向云制造的智能合约设计
智能合约是区块链的重要组成部分，存放在区
块链特定的位置上，能够被区块链上的其他节点调
用并自动执行，赋予区块链智能的特性。由于区块
链的公开透明，所有节点在正式运行合约前，可以根
据输入判断出合约的输出结果，因而不存在通过智
能合约的造假。尽管智能合约具有这样的优势，但
将这种优势应用到实际生产中的研究却寥寥无几。
文献[31]将智能合约与工业物联网中的数据相结合，
研究了数据包合约和数据分析服务合约，实现了数
据商品的交易。受此启发，本文提出基于区块链的
云制造框架，在资源分配过程中，通过签署制造资源
校验合约和制造资源交易合约，保证交易的安全性
和可信度。
2.3.1 制造资源校验合约
存放在云制造资源池中的制造资源，是物理世界
中制造资源的数字化版本。在虚拟化的过程中，MRS
为了获得更大的利益，可能通过某种手段对虚拟资源
进行造假，如故意夸大资源数量。虽然区块链可以保
证链上数据的不可篡改性，但在数据上链的过程中，
区块链无法保证原始数据的真实性。因此，引入一
种监管机制显得尤其重要。本文在引入区块链技术
时，并没有因其去中心化的特性，完全舍弃 CPO 的监
督功能。CPO 的监督功能只存在制造资源第一次上
链的过程中，本文主要依靠 CPO 和 SC 完成数据上链
的校验。如果 MRS 上报的制造资源超出 CPO 统计
的制造资源范围，将拦截上报过程，提高系统的数据
可信性。而一旦制造资源的数据上传到区块链网络，
系统将根据历史记录判断制造资源的合法性。因此，
保留 CPO 的监督功能，虽然会增加一个校验环节，降
低数据上链的效率，但可以提高数据的可信度。
首先，MRS为了向其他MRD提供服务，需要将已
有的制造资源信息 S ，包括资源的种类 si.name, si ∈ S
和规模 S.length等上传到制造资源校验合约。CPO通
过调研或者实地考察等方式，对该 MRS 的资源种类
sj.name, sj ∈ S′及规模 S′.length 进行评估，得到一份资
源信息档案 S′用以衡量该MRS的能力。通过两者的
比较，云平台对符合评估范围的资源进行背书并批准
其进入区块链，否定超出评估范围的制造资源，如图 6
所示，从而监督MRS按照真实的资源进行上报。
算法 3 制造资源校验合约
输入：S ∈MRS,S′ ∈ CPO 。
输出：资源匹配或不匹配的状态。
1. for si ∈ S
2. for sj′ ∈ S′
3. if S.length > S′.length
4. return MRS谎报资源
5. else if si.name == sj′.name
图 6 面向云制造的智能合约设计流程
Fig.6 Smart contract design process for cloud manufacturing
2303
计算机科学与探索
ww
w.c
eaj
.or
g
Journal of Frontiers of Computer Science and Technology 计算机科学与探索 2022, 16(10)
6. if si.num > sj′.num
7. return MRS上报资源数量与实际不匹配
8. else
9. return MRS上报资源种类与实际不匹配
10. return 资源匹配
2.3.2 制造资源交易合约
MRS和 MRD 通过区块链通信网络就资源价格、
种类及数量达成共识后，通过签署智能合约保证交
易的真实有效。合约中的价格 P 是双方商定后确定
的价格。MRS在合约中展示所有制造资源 S 的种类
si.name 和数量 si.num, si ∈ S 。MRD 根据购买需求 D
选择相关的制造资源的种类 dj.name 和数量 dj.num,
dj ∈D。在交易过程中，制造资源智能合约根据MRD的
需求量和MRS的供给量以及资源价格，计算出支付金
额，并将金额发送给MRS的账户 balance[MRS]。同时，
调整MRS对应资源的数量及账户金额 balance[MRD]，
如图6所示。一旦智能合约在区块链上运行，所有交易
记录将永久保存，不可篡改，从而保证交易的真实可靠。
算法 4 制造资源交易合约
输入：P ，S ∈ MRS ，D ∈ MRD ，MRSadd，MRDadd。
输出：交易成功与失败状态。
1. if ∃si = dj
2. if dj.num≤ si.num
3. if balance[MRD]≥ dj.num × pij
4. balance[MRD]= balance[MRD]- dj.num × pij
balance[MRS] = balance[MRS]+ dj.num × pij
si.num = si.num - dj.num
输出交易成功
5. else
6. 输出交易失败，金额不足
7. else
8. if balance[MRD]≥ si.num × pij
9. balance[MRD]= balance[MRD]- si.num × pij
balance[MRS] = balance[MRS]+ si.num × pij
si.num = 0
输出交易成功,仍需购买
10. else
11. 输出交易失败，金额不足
12. else
13. 输出交易失败，无所需资源
3 制造资源供需博弈
3.1 问题描述
基于区块链的云制造资源分配框架使得 MRS和
MRD 可以通过区块链网络实时双向通信，并使双方
能够及时了解对方的制造资源需求/供应情况。因
此，MRD 可以根据 MRS提供的单位资源售价和供应
量以及自己的需求情况确定资源的购买量，MRS 也
可以根据 MRD 的资源需求量调整制造资源供应量
及资源售价。设在云制造平台中，对于某种制造资
源 R 存在 m 个 MRD和 1个 MRS。每个 MRD通过区
块链网络发布对资源 R 的需求量 ud ，MRS 汇总所有
的需求信息后确定对该资源的供应量 V s ，且能够提
供足够数量的资源 R ，以便获得最优的收益。因此，
双方在制定决策时存在时间上的先后顺序，是一种
完全信息的动态决策过程。因此本文采用 Stackel-
berg 博弈的相关理论解决 MRD 和 MRS 之间的资源
收益问题，其中以 MRD 为主导方，MRS 为跟随方，
MRS根据 MRD 的资源需求量确定资源供应量，形成
一个多领导者一跟随者问题。
首先，MRD 通过区块链网络发布制造资源需求
量 Ud , Ud = [ud1,ud2,⋯,udm] 。 udj 表示每个 MRD 的资
源需求量，j ∈{1,2,⋯,m} 。MRD获得制造资源后，通
过加工生产产品获得收益，记制造资源转化为产品收
益的效益为 X , X =[x1,x2,⋯,xm] 。 xj 表示每个 MRD
的效益，j ∈{1,2,⋯,m}。单位制造资源 R 的支付价格
P s = [ps]以及生产成本 Cd ，Cd = [cd1,cd2,⋯,cdm]。 cdj 表
示每个MRD的生产成本，j ∈{1,2,⋯,m}。因此，MRD
的利润为：
H =Ud(X - P s - Cd) （11）
MRD 了解制造需求后，确定制造资源的供应量
V s = [vs] 。制造资源的价格受到供需的影响而变化，
与需求量成正相关，与供应量成负相关。因此资源
售价定义为：
ps = a∑
j = 1
m
udj - bvs （12）
a > 0，b > 0 为需求量和供应量对价格的影响系
数。MRS 负责制造资源 R 日常维护，单位资源的维
护成本记为 C s = [cs] 。因此MRS的利润为：
F = V s(P s - C s) （13）
博弈的目的在于使参与者获得最大的利润。因
此，目标函数为：
ì
í
î
ï
ï
max
udj
H
max
vs
F
（14）
s.t. udj ≥ 0,vs > 0
3.2 资源供需 Stackelberg均衡
Stackelberg 博弈为主从博弈，本文以 MRD 为主
2304
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
导方，先确定资源需求量，然后 MRS根据需求量确定
供应量。博弈双方的最终目的是在对方策略的约束
下，逐步调整自己的策略，实现自己利益的最大化。
利益最大时，双方的策略集会达到相对稳定，即达到
纳什均衡。
引理 1[32] 对于资源价格 α =[α1,α2,⋯,αk,⋯,αm] ，
m 是博弈参与方的个数，与收益 β(α) 之间的 Stackel-
berg博弈如果满足条件 1和条件 2，则存在纳什均衡。
条件 1 α 是欧氏空间上的非空有界闭凸子集。
条件 2 ∀βj ∈ β , βj 关于 αj 是连续且凹的。
定理 1 对于式（11）~式（14）所描述的制造资源
供需 Stackelberg博弈，存在纳什均衡。
证明 因为对 ∀j ∈{1,2,⋯,m},udj ≥ 0 , vs > 0 ，所以
策略集 {V *
s ,U *
d} 是欧氏空间上的非空有界闭凸子集。
因此条件 1成立。
又因为：
hj = xjudj - udj
æ
è
çç
ö
ø
÷÷a∑
j = 1
m
udj - bvs + cdj （15）
f = vs
æ
è
çç
ö
ø
÷÷a∑
j = 1
m
udj - cs - bv2s （16）
由式（15）、式（16）知，hj 关于 udj 是连续的，f 关
于 vs 是连续的。
d2hj
du2
dj
= -2a < 0,∀j ∈{1,2,⋯,m} （17）
d2 f
dvs
2 = -2b < 0 （18）
由式（17）、式（18）知，hj 关于 udj 是凹的，f 关于
vs 是凹的。因此条件 2成立。
运用反向归纳方法，假设 MRS已经到达均衡点，
资源供应量 V s = V *
s = [v*s] ，代入式（15），并对式（15）关
于 udj 求导，令导函数等于 0得：
u*
dj =
xj - cdj + bv*s - a ∑
i = 1, i≠ j
m
udi
2a （19）
将式（19）代入式（16），并对式（16）关于 vs 求导，
令导函数等于 0得：
v*s =
a∑
j = 1
m
u*
dj - cs
2b （20）
因此，U *
d = [u*
d1,u*
d2,⋯,u*
dm] ，V *
s = [v*s] 。对于 MRD
而言，生产效益越高，则收益越高，因而生产效益促
进 MRD 提高需求量；而生产成本以及资源价格会降
低 MRD 的收益，因此对 MRD 的资源需求量产生负
影响。对于 MRS而言，资源需求量越大，则提高资源
供应量可以获得更大的收益，而资源维护成本越高，
会降低MRS的资源供应量。
综上，证明完毕。
4 实验及结果分析
4.1 智能合约测试及结果分析
智能合约的测试使用 Remix 作为测试环境。
Remix是一款基于浏览器的编译器和集成开发环境，允
许用户使用Solidity语言构建以太坊合约并调试交易。
在制造资源校验合约中，MRS 和 CPO 分别在合
约中上传制造资源信息。然后，将合约部署到以太
坊区块链网络中。图 7 为该合约部署到区块链的详
细信息，包括此次交易的唯一标识哈希值“0x99e6c1
ba7f0498fb3658d0225c2ab05a09d4161904f5f8bbfd90e
f04fd5831c1”，合约地址“0x358AA13c52544ECCEF6
B0ADD0f801012ADAD5eE3”以及输入的制造资源
信息。为验证合约的有效性，对制造资源上链验证
合约进行四次测试，测试输入数据见表 1。
测试结果见图 8~图 11。在测试 1 中，MRS 上报
的资源种类与 CPO 评估的种类一致，并且资源数量
表 1 合约测试输入数据
Table 1 Input data of contract test
测试
内容
测试 1
测试 2
测试 3
测试 4
MRS
资源名
m1、m2
m1、m2、m3
m1、m2
m1、m3
MRS资源
数量
10、20
10、20、20
20、30
10、20
CPO
资源名
m1、m2
m1、m2
m1、m2
m1、m2
CPO资源
数量
10、30
10、30
10、30
10、30
图 7 制造资源校验合约信息
Fig.7 Manufacturing resource validation
contract information
2305
计算机科学与探索
ww
w.c
eaj
.or
g
Journal of Frontiers of Computer Science and Technology 计算机科学与探索 2022, 16(10)
在评估范围内。因此，资源信息上链成功，在区块链
网络中创建交易,生成交易的哈希值。测试 2 中，
MRS恶意上报资源的种类和数量；测试 3中，MRS夸
大资源数量；测试 4中，MRS虚报资源种类，均被区块
链网络拦截，中断交易的执行，并回滚到上链前的状
态，从而避免被篡改的原始数据上链，维护云制造平
台中数据的真实和可信。因此，基于区块链的云平
台架构可以有效监督平台中的操作记录，方便追溯
争端的起源，维护平台的公开透明。
在制造资源交易合约中，MRD 的账户地址“0x5
B38Da6a701c568545dCfcB03FcB875f56beddC4”，账
户金额为 100。MRS 的账户地址“0xAb8483F64d9C
6d1EcF9b849Ae677dD3315835cb2”，出售 50 份制造
资源 m1。双方协商的资源价格 p 为 3。MRD 购买 30
份资源 m1 后，MRD 的账户自动向 MRS 的账户转账
90，并提示“购买成功”，如图 12 所示。若此时，MRD
继续购买 20份制造资源 m1，但此时 MRD的账户余额
仅为 10，不足以购买制造资源，此时合约就会中断交
易的产生，并提示“余额不足，购买失败”，如图 13 所
示。若 MRD 向 MRS 购买制造资源 m2但合约中只有
图 8 测试 1结果
Fig.8 Result of test 1
图 9 测试 2结果
Fig.9 Result of test 2
图 10 测试 3结果
Fig.10 Result of test 3
图 11 测试 4结果
Fig.11 Result of test 4
图 12 交易信息
Fig.12 Transaction information
图 13 交易失败（金额不足）
Fig.13 Transaction failure (insufficient amount)
2306
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
制造资源 m1，则区块链网络将终止交易的执行，如图
14所示，提示“没有相关资源”。
Remix上的实验仿真结果表明，依靠区块链技术
的不可篡改性和可追溯性，将智能合约运用到云制
造平台可以将所有操作记录以交易的形式保存在区
块链中，有效保证交易信息的可靠性和安全性。
4.2 博弈仿真及结果分析
在基于区块链的云制造资源分配框架下，资源
价格受供需影响，MRD 根据生产需求租赁相关制造
资源，MRS根据资源需求量制定相关的供应策略，双
方博弈的最终目的是使自己在对方的策略约束下获
得最大利润。实验使用MATLABR2019b对 3个MRD
和 1个MRS之间的供需博弈进行仿真，价格函数的系
数 a = 0.8 ，b = 0.2 ，本文假设需求量对价格的影响大
于供应量对价格的影响。 X =[100,200,200] , Cd = [45,
45,15] ，C s = [10] 。初始的需求量 Ud = [100,100,100] ，
供应量 V s = [200] 。如图 15 所示，经过 20 次迭代后，
需求量、供应量及资源价格均收敛，表明MRD和MRS
可以达到纳什均衡。将本文提出的制造资源博弈模
型与文献[32]中提出的电网供需博弈模型进行对比，
虽然研究对象不一样，但两者均研究 Stackelberg均衡
收敛问题，因此存在一定的对比研究意义。本文按
照文献 [32]中的参数设置，在 MATLABR2019b 进行
仿真对比，由图 16 可知，本文在迭代 15 次左右接近
收敛，而文献[32]在迭代 35 次才接近收敛，收敛速度
提升 57%左右。
在供需平衡后，MRD3 为获得更高的收益，私自
增加需求量，打破了供需平衡。需求量的增加导致
资源价格上涨，给 MRS 带来更大的利润。同时也增
加了 MRD3 和 MRD2 的购买成本。因此，MRS 希望
通过提高供应量获得更大的收益，而 MRD2和 MRD3
被迫缩减对资源的需求，从而使价格趋于平衡。最
终 3 个 MRD 和 1 个 MRS 回到了原有的供需平衡状
态，如图 17所示。
图 15 供需博弈结果
Fig.15 Game results of supply and demand
图 16 博弈收敛速度对比
Fig.16 Comparison of convergence speed of games
图 17 MRD3需求增加对供需平衡的影响
Fig.17 Impact of MRD3 demand surge on balance
of supply and demand
图 14 交易失败（无资源）
Fig.14 Transaction failure (no resources)
2307
计算机科学与探索
ww
w.c
eaj
.or
g
Journal of Frontiers of Computer Science and Technology 计算机科学与探索 2022, 16(10)
5 结束语
本文主要研究了区块链技术与云制造平台融合
的应用问题，提出了一种基于区块链的云制造资源
分配框架。同时研究了资源需求方和供应方在该去
中心化的框架下的 Stackelberg 供需博弈问题。在该
框架下，云平台的参与方通过区块链网络，使用椭圆
曲线数字签名算法完成资源发布，通过智能合约完
成资源的匹配和交易。通过 Remix 完成智能合约的
测试，结果表明，基于区块链的云平台交易数据能够
被安全地存储在区块链中，且区块链的不可篡改性
可以增强云制造数据的可信度。在多领导者一跟随
者的博弈模型中，制造资源供应方与资源需求方能
够获得纳什均衡。仿真结果表明，该模型的纳什均
衡收敛速度较已有研究有较大的提升，并且具有一
定的鲁棒性。今后将研究区块链在共识算法上的优
化，降低其共识损耗，并探索如何提高其在云制造平
台应用的吞吐量。
参考文献：
[1] REN L, ZHANG L, WANG L H, et al. Cloud manufacturing:
key characteristics and applications[J]. International Journal
of Computer Integrated Manufacturing, 2017, 30(6): 501-515.
[2] TAO F, ZHANG L, LIU Y K, et al. Manufacturing service
management in cloud manufacturing: overview and future
research directions[J]. Journal of Manufacturing Science and
Engineering-Transactions of the ASME, 2015, 137(4): 11.
[3] FULLER A, FAN Z, DAY C, et al. Digital twin: enabling
technologies, challenges and open research[J]. IEEE Access,
2020, 8: 108952-108971.
[4] LIM M K, XIONG W Q, LEI Z M. Theory, supporting tech-
nology and application analysis of cloud manufacturing: a
systematic and comprehensive literature review[J]. Industrial
Management & Data Systems, 2020, 120(8): 1585-1614.
[5] YANG X X, WANG S L, YANG B, et al. A service satis-
faction-based trust evaluation model for cloud manufacturing
[J]. International Journal of Computer Integrated Manufac-
turing, 2019, 32(6): 533-545.
[6] LOU P, YUAN L, HU J, et al. A comprehensive assessment
approach to evaluate the trustworthiness of manufacturing
services in cloud manufacturing environment[J]. IEEE Access,
2018, 6: 30819-30828.
[7] LI B D, YANG Y, SU J F, et al. Two-sided matching model
for complex product manufacturing tasks based on dual hesi-
tant fuzzy preference information[J]. Knowledge-Based Sys-
tems, 2019, 186: 14.
[8] ZHENG H, FENG Y, TAN J. A hybrid energy-aware resource
allocation approach in cloud manufacturing environment[J].
IEEE Access, 2017, 5: 12648-12656.
[9] LIU Z, WANG Z. A novel truthful and fair resource bidding
mechanism for cloud manufacturing[J]. IEEE Access, 2020,
8: 28888-28901.
[10] JIN H, YAO X F, CHEN Y. Correlation-aware QoS mode-
ling and manufacturing cloud service composition[J]. Journal
of Intelligent Manufacturing, 2017, 28(8): 1947-1960.
[11] LI X B, FANG Z W, YIN C. A machine tool matching method
in cloud manufacturing using Markov decision process and
cross-entropy[J]. Robotics and Computer-Integrated Manu-
facturing, 2020, 65: 101968.
[12] 袁勇, 王飞跃. 区块链技术发展现状与展望[J]. 自动化学
报, 2016, 42(4): 481-494.
YUAN Y, WANG F Y. Blockchain: the state of the art and
future trends[J]. Acta Automatica Sinica, 2016, 42(4): 481-494.
[13] 翁晓泳. 基于区块链的云计算数据共享系统研究[J]. 计算
机工程与应用, 2021, 57(3): 120-124.
WENG X Y. Research on blockchain based cloud compu-
ting data sharing system[J]. Computer Engineering and Appli-
cations, 2021, 57(3): 120-124.
[14] 陈飞, 叶春明, 陈涛. 基于区块链的食品溯源系统设计[J].
计算机工程与应用, 2021, 57(2): 60-69.
CHEN F, YE C M, CHEN T. Design of food traceability
system based on blockchain[J]. Computer Engineering and
Applications, 2021, 57(2): 60-69.
[15] 任艳丽, 徐丹婷, 张新鹏, 等. 基于门限环签名的可删除区
块链[J]. 通信学报, 2019, 40(4): 71-82.
REN Y L, XU D T, ZHANG X P, et al. Deletable block-
chain based on threshold ring signature[J]. Journal on Commu-
nications, 2019, 40(4): 71-82.
[16] KASTEN J E. Engineering and manufacturing on the block-
chain: a systematic review[J]. IEEE Engineering Manage-
ment Review, 2020, 48(1): 31-47.
[17] 王飞跃, 张军, 张俊, 等. 工业智联网: 基本概念、关键技术
与核心应用[J]. 自动化学报, 2018, 44(9): 1606-1617.
WANG F Y, ZHANG J, ZHANG J, et al. Industrial internet
of minds: concept, technology and application[J]. Acta Auto-
matica Sinica, 2018, 44(9): 1606-1617.
[18] ZHU X, SHI J, XIE F, et al. Pricing strategy and system per-
formance in a cloud-based manufacturing system built on block-
chain technology[J]. Journal of Intelligent Manufacturing,
2020, 31(8): 1985-2002.
[19] LI R F, CHEN T L, LOU P, et al. Trust mechanism of cloud
manufacturing service platform based on blockchain[C]//Pro-
ceedings of the 11th International Conference on Intelligent
Human-Machine Systems and Cybernetics, Hangzhou, Aug
24-25, 2019. Piscataway: IEEE, 2019: 15-19.
2308
计算机科学与探索
ww
w.c
eaj
.or
g
徐杨杨 等：区块链在云制造资源分配的研究
[20] 王强, 刘长春, 周保茹. 基于区块链的制造服务可信交易
方法[J]. 计算机集成制造系统, 2019, 25(12): 3247-3257.
WANG Q, LIU C C, ZHOU B R. Trusted transaction method
of manufacturing services based on blockchain[J]. Computer
Integrated Manufacturing Systems, 2019, 25(12): 3247-3257.
[21] BARENJI A V, LI Z, WANG W M. Blockchain cloud
manufacturing: shop floor and machine level[C]//Proceedings
of the 2018 European Conference on Smart Objects, Systems
and Technologies, Munich, Jun 12-13, 2018: 1-6.
[22] LI Z, BARENJI A V, HUANG G Q. Toward a blockchain
cloud manufacturing system as a peer to peer distributed
network platform[J]. Robotics and Computer-Integrated Manu-
facturing, 2018, 54: 133-144.
[23] KAYNAK B, KAYNAK S, UYGUN O. Cloud manufactu-
ring architecture based on public blockchain technology[J].
IEEE Access, 2020, 8: 2163-2177.
[24] LI M, HUANG G Q. Blockchain- enabled workflow mana-
gement system for fine-grained resource sharing in e-commerce
logistics[C]//Proceedings of the 15th IEEE International Con-
ference on Automation Science and Engineering, Vancouver,
Aug 22-26, 2019. Piscataway: IEEE, 2019: 751-755.
[25] AGHAMOHAMMADZADEH E, FVALILAI O F. A novel
cloud manufacturing service composition platform enabled
by blockchain technology[J]. International Journal of Produc-
tion Research, 2020, 58(17): 5280-5298.
[26] XINYI Y, YI Z, HE Y. Technical characteristics and model
of blockchain[C]//Proceedings of the 2018 10th International
Conference on Communication Software and Networks,
Chengdu, Jul 6-9, 2018. Piscataway: IEEE, 2018: 562-566.
[27] 欧阳丽炜, 王帅, 袁勇, 等. 智能合约:架构及进展[J]. 自动
化学报, 2019, 45(3): 445-457.
OUYANG L W, WANG S, YUAN Y, et al. Smart contracts:
architecture and research progresses[J]. Acta Automatica Sinica,
2019, 45(3): 445-457.
[28] ZHENG Z B, XIE S, DAI H N, et al. An overview on smart
contracts: challenges, advances and platforms[J]. Future Gene-
ration Computer Systems-the International Journal of Escience,
2020, 105: 475-491.
[29] PAHLAJANI S, KSHIRSAGAR A, PACHGHARE V. Survey
on private blockchain consensus algorithms[C]//Proceedings
of the 2019 1st International Conference on Innovations in
Information and Communication Technology, Chennai, Apr
25-26, 2019. Piscataway: IEEE, 2019: 1-6.
[30] 袁勇, 倪晓春, 曾帅, 等. 区块链共识算法的发展现状与展
望[J]. 自动化学报, 2018, 44(11): 2011-2022.
YUAN Y, NI X C, ZENG S, et al. Blockchain consensus
algorithms: the state of the art and future trends[J]. Acta
Automatica Sinica, 2018, 44(11): 2011-2022.
[31] JIANG Y N, ZHONG Y, GE X H. Smart contract-based data
commodity transactions for industrial internet of things[J].
IEEE Access, 2019, 7: 180856-180866.
[32] MAHARJAN S, ZHU Q, ZHANG Y, et al. Demand res-
ponse management in the smart grid in a large population
regime[J]. IEEE Transactions on Smart Grid, 2016, 7(1):
189-199.
徐杨杨（1996—），男，江苏邳州人，硕士研究
生，主要研究方向为区块链技术及其在云制造
中的应用。
XU Yangyang, born in 1996, M.S. candidate.
His research interests include blockchain and its
application in cloud manufacturing.
王艳（1978—），女，江苏盐城人，博士，教授，博
士生导师，主要研究方向为基于大数据知识自
动化的离散制造能耗网络协同优化。
WANG Yan, born in 1978, Ph.D., professor,
Ph.D. supervisor. Her research interest is collab-
orative optimization of discrete manufacturing en-
ergy consumption network based on big data
knowledge automation.
2309