ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND
CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
Abstract. Nakamoto double spend strategy, described in Bitcoin foundational
article, leads to total ruin with positive probability and does not make sense from the
profitability point of view. The simplest strategy that can be profitable incorporates
a stopping threshold when success is unlikely. We solve and compute the exact
profitability for this strategy. We compute the minimal amount of the double spend
that is profitable. For a given amount of the transaction, we determine the minimal
number of confirmations to be requested by the recipient such that this double spend
strategy is non-profitable. We find that this number of confirmations is only 1 or 2
for average transactions and a small hashrate of the attacker. This is substantially
lower than the original Nakamoto numbers that are widely used and are only based
on the success probability instead of the profitability.
1. Introduction and background
Satoshi Nakamoto’s Bitcoin foundational article [15] describes Bitcoin protocol.
Section 11 contains an analysis of Bitcoin security and estimates the probability of
success of a double spend attack. Unfortunately the strategy proposed has a positive
probability of total ruin for the attacker, hence it cannot be profitable.
The attacker with a relative hashrate 0 < q < 1/2, attemps the double spend by
sending a legitimate transaction and starts mining a secret fork with a conflicting
transaction that invalidates the first one. The recipient requests z ≥ 0 confirmations
of the transaction to consider it definitive. The goal of the attacker is to catch-up
the official blockchain after z confirmations of the original transaction. He will only
succeed with a probability that was computed exactly by the authors in [7], correcting
the original approximate Nakamoto formula given in [15]. If he does not succeed, he
will be stuck for ever catching-up the official blockchain and will go broke. Hence,
for a sound strategy, it is necessary to introduce a “give-up” threshold. If he lags by
A ≥ z behind the official blockchain the attacker gives-up. Now, this A-nakamoto
strategy (the precise definition in section 2) defines an integrable repetition game and
fits in the general mining profitability theory developped by the authors in [8].
2010 Mathematics Subject Classification. 68M01, 60G40, 91A60m 33B20S..
Key words and phrases. Bitcoin, blockchain, proof-of-work, selfish mining, martingale, glambler’s
ruin, random walk.
1
ar
X
iv
:1
91
2.
06
41
2v
1 
 [
cs
.C
R
] 
 1
2 
D
ec
 2
01
9
2 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
According to [8], the profitability is compared using the Revenue Ratio
Γ =
E[R]
E[T]
where R and T are random variables, R is the revenue and T the duration of the
attack. For example, for the honest strategy consisting of mining one block according
to the protocol rules, we have E[RH ] = qb, where b is the coinbase reward, and
E[TH ] = τ0, where τ0 the interblock time1, thus the honest Revenue Ratio is
ΓH =
qb
τ0
To compare the profitability of two full time mining strategies is equivalent to
compare their Revenue Ratios (Proposition 3.6 from section 3 in [8]). Therefore, the
A-nakamoto strategy is profitable if and only if its Revenue Ratio ΓA is higher than
the Revenue Ratio of the honest strategy, ΓA > ΓH .
We give an exact closed-form formula for the probability of success of the attack.
Theorem 1.1. Let 0 < q < 1/2, respectively p = 1 − q, be the relative hashrate of
the attacker, respectively of honest miners. We denote λ = q/p < 1. Let z ≥ 1 be the
number of confirmations requested by the recipient of a transaction. For A ≥ z, the
probability PA(z) of success for the A-Nakamoto double spend attack is
PA(z) =
I4pq(z, 1/2)− λA+1
1− λA+1
where Ix(a, b) is the Regularized Incomplete Beta function
Ix(a, b) =
Γ(a+ b)
Γ(a)Γ(b)
∫ x
0
ta−1(1− t)b−1 dt .
and Γ is Euler Gamma function.
This generalizes the main result from [7] that we obtain taking the limit A→ +∞.
In the formula for PA(z) we have that A+ 1 instead of A because we assume that the
attacker pre-mines one block as it is implicit in Satoshi’s paper (see Section 2 below).
Corollary 1.2 (G.-P.M., 2017). The probability of success of the∞-Nakamoto attack
is
P∞(z) = I4pq(z, 1/2) .
A major Corollary of this result is obtained taking the asymptotics,
1In the current Bitcoin network b = 12.5 B and τ0 = 10 min.
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 3
Corollary 1.3 (G.-P.M., 2017). When z → +∞, we have
P∞(z) ∼ sz√
π(1− s)z
where s = 4pq < 1
This Corollary is important because it proves the profusely cited and “well-known”
result (but nowhere correctly proved before) that this probability decays exponentially
to 0 with the number of confirmations z, hence the probability of a reorganisation of
Bitcoin blockchain decays exponential with the depth. This is a fundamental result
for Bitcoin security.
Observe that PA(z) decreases with A, and PA(z) < limA→+∞ PA(z) = P∞(z) as
expected. We also have when z → +∞
PA(z) ∼ sz√
π(1− s)z
with an asymptotic that is independent of A ≥ z. In the next Theorem we make also
use of the Beta function
B(a, b) =
∫ 1
0
ta−1(1− t)b−1 dt =
Γ(a)Γ(b)
Γ(a+ b)
.
The main result in this article is the computation of the Revenue Ratio ΓA. We
compute exact formulas for E[RA] and E[TA].
Theorem 1.4. With the previous notations, the expected revenue and the expected
duration of the A-Nakamoto double spend strategy is
E[RA]
b
=
qz
2p
I4pq(z, 1/2)− (A+ 1)λA+1
p(1− λ)3[A+ 1]2
I(p−q)2(1/2, z) +
2− λ+ λA+2
(1− λ)2[A+ 1]
pz−1qz
B(z, z)
+ PA(z)
(v
b
+ 1
)
E[TA]
τ0
=
z
2p
I4pq(z, 1/2) +
A+ 1
p(1− λ)2[A+ 1]
I(p−q)2(1/2, z)−
pz−1qz
p(1− λ)B(z, z)
+
1
q
with the notation [n] = 1−λn
1−λ for n ∈ N.
As in the original article [8], and subsequent application to other block withholding
strategies [8], [9], [10], the main tool in the proof of this Theorem are martingale tech-
niques and the application of Doob’s Stopping Time Theorem. Previous techniques
using Markov chains do not allow the computation of the expected duration of the
attack, which is critical for the profitability analysis. The profitability analysis is
4 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
based on attack cycles, modeled by games with repetition, and only holds for inte-
grable games, i.e. those that have finite expectation duration of cycles E[T] < +∞
and allow the application of Doob’s Theorem.
Observe that, all other parameters being fixed, we have the asymptotics when
A→ +∞,
E[TA]
τ0
∼
I(p−q)2(1/2, z)
p− q
A
and
lim
A→+∞
E[RA]
b
=
E[R∞]
b
=
qz
2p
I4pq(z, 1/2) +
2− λ
1− λ
pz−1qz
B(z, z)
+ P∞(z)
(v
b
+ 1
)
In particular we have,
lim
A→∞
E[TA] = E[T∞] = +∞
and
lim
A→∞
E[RA] = E[R∞] < +∞
Hence, in the non-stopping Nakamoto double spend strategy where A = +∞,
we have Γ∞ = 0 and any integrable strategy beats Nakamoto non-stopping strategy.
Moreover, since E[R∞] < +∞ and E[T∞] = +∞ Nakamoto’s strategy leads to almost
sure ruin when considering mining costs.
Another interesting asymptotic is when q → 0, z ≥ 1,
I4pq(z, 1/2) ∼ 2
(
2z − 1
z
)
qz
And if we assume A ≥ 2, A ≥ z ≥ 1,
E[RA]
b
∼
[
2
(
2z − 1
z
)(v
b
+ 1
)
+
2
B(z, z)
]
qz
and
E[TA]
τ0
∼ 1
q
Therefore, we have when q → 0,
ΓA ∼
b
τ0
[
2
(
2z − 1
z
)(v
b
+ 1
)
+
2
B(z, z)
]
qz+1
It is remarkable that this asymptotic is uniform on A. From this we prove the following
practical Corollary. The A-Nakamoto double spend is profitable when ΓA ≥ ΓH and
plugging the asymptotics in this profitability inequality we get,
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 5
Corollary 1.5. When q → 0 the minimal amount to make profitable a Nakamoto
double spend with z ≥ 1 confirmations is asymptotically
v ≥ q−z
2
(
2z−1
z
) b = v0 .
For example, with q = 0.01 and only z = 1 we need to double spend more than
v0/b = 50 coinbases. For the optimal strategy, the minimal spend for these parameters
is v0/b = 49.2513 coinbases as we will see in another article. With the actual reward
of b = 12.5 B and the actual prize of $8.600, this represents more than $5.375.000.
With z = 2 this will be more than 1.666 coinbases or more than more than 179 million
dollar. These figures are far from the general belief. Nevertheless, we should note
that there are sharper strategies and, if ran continuously, we can merge double spend
attacks with other blockwithholding strategies that exploit the difficulty adjustment
formula and this will increase the profitability.
We observe that since ΓA → 0 when A→ +∞, there is a value A0 = A0(q, v, z) ≥ z
that maximizes the revenue ratio:
ΓA0 = max
A≥z
ΓA
Also, limz→+∞ ΓA0 < ΓH , so given the amount of the purchase (in coinbase b units), we
can compute the number z of confirmations that make the A-Nakamoto double spend
attack non-profitable. This is an important data for the vendor or the recipient of the
transaction that can set the number of confirmations z accordingly to our formulas.
We keep the analysis for this simplest strategy as simple as possible. We assume no
difficulty adjustment during the attack, and instant block propagation in the network.
Other more sophysticated strategies, where A ≤ z, with important pre-mining, or the
optimal strategy, or other hybrid strategies wich combine selfish mining and double
spend will be analyzed elsewhere.
The techniques at the core of the results presented in this article are a combination
the techniques developed in [7] and [8].
6 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
2. Nakamoto double spend strategy.
Let z be the number of confirmations required by the merchant and v the value
of a double spend. We fix a maximal lag A ≥ z relative to the public blockchain
after which the attacker gives-up. The relative hashrate of the attacker (resp. honest
miners) is q (resp. p). Apparently Nakamoto in [15] wants to prevent pre-mining
by the attacker but the generation of fresh keys as he proposes does not prevent it.
Also his formulas are only correct pre-mining one block, for example when he states
that the probability is 1 for z = 0 confirmations. The reader can consult [11] for a
discussion on Section 11 of [15]. Pre-mining one block is often named as a “Finney
attack” because of the clarification that H. Finney provided in 2011 (see [5] bitcointalk
post). We can generalize the preparation of the attack by pre-mining an arbitrary
number k of blocks before launching the attack. The precise algorithm employed by
the attacker in this (A, k)-Nakamoto double spend strategy is the following:
(A, k)-Nakamoto double spend strategy
0. Start of the attack cycle (goto 1).
1. The attacker mines honestly on top of the official blockchain k blocks with a
transaction that returns the payment funds to an address he controls (goto 2).
2. If the honest miners take advantage before he pre-mines k blocks, then he
restarts mining on top of the new last block of the official blockchain (goto 1).
3. If he succeeds in pre-mining k blocks lading the honest miners, he keeps his fork
secret, sends the purchasing transaction to the vendor, and keeps up mining
on his secret fork. (goto 4).
4. If the lag with the official blockchain gets larger than A then the attacker
gives-up and the double spend fails (goto 6).
5. If the secret fork of the attacker gets longer than the official blockchain that
has added z confirmations to the vendor transaction, then the attacker releases
his fork and the double spend is successful (goto 6).
6. End of the attack cycle (goto 0).
We assume that at z confirmations the attacker receives the goods from the vendor.
Hence, when the attack is successful, the revenue is v plus all the block rewards. When
the attack fails, the revenue is 0 (we assume that he can recover the original bitcoins
from the purchase). A fundamental observation for the application of the profitability
model is that the cost per unit of time is the same as the cost of mining honestly.
Each time the attacker goes to step 0, he can start a new attack cycle that ends when
he reaches step 6.
We observe that the strategy has three phases:
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 7
• The first phase is a pre-mine phase (steps 1− 2).
• The attacker sends a conflicting transaction to a merchant and mines on his
secret fork until the honest miners have validated z blocks.
• The attacker keeps on mining on his secret fork until his lag is A or his fork
gets longer than the official blockchain.
During the second phase, the attacker’s lag is always less than A since we consider
in this article that we choose A ≥ z. So, the attack cycle cannot terminate before
the end of the second phase. Notice also that there are more general Nakamoto
strategies by changing the algorithm in the pre-mining phase, and the last phase.
The simple (A, 1)-Nakamoto strategy seems to be the closest profitable strategy to
the one described by Nakamoto’s Bitcoin paper and is the one we study in this article.
Furthermore, as we will show, there are simple closed forms formulas for this strategy.
The study of the general (A, k)-Nakamoto strategy is postponed to another article
as well as the general optimal strategy attack.
3. Probability of Success
We use the same notations and mining model from [7]. The number of blocks mined
by the attacker is a Poisson process (N ′(t))t≥0 and Sz is the random variable of the
time taken to the honest miners to mine z blocks. The random variable N ′(Sz) is a
(z, p) negative binomial random variable [7], for j ≥ 0,
P[N ′(Sz) = j] = pzqj
(
z + j − 1
j
)
Recall the basic Euler identity for the Beta function which justifies the Beta distri-
bution,
B(a, b) =
∫ 1
0
ta−1(1− t)b−1 dt =
Γ(a)Γ(b)
Γ(a+ b)
We need a couple more of combinatorial identities stated in the next Lemma.
Lemma 3.1. For integers m ≥ 1 and z ≥ 0, and for p, q > 0 with q = 1 − p, we
have,
m−1∑
j=0
pzqj
(
z + j − 1
j
)
= Ip(z,m)(1)
m−1∑
j=0
pzqj
(
z + j − 1
j
)
· j =
qz
p
Ip(z,m)− pz−1qm
B(z,m)
(2)
8 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
Proof. The first identity is classical (see [2], (6.6.3) and (26.5.26), or [4], (8.17.24),
or [7] section 6). The second equation follows from the first one differentiating with
respect to p,
∂Ip(z,m)
∂p
=
z
p
Ip(z,m)− 1
q
m−1∑
j=0
pzqj
(
z + j − 1
j
)
· j
and observing that
∂Ip(z,m)
∂p
=
pz−1qm−1
B(z,m)
. �
Proposition 3.2. If X is a negative binomial random variable with parameters (p, z),
then we compute,
z−1∑
j=0
P[X = j] = Ip(z, z)(3)
z−1∑
j=0
P[X = j] (q/p)z−j = Iq(z, z)(4)
z−1∑
j=0
P[X = j] · j =
qz
p
Ip(z, z)− pz−1qz
B(z, z)
(5)
z−1∑
j=0
P[X = j] j (q/p)z−j =
pz
q
Iq(z, z)− qz−1pz
B(z, z)
(6)
Proof. Identities (3) and (5) follow from Lemma 3.1. The two other ones follow from
these two using, for j ≥ 0,
pzqj
(
z + j − 1
j
)
(q/p)z−j = qzpj
(
z + j − 1
j
)
which means that P[X = j] (q/p)z−j = P[Y = j] for Y a (q, z)-negative binomial
random variable. �
Note also that (1) and (2) can be restated as
P[X < m] = Ip(z,m)
E[X|X < m] =
qz
p
− pz−1qm
Bp(z,m)
where Bx(a, b) is the incomplete Beta function. Now we prove Theorem 1.1.
Proof of Theorem 1.1. Recall that the attacker has premined one block. So, if he has
added z blocks more to his secret fork during the second phase of the attack, then
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 9
at the end of this phase his secret fork is longer than the official blockchain. In this
case, he publishes his fork and the attack cycle takes end successfully. Otherwise, the
attacker has mined j blocks during the second phase with j < z and he starts a third
phase with a lag of z − j − 1. The evolution of this lag is a biased random walk (Zn)
with a probability p (resp. q) to move to the right (resp. left). The cycle ends when
there is n ∈ N such that Zn = A (the attack cycle fails) or Zn = −1 (the attack cycle
is successful). Hence, according to the gambler’s ruin problem formula (see [1]), and
using formulas (3) and (4) from Corollary 3.2, we have
PA(z) = P[N ′(Sz) > z] +
z−1∑
j=0
P[N ′(Sz) = j]
λz−j − λA+1
1− λA+1
= 1−
z−1∑
j=0
P[N ′(Sz) = j] +
z−1∑
j=0
P[N ′(Sz) = j]
λz−j − λA+1
1− λA+1
= 1−
(
1 +
λA+1
1− λA+1
) z−1∑
j=0
P[N ′(Sz) = j] +
1
1− λA+1
z−1∑
j=0
P[N ′(Sz) = j]λz−j
= 1− Ip(z, z)
1− λA+1
+
Iq(z, z)
1− λA+1
Finally we use the two classical relations for the incomplete regularized beta function:
(7) Ix(a, b) + I1−x(b, a) = 1
for x ∈]0, 1[, a, b ∈ R∗+ and
(8) Iq(z, z) =
1
2
I4pq(z, 1/2)
See for instance [4] (8.17.4) and (8.17.6). �
Figure 1. Graph of q 7→ PA(2), A = 3, 5, 10 and asymptotics A→ +∞
10 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
4. Profitability of the attack.
4.1. Expected cycle duration time. Note that by definition of the strategy in
Section 2, an attack cycle cannot terminate before the attacker has mined one block
(the premined block). So, the duration time of an attack cycle T satisfies T = S′1+T′
where S′1 is the time before the attacker discovers a new block and T′ is the remaining
time of the attack.
Proposition 4.1. We assume that the attacker has already pre-mined one block.
Then, the mean duration time for the end of an attack cycle is
E[T′]
τ0
=
A+ 1
p− q
· 1
1− λA+1
− pz−1qz
(p− q)B(z, z)
+
(
z
p
− 2(A+ 1)
(p− q)(1− λA+1)
)
Iq(z, z)
Proof. We follow the proof of Theorem 1.1. By definition of the strategy, the attack
cycle cannot end before the honest miners have mined z blocks since we consider in
this article that A ≥ z. So, T′ ≥ Sz (the initial date t = 0 is the start of the second
phase). Moreover, T′ = Sz if the attacker has mined z blocks or more during the
second phase of the attack. Otherwise, the attacker tries to build a fork whose length
is greater than the official blockchain, starting with an initial lag of z −N′(Sz) − 1
and gives up if this lag becomes greater or equal than A (third phase of the attack).
So, we have:
T′ = Sz + 1N′(Sz)<z · T̃A+1−(z−N′(Sz)),z−N′(Sz)
with T̃X,Y = Inf {t ∈ R+;
(
Ñ(t) = Ñ′(t) +X
)
∨
(
Ñ′(t) = Ñ(t) + Y
)
} for X, Y ∈ R,
Ñ(t) = N(t+Sz)−N(Sz) and Ñ′(t) = N′(t+Sz)−N′(Sz). By the Markov property,
Ñ and Ñ′ are two Poisson processes with parameters p
τ0
and q
τ0
independent of Sz
and T̃X,Y is also independent of Sz. Moreover, we have:
E[T̃X,Y ]
τ0
=
X + Y
p− q
(
1− λY
1− λX+Y
− Y
X + Y
)
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 11
This computation is classical and can be found in Appendix A of [10] for example
(see Theorem A.1). So, we have using Proposition 3.2 together with (7) and (8),
E[T′]
τ0
= E[Sz] +
z−1∑
j=0
P[N′(Sz) = j] · E[T̃A+1−(z−j),z−j]
=
z
p
+
A+ 1
p− q
(
1
1− λA+1
− z
A+ 1
) z−1∑
j=0
P[N′(Sz) = j]
− A+ 1
p− q
(
1
1− λA+1
) z−1∑
j=0
P[N′(Sz) = j]λz−j
+
1
p− q
z−1∑
j=0
P[N′(Sz) = j] j
=
z
p
+
A+ 1
p− q
(
1
1− λA+1
− z
A+ 1
)
Ip(z, z)− A+ 1
p− q
· 1
1− λA+1
Iq(z, z)
+
1
p− q
(
qz
p
Ip(z, z)− pz−1qz
B(z, z)
)
=
A+ 1
p− q
1
1− λA+1
− pz−1qz
(p− q)B(z, z)
+
(
z
p
− 2(A+ 1)
(p− q)(1− λA+1)
)
Iq(z, z)
�
4.2. Expected revenue by cycle.
Proposition 4.2. The expected revenue per cycle is
E[RA]
b
=
qz
2p
I4pq(z, 1/2)− (A+ 1)λA+1
p(1− λ)3[A+ 1]2
I(p−q)2(1/2, z)+
2− λ+ λA+2
(1− λ)2[A+ 1]
pz−1qz
B(z, z)
+PA(z)(v+1)
with [A+ 1] = 1−λA+1
1−λ
Proof. We will use the following notations. If Z is a biased simple random walk
starting at Z0 = k with a probability p (resp. q) to go right (resp. left), we denote
by νki with i ∈ Z the hitting time of i and νki,j = νki ∧ νkj with j ∈ Z. We also denote
by L(n) the number of steps to the left between 0 and n, that is,
L(n) =
n∑
i=1
1Zi=Zi−1−1.
After the premining phase, the attacker waits for the honest miners to mine z blocks.
Suppose that he has mined j blocks during this second phase. If j ≥ z, then the
attack cycle takes end and the attacker has won the double spend amount v and all
12 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
the j+1 blocks he has mined. Otherwise, there is a third phase. The attack cycle still
goes on and doesn’t end before the attacker has built a fork whose length is greater
than the official blockchain or his lag became greater or equal than A. We denote by
Zn the lag of the attacker plus one at the time when n blocks have been discovered by
the attacker or the honest miners since the start of the third phase. Then, Z0 = z− j
and (Zn)n∈N is a biased simple random walk as above. The attack cycle ends when
there is n such that Zn = 0 or Zn = A+ 1. Therefore, we have:
E[RA]
b
=
∞∑
j=z
P[N′(Sz) = j](j + 1 + v) +
z−1∑
j=0
P[N′(Sz) = j] · P[νz−j0,A+1 = νz−j0 ]
· (j + 1 + v + E[L(νz−j0,A+1)|ν
z−j
0,A+1 = νz−j0 ])
= E[[N′((Sz)]−
z−1∑
j=0
P[N′(Sz) = j]j + PA(z)(v + 1) +
z−1∑
j=0
P[N′(Sz) = j]j · P[νz−j0,A+1 = νz−j0 ]
+
z−1∑
j=0
P[N′(Sz) = j] · P[νz−j0,A+1 = νz−j0 ] · E[L(νz−j0,A+1)|ν
z−j
0,A+1 = νz−j0 ]
Now we use again the classical relation for the gambler’s ruin formula P[νm0,M = νm0 ] =
λm−λM
1−λM (see for instance [1]) and
E[L(νm0,M)|νm0,M = νm0 ]) =
m
2
+
mλm − (2M −m)λM + (2M −m)λM+m −mλ2M
2p(1− λ)(λm − λM)(1− λM)
from [10] (See Corollary 2.5) which is a consequence of Stern’s formula [17]. So, using
Proposition 3.2 we compute,
E[RA]
b
=
qz
p
+ PA(z)(v + 1)
−
(
(2(A+ 1)− z)λA+1 + zλ2(A+1)
2p(1− λ)(1− λA+1)2
+
λA+1
1− λA+1
· z
2
) z−1∑
j=0
P[N′(Sz) = j]
+
(
z + (2(A+ 1)− z)λA+1
2p(1− λ)(1− λA+1)2
+
1
1− λA+1
· z
2
) z−1∑
j=0
P[N′(Sz) = j]λz−j
−
(
1
1− λA+1
+
λA+1 − λ2(A+1)
2p(1− λ)(1− λA+1)2
− λA+1
1− λA+1
· 1
2
) z−1∑
j=0
P[N′(Sz) = j]j
+
(
1
1− λA+1
− 1− λA+1
2p(1− λ)(1− λA+1)2
− 1
1− λA+1
· 1
2
) z−1∑
j=0
P[N′(Sz) = j]jλz−j
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 13
and
E[RA]
b
=
qz
p
+ PA(z)(v + 1)−
λA+1
(
A+ 1− q(1− λA+1)z
)
p(1− λ)(1− λA+1)2
Ip(z, z)
+
(A+ 1)λA+1 + p(1− λA+1)z
p(1− λ)(1− λA+1)2
Iq(z, z)
− p− q + qλA+1
p(1− λ)(1− λA+1)
(
qz
p
Ip(z, z)− pz−1qz
B(z, z)
)
− λ
(1− λ)(1− λA+1)
(
pz
q
Iq(z, z)− qz−1pz
B(z, z)
)
We note that
λA+1
(
A+ 1− q(1− λA+1)z
)
p(1− λ)(1− λA+1)2
+
p− q + qλA+1
p(1− λ)(1− λA+1)
· λz = λz +
(A+ 1)λA+1
p(1− λ)(1− λA+1)2
So, using again (7) and (8), we get
E[RA]
b
=
(
1
2
λz +
(A+ 1)λA+1
p(1− λ)(1− λA+1)2
)
I4pq(z,
1
2
) + PA(z)(v + 1)
− (A+ 1)λA+1
p(1− λ)(1− λA+1)2
+
2− λ+ λA+2
(1− λ)(1− λA+1)
pz−1qz
B(z, z)
�
In Figures 2 and 3 we plot the graphs of q 7→ E[RA] and q 7→ ΓA In figure 3 ΓH
is the dashed line. We have limq→0.5 Γ10(q) = 139
286
< 1
2
and Γ10(q) < q for any q.
So, (10, 1)-Nakamoto Double Spend strategy with z = 2 and v = b is always less
profitable than honest mining.
Figure 2. Graph of q 7→ E[RA] with z = 2 and v = b for A = 3, 5, 10.
14 CYRIL GRUNSPAN AND RICARDO PÉREZ-MARCO
Figure 3. Graph of q 7→ ΓA, z = 2, v = b for A = 3, 5, 10.
5. Related work
In [16] the author proposes the correct formula for the computation of the proba-
bility of success of the Nakamoto double spend attack from [15], which is proved and
computed in closed-form using special functions in [7]. As Corollary of this closed-
form formula, it is proved in [7] that the probability decays exponentially to 0 with
the number of confirmations z → +∞. In [12] asymptotics at higher orders are com-
puted by more combinatorical methods (classical also from the integral expression in
[7]). Also, in this article, the authors have some discussion of the initial assumptions
of the Nakamoto double spend strategy. It is true that Section 11 of [15] contains
several incoherences (we have written a detailed discussion on Section 11 of [15] in
[11]). All authors consider z to be the number of confirmations, which assumes a 1
block pre-mining (see [16], [13] or [7]). In [15], the authors look for the best security
protocol that a merchant should adopt to counter a double spend attack. They con-
sider attacks long enough to have an impact on the difficulty adjustment parameter.
They also propose to merge double spend attacks with selfish mining or other blocks
witholding strategies (it is proven in [8] that these attacks are profitable on the long
term after an adjustment of the difficulty parameter). All these articles only consider
the double spend attack from the point of view of probabilities. The duration time
of the attack is considered in [11]. The author computes the conditional probability
density function of the time before an attacker catches up the honest miner knowing
that the honest miners have already mined z blocks. In [13], the authors introduce a
profitability setup and look for the optimal number of blocks that an attacker should
pre-mine before launching a double spend attack. We will answer this question in
a forthcoming article. In [3], the authors study the profitability of a double-spend
attack with a cut-off time strategy, Sz+1 ∧S ′z+1 (in our notation). In [14] the authors
consider a fixed cut-off time (in case of failure, the attack ends at a fixed time).
ON PROFITABILITY OF NAKAMOTO DOUBLE SPEND 15
What was lacking in the literature is a rigorous model of profitability to make exact
comparisation of profitabilities of different mining strategies, in particular with the
honest strategy, as done in [8]. This is what we provide in the present article.
References
[1] W. Feller.An introduction to probability theory and its applications, 2nd edition, Wiley, 1971.
[2] M. Abramovitch & I.A. Stegun (1970). Hanbook of Mathematical Functions, Dover, NY, 1970.
[3] G. Bissias and B.N. Levine and A.P. Ozisik and G. Andresen. An Analysis of Attacks on
Blockchain Consensus, arXiv:1610.07985, 2016.
[4] DLMF. Digital Library of Mathematical Functions, dlmf.nist.gov, 2018.
[5] H. Finney.Best practice for fast transaction acceptance - how high is the risk?, Bitcointalk.org
post, https://bitcointalk.org/index.php?topic=3441.msg48384# msg48384, 2011.
[6] P-O. Goffard. Fraud risk assessment within blockchain transactions, Advances in Applied Prob-
ability, Vol. 51, 2019.
[7] C. Grunspan and R. Pérez-Marco. Double spend races, International Journal of Theoretical and
Applied Finance, Vol. 21, 2018.
[8] C. Grunspan and R. Pérez-Marco. On profitability of Selfish Mining, arXiv:1805.08281, 2018.
[9] C. Grunspan and R. Pérez-Marco. On profitability of Stubborn Mining, arXiv:1808.01041, 2018.
[10] C. Grunspan and R. Pérez-Marco. On profitability of Trailing Mining, arXiv:1811.09322, 2018.
[11] C. Grunspan and R. Pérez-Marco. Commentary on Section 11 of Bitcoin paper, , 2019.
[12] E. Georgiadis and D. Zeilberger. A combinatorial-probabilistic analysis of bitcoin attacks, Jour-
nal of Difference Equations and Applications, Vol. 25, 2019.
[13] J. Hinz and P. Taylor. A Note on Optimal Double Spending Attacks, MATRIX Annals, 2, 2017.
[14] J. Jang and H-N. Lee. Profitable double-spending attacks, arXiv:1903.01711, 2019.
[15] S. Nakamoto. Bitcoin: a peer-to-peer electronic cash system, Bitcoin.org, 2008.
[15] Y. Sompolinsky and A. Zohar; Bitcoins security model revisited, ArXiv: 1605.09193, 2016.
[16] M. Rosenfeld. Analysis of hashrate-based double spending, ArXiv 1402.2009v1, 2014.
[17] F. Stern.Conditional expectation of the duration in the classical ruin problem, Mathematics
Magazine, 48, 4, p. 200-203, 1975.
Léonard de Vinci, Pôle Univ., Research Center, Paris-La Défense, France
E-mail address: cyril.grunspan@devinci.fr
CNRS, IMJ-PRG, Paris, France
E-mail address: ricardo.perez.marco@gmail.com
Author’s Bitcoin Beer Address (ABBA)2: 1KrqVxqQFyUY9WuWcR5EHGVvhCS841LPLn
2Send some anonymous and moderate satoshis to support our research at the pub.
http://arxiv.org/abs/1610.07985
http://arxiv.org/abs/1805.08281
http://arxiv.org/abs/1808.01041
http://arxiv.org/abs/1811.09322
http://arxiv.org/abs/1903.01711
	1. Introduction and background
	2. Nakamoto double spend strategy.
	3. Probability of Success
	4. Profitability of the attack.
	4.1. Expected cycle duration time.
	4.2. Expected revenue by cycle.
	5. Related work
	References