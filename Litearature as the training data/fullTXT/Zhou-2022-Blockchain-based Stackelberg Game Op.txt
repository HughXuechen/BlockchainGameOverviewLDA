a78bc423-b2ba-488e-897a-6ddfff488466
第 46卷 第 1期 2022年 1月 10日 Vol. 46 No. 1 Jan. 10，2022
http：//www.aeps-info.com
基于区块链的多虚拟电厂主从博弈优化运行
周步祥，张 越，臧天磊，曹 强，张远洪，彭昊宇
（四川大学电气工程学院，四川省成都市 610065）
摘要：在未来以新能源为主体的新型电力系统中，多虚拟电厂的能源管理将更加复杂和具有挑战
性。考虑到区块链技术信息安全、机制透明、区域共治的特点，从虚拟电厂的功能特征出发，创建由
商业链、技术链和资产链组成的区块链。综合考虑多虚拟电厂形成的多决策主体利益关联与冲突
的局面，建立了考虑网络安全约束的多虚拟电厂主从博弈优化运行方法。在此基础上，研究了区块
链技术下的多虚拟电厂优化运行模式，从网络层级框架、交互机制、智能合约和激励机制等方面进
行了设计。最后,通过算例仿真验证了所提方法的有效性。
关键词：多虚拟电厂；Stackelberg博弈；网络安全约束；区块链技术；运行模式
0 引言
在国家双碳目标下，高比例可再生能源将成为
电网的新形态。风、光等可再生能源丰富，但在时间
和空间分布上存在不均衡性、间歇性和波动性［1］。
虚拟电厂（VPP）可以协调控制分布式能源（DG），
依托互联电力系统大范围配置，实现新能源的高效
开发利用［2］。
近年来，国内外学者从多VPP决策主体存在利
益关联与冲突的角度出发，在优化调度［3-4］、市场竞
价［5-6］等方面做了探索，然而上述研究未考虑多利益
主体、多元化交易间复杂错综的博弈行为。基于此，
文献［7-8］分别引入非合作动态博弈和无限重复博
弈探讨市场电量交互问题，却忽略了各VPP与运营
中心之间对于电价的交互竞争性行为。因此，用于
分析主从递阶动态情况的主从博弈模型逐渐应用于
该领域。文献［9］提出双层协调优化模型，上层建立
多 VPP博弈竞价模型，制定直接交易电量策略，下
层考虑各 VPP总成本最低得到的最优响应功率。
文献［10］建立配电运营商为领导者的主从博弈模
型，根据动态定价合理安排内部各 DG出力。然而，
这些博弈模型未充分考虑 VPP内部柔性资源的特
性，且仅从商业型 VPP角度出发，未从技术层面考
虑VPP对配电网的影响。事实上，经济优化的最优
策略可能会对本地网络安全运行造成危害。因此，
如何以博弈电价为激励手段提升各 VPP能源需求
响应并保证系统安全运行，有待进一步研究。
主从博弈是剖析决策者与响应者之间多层次决
策过程的有效模型［11］，但在多VPP中的实施面临获
取全局信息不足、集中决策耗时长、决策主体信任不
高等问题。区块链技术的分布式分类账、数据共享、
智能决策、信息安全等特性为解决该问题提供了新
思路［12］。同时，区块链的网络结构和多 VPP的 DG
系统高度一致，为多VPP的物理实体之间提供了新
的数据交互和信息安全传输路径。目前，区块链技
术在能源系统的分布式优化管理方面的应用已有部
分研究［13-15］，本文在此基础上，探讨区块链技术在多
VPP主从博弈优化运行模式中的应用，主要工作和
贡献如下。
1）引入多VPP运营商（MVPPO）的角色设计了
多区域VPP的主从博弈架构，将经济运行与削峰响
应结合，并考虑各 VPP本地网络的安全约束，提出
了计及本地网络安全约束下的多 VPP两阶段主从
博弈优化运行方法。
2）设计了对应区块链不同功能的网络节点以
及资产链（asset chain）、技术链（technical chain）和商
业链（commercial chain）组成的区块链群。使各节
点共同参与系统运行控制，并实现个体决策之间高
效、准确的信息交互与共享。
3）将考虑电价机制和网络安全约束的多 VPP
主从博弈与区块链技术下的多VPP协调运行融合，
形成多区域VPP的区块链群交互运行机制，并设计
了利用共识机制、智能合约和激励机制实现区块链
群参与电力市场竞争以及执行网络安全的方案。
DOI：10. 7500/AEPS20210303008
收稿日期：2021-03-03；修回日期：2021-07-07。
上网日期：2021-09-07。
国家自然科学基金资助项目（51907097）；四川省科技厅计划
项目（2020JDRC0049）。
155
2022，46（1） ·学术研究·
1 计及网络安全约束的多区域 VPP主从博
弈联合优化
1. 1 多区域VPP管理架构和互动机制
本文研究的多区域 VPP运营优化框架如图 1
所示。
相互协作的各 VPP运营商（VPPO）负责管理
DG、负 荷 聚 合 商（LA）和 储 能 运 营 商（ESO），使
VPP作为一主体对外参与电力市场交易和安全运
营，对内聚合自身服务范围内的灵活性资源，促进系
统能量供需平衡，并通过能源价差获得收益。考虑
到多 VPP在商业型和技术型两大功能板块所涉及
的多主体主从博弈和系统网络安全问题，本文构建
MVPPO代替配电运营商。MVPPO一方面通过构
建与各 VPP的主从博弈模型，优化与 VPP间的电
量交互，同时根据多 VPP的能源交易平衡情况，与
电力市场进行交易，利用两者之间的差价来获取利
益；另一方面，为保证配电网安全稳定运行，根据物
理限制管理VPP系统的最佳安全运行，确保调控计
划的技术可行性。
DG作为源侧，通过分布式风电、微型燃气轮机
等微源设备为 VPP内外提供稳定可靠的电力。LA
包括固定负荷、可平移负荷以及可削减负荷等，通过
有偿调节用能行为参与互动响应，充分调动了可控
负荷的积极性。ESO是VPP内的存储系统，一般包
括常规分布式储能、抽水蓄能和电动汽车等，通过充
放电来补偿分布式发电出力波动性和不可控性，增
强系统接纳分布式能源发电的能力和提高能源利用
效率［15］，本文则以蓄电池为例进行一般化建模。
1. 2 多区域VPP的两阶段主从博弈决策过程
多区域 VPP系统的主从博弈决策机制可分为
ESO滚动优化和多区域VPP主从博弈两个阶段，两
者存在顺序衔接关系，交互迭代。
阶段 1：根据未来 24 h的内部购售电价、负荷需
求、新能源出力预测，以未来 KΔt（K为滚动优化长
度，Δt为优化步长）时段内各 VPP的净效益最大为
优化目标，滚动优化 ESO的充放电行为并初步确定
各VPP在下一阶段里参与能量交互的角色。
阶段 2：基于阶段 1所确定的 VPP参与电能交
易的角色、ESO的充放电计划，调整各新能源出力
预测、负荷范围，构建多主体主从博弈模型［16］，根据
优化的内部购售电价和削峰填谷单价调整系统内部
需求响应与能源设备出力，达到促进群内能源交易、
提升各VPP经济效益的目的。
1. 2. 1 ESO滚动优化模型
选取风电预测值作为基准场景，以未来 KΔt时
段内各VPP的净效益最大为优化目标，优化目标函
数为：
{Zk，t= C F
k，t- C ES
k，t + fk，t
max Zk，t= ∑
t= R
t+ KΔt
Zk，t
（1）
ì
í
î
ï
ï
ï
ï
C F
k，t= λvbt P s
k，t- λvst P b
k，t
C ES
k，t = cche P ch
k，t- cdise P dis
k，t
fk，t= νeP l
k，t-
α e
2 ( P
l
k，t )2 + ∑
h∈H
λ e ( ΔP s
k，h+ΔP c
k，h ) Δh
（2）
式中：Zk，t 为第 k个 VPP在 t时段的净运行效益；C F
k，t
和 C ES
k，t 分别为 t时段第 k个 VPP的电能交易效益和
储能系统的充放电成本；fk，t 为 t时段第 k个 VPP的
用户的效用函数，用来描述用户购电获得的满意程
度，有二次型函数和对数型函数等形式［17］，本文采
用二次型函数来表示；λvbt 和 λvst 分别为 t时段多 VPP
的内部预测购、售电价；P s
k，t和 P b
k，t分别为 t时段第 k
个 VPP的售电量、购电量；cche 和 cdise 分别为 t时段
ESO充、放电成本系数；P ch
k，t和 P dis
k，t 分别为 t时段第 k
个 VPP的 ESO的充、放电功率；νe为用户消费电能
所获得的满意度系数；α e为一个给定的正参数，反映
用户对消费电能的偏好程度；H和 λ e分别为 t时段响
应时间的集合和削峰填谷单价；P l
k，t为 t时段第 k个
VPP的预测电负荷需求量；R为任意时刻；Δh为响
应的时间长度；ΔP s
k，h和 ΔP c
k，h分别为在 h时刻上报的
可平移电负荷和可削减电负荷。
第 1阶段目标函数需要满足的等式、不等式约
束条件主要包括电功率平衡约束、VPP与MVPPO
VPP 1
��� ����
DG LA ESO
���� 440)
�;�*�D9
��&!D�
*��� DF*4
K
0
)
*
�
�
�
B
*�
��
=�
��
VPP 2
VPP 2
VPP N�
�
�
6F"��"
;�*�D9
��
��B8
	�/B8
	��B8
9*!
��"
��
图 1 多VPP系统运营管理架构
Fig. 1 Operation management structure of
multi-VPP system
156
周步祥，等 基于区块链的多虚拟电厂主从博弈优化运行
http：//www.aeps-info.com
之间交互功率约束、ESO 约束等，具体见附录 A
式（A1）。
1. 2. 2 多区域VPP主从博弈优化模型
MVPPO和VPPO的目标函数是使各自效益最
大化，MVPPO是设定内部购售电价的领导者，而
VPPO则是作为跟随者接收价格信号进而决策需求
响应以及设备出力。
1）MVPPO效益模型
阶段 2时，MVPPO在考虑供电 VPP（D s
k，t= 1）
多余的能量和用电 VPP（D b
k，t= 1）额外负荷需求的
基础上制定多 VPP内部的购售电价，目标函数表
示为：
max ZMVPPO，t= C sell
t - C buy
t - C grid
t - C b
t （3）
ì
í
î
ï
ï
ï
ï
ïï
ï
ï
ï
ï
ï
ï
ïï
ï
ï
C sell
t = λvst ∑P b
k，t
C buy
t = λvbt ∑P s
k，t
C grid
t =max ( )∑P b
k，t - ∑P s
k，t，0 λgst +
min ( )∑P b
k，t - ∑P s
k，t，0 λgbt
C b
t = ∑
k= 1
N
∑
h∈H
λ e ( ΔP s
k，h+ΔP c
k，h ) Δh
（4）
式中：ZMVPPO，t 为 MVPPO在第 t时段内的总效益；
C sell
t 为第 t时段向用电 VPP的售电收入；C buy
t 为第 t
时段向供电 VPP的购电成本；C grid
t 为电力市场的交
互成本，当其大于 0时表示向电力市场购电，否则表
示向电力市场售电；λgbt 和 λgst 分别为 t时段电力市场
的购、售电价；C b
t 为支付给 VPP的削峰补偿；N为
VPP数量。
此外，MVPPO模型还需满足内部博弈价格与
市场交易价格的约束关系，具体见附录A式（A2）。
2）VPPO模型
根据式（1）和式（3），VPPO在MVPPO给定内
部购售电价基础上，优化VPP内微型燃气轮机的出
力和需求响应，其效用函数为：
max Zk，t= C F
k，t- C ES
k，t- C B
k，t+ fk，t （5）
ì
í
î
ï
ï
ïï
ï
ï
ïï
C F
k，t= λvbt P s
k，t- λvst P b
k，t
C ES
k，t = cche P ch
k，t- cdise P dis
k，t
C B
k，t= a e ( P mt
k，t )2 + b eP mt
k，t+ ce
fk，t= νeP l
k，t-
α e
2 ( P
l
k，t )2 + ∑
h∈H
λ e ( ΔP s
k，h+ΔP c
k，h ) Δh
（6）
式中：C B
k，t为燃气机组的燃料成本；a e、b e、ce为燃气机
组的成本系数；P mt
k，t为 t时段第 k个 VPP的微型燃气
轮机输出功率。MVPPO在 t时刻需满足的约束条
件见附录A式（A3）。
1. 3 本地网络安全约束下的多VPP优化运行
基于两阶段主从博弈决策模型，得出了多 VPP
在经济效益上的最优竞价以及能量管理方案。为保
证电网的安全运行，还须以各地网络的安全条件为
基础进行安全验证。为此，本节从技术型VPP模式
出发，结合本地网络约束条件，建立多 VPP优化运
行方法。
VPP的技术型运行方式需要考虑内部各节点
之间的线路功率传输约束，其支路的潮流形式［6］为：
PI，i，t= ∑
j∈N ( i )
[ gijV 2
i，t- Vi，tV j，t ( gij cos θij，t+
bij sin θij，t ) ]= PDG，i，t- PD，i，t （7）
QI，i，t= ∑
j∈N ( i )
[ -bijV 2
i，t+ Vi，tV j，t ( bij cos θij，t-
gij sin θij，t ) ]= QDG，i，t- QD，i，t （8）
式中：PI，i，t 和 QI，i，t 分别为 t时刻支路 I节点 i的注入
有功和无功功率；gij和 bij分别为支路 ij的电导和电
纳；θij，t 为 t时刻节点 i和节点 j电压间的相角差；
N ( i )为所有与节点 i相连的节点集合；Vi，t为 t时刻
节点 i的电压幅值；PDG，i，t和 QDG，i，t分别为 t时刻节点
i接入的分布式电源的有功、无功出力；PD，i，t和 QD，i，t
分别为 t时刻节点 i所接负荷的有功、无功功率。
此外，还需要考虑网络有功功率的损耗 PLoss，t以
及电压偏差量 PDev，t。
PLoss，t=
1
2 ∑j∈N ( i )
(Vi，t- Vj，t )2
Rij
（9）
PDev，t= ∑
i= 1
M 1 (Vi，t- V o )2
M 1
（10）
式中：Vi，t- Vj，t 为支路电压差；Rij 为支路阻抗；V o
为参考节点的电压；M1为VPP的节点总数。
网络安全运行的功率传输需满足的约束如下。
-PI，max，t< PI，i，t< PI，max，t I= 1，2，⋯，M 2 （11）
式中：PI，max，t为 t时刻支路 I节点 i的最大注入有功功
率；M2为 VPP中支路总数。若通过支路 I的潮流满
足式（11）的约束，则完成网络安全验证，并执行经济
最优策略计划；若不满足，则需要进行阻塞管理措
施。首先，计算支路 I上的潮流变化灵敏度 aP，I，i 和
aQ，I，i，灵敏度的求解过程见文献［18］。其次，计算所
需的修正值 ΔPI，t。
ΔPI，t= PI，max，t- PI，i，t （12）
根据上述计算，在考虑以下约束的情况下进一
步对资源进行调整，即在节点 i处调整其有功功率
ΔPi和无功功率 ΔQi使式（13）成立。
∑
i= 1
M 1
( aP，I，iΔPi+ aQ，I，iΔQi )= ΔPI，t （13）
157
2022，46（1） ·学术研究·
2 区块链技术下多区域 VPP主从博弈优化
管理模式设计
2. 1 区块链技术在多区域 VPP主从博弈优化运行
中的应用功能与优势
上文从博弈论和安全约束的视角给出了集群化
VPP的优化管理方案。博弈过程进行的前提是参
与者需要获取其他参与者的信息和最新的设备资产
信息（DG、LA、ESO等）。面对日渐增加的资产系
统，区块链技术中低成本、高效率、扩展性强的数据
存储管理功能，可为多VPP主从博弈过程和安全运
行提供数据支持和去中心化管理。
考虑本地网络安全约束的管理将出现频繁的分
散式双向电力和数据通信，区块链通信链路技术的
去中心化、加密传输可以实现个体之间高效、准确、
全局的信息交互与共享［19］。同时，区块链分布式拓
扑结构与多VPP分散式发展趋势一致，有助于解决
集中系统可扩展性不强和兼容性差的问题。
博弈均衡和网络约束管理是所有 VPP通过与
MVPPO多次迭代后达成的最优策略组合，对应于
区块链网络各节点通过分布式计算确保最优方案成
链，该转化一定程度上实现了弱中心化的“共治”思
想［20］。其中，区块链技术利用共识机制进行分布式
决策，利用智能合约安全、自动地完成多 VPP的优
化运行，利用激励机制促进各VPP单元积极参与系
统调控响应的技术特征，可实现网络中各VPP节点
进行自主管理。
综上所述，在计及网络安全约束的多VPP主从
博弈优化运行中应用区块链技术，是相互补充的有
益尝试。
2. 2 基于区块链的多VPP网络架构
区块链与多VPP具有相似的拓扑形态，可从两
者的技术融合角度出发，将区块链架构和节点映射
到多 VPP的运行模式和功能实体，构建了如图 2所
示的多 VPP系统的区块链体系架构。构建节点
MVPPO（物理实体为MVPPO）作为区块链网络中
的虚拟节点，将VPP 1至VPP N作为区块链网络主
节点，主节点包含了 VPPO以及分布式能源等设
备。VPP内的物理实体单元如 DG、LA、ESO等，则
以分节点的身份分散在区块链网络空间中。针对网
络中虚拟节点、物理节点的功能分类如下。
1）虚拟节点（MVPPO）：全面监控多区域 VPP
系统的网络状态。
2）网络主节点（VPP N）：连接网络中其他主节
点，拥有完整的边缘计算、读取能力，具有计费和结
算、查询和验证等区块链功能［21］。
3）网络分节点（物理实体如 DG、LA等各类资
产）：在计算和读取能力上与主节点类似，可以处理
相关实体的测量和控制数据，并将其提供给系统进
行共享。
如图 2所示，区块链架构的感知层里，分散式节
点通过不同类型的传感器、智能电表等收集和预处
理基础数据；感知层所获得的数据，将通过固件层、
合约层、应用层所提供的加密技术、分布式计算、共
识机制等区块链技术组成资产链、商业链和技术链
的区块链群。资产链将各VPP的分布式资产信息、
可调配资源容量、调配时间段、所处地域等信息进行
能源认证后写入区块链，为商业链和技术链的实现
提供数据存储和运算基础；商业链完成交易价格的
制定，编制交易合同，进而参与电力市场交易；技术
链则提供网络状态估计，确保多区域VPP中能量的
稳定传输与调度。
2. 3 多区域VPP的区块链群交互运行机制
为了高效整合网络中VPP节点数据，提高分布
式能源系统的数据同步和共享能力，满足高并发交
易以及技术验证业务的快速操作，本文设计资产链
进行能源认证以及商业链进行证书交易。首先各
VPP基于阶段 1确定 VPP属于“少电”还是“多电”
状态。决定参与多 VPP主从博弈优化的不平衡
VPP将其电力信息、所处地域以及效用价值提交给
MVPPO，通过筛选验证后加入多区域 VPP的区块
链网络成为VPP N。
MVPPO通过与各 VPP节点之间的博弈，形成
�-�
VPP 1
����
/�@@
B���J
���J
����J
���
A�24
��0*
$���
	3� �*�
MVPPO
���
*�����
Raft�@
���
3"��
���
D=A�
� � �
����
��0)
�6*=�����
VPP N
�6*=�����
图 2 多VPP系统的区块链体系架构
Fig. 2 Blockchain architecture of multi-VPP system
158
周步祥，等 基于区块链的多虚拟电厂主从博弈优化运行
http：//www.aeps-info.com
各自经济利益最大的动态定价和能量管理方案，达
到 Stackelberg均衡，详见 1.2节。由多 VPP的区块
链架构组成可知，节点数有限且具有一定的可信度，
故可采用 Raft共识机制选取出主记账节点。主记账
节点将 Stackelberg均衡打包生成区块，在收到超过
半数节点回复后，主记账点发送确认信息给跟随节
点，并将该区块作为资产链上的下一个区块，跟随者
节点随即完成日志复制过程。同时，借助MVPPO
的天然优势，引入其作为监督节点，解决 Raft共识不
能对抗拜占庭恶意行为的问题。
然后，各节点开启对均衡策略的技术验证与管
理。结合网络状态、约束等，通过安全分析的潮流计
算以验证策略是否违反系统安全约束，若满足则启
动电力交易流程，若不满足则进行阻塞缓解服务，详
见 1.3节。各VPP节点发出的本地验证情况还需经
过MVPPO节点的认证及协调，故技术链采用权威
证明（proof of authority）共识机制，由MVPPO发布
调整区块信息。
经过技术链系统的验证及调整，资产链的方案
将会重新调整成块，完成能源认证。各VPP开始确
定交易计划，确定实时市场交易后，最终将参与交易
的 VPP所需记录的数据行为作为商业链单次区块
记录的内容，仅仅维护VPP是否发生过该次交易的
行为。按照此思想，本文设计了基于商业链和资产
链的证书交易模式，交易行为（VPP的证书条目索
引）根据规则生成 Hash值，Hash值及其所处列表索
引通过 Raft共识机制存储到商业链中，其证书条目
索引则锚定到资产链中对应的位置。该模式有助于
提高多 VPP数据验证及单位时间所能处理交易的
上限。
2. 4 基于联合二次规划的遗传算法（GA-QP）的区
块链边缘计算的改进算法
1.2节所述的 Stackelberg纳什均衡存在的证明
过程详见附录 B，考虑到两阶段中的决策问题均属
于大规模非线性优化问题，采用遗传算法可以实现
结果准确的前提下的算法简化。鉴于跟随者的优化
目标是二次函数，可以采用二次规划的方法求解。
因此本文采用 GA-QP［22］来搜索 Stackelberg最优均
衡策略，具体求解步骤见附录 C。
通过上述计算可以得出经济最优策略，然后利
用各 VPP的潮流计算进一步验证最优策略的可行
性，再根据约束进行调整。在 Stackelberg均衡迭代
以及潮流计算过程中，由于涉及主 -从 -主这样的递
阶关系，供电网络拓扑结构复杂，使得集中式计算占
用了大部分计算资源，影响了求解效率。因此，利用
区块链节点的边缘计算能力［23］，各VPP节点进行分
布式并行计算，进而在文中搭建的基于联盟链的区
块链群中通过相应的共识机制成链。
2. 5 智能合约及激励机制设计
区块链技术中的智能合约，可以按规则在线上
执 行 简 单 的 逻 辑 代 码 ，实 现 实 时 决 策 响 应 的 效
果［24］。为实现区块链群参与多 VPP主从博弈节点
的高效自动协同运行，将资产链、商业链和技术链的
交 互 过 程 编 写 成 智 能 合 约 。 上 一 阶 段 结 束 后 ，
MVPPO聚集报名参与下一阶段的 VPP并触发智
能合约的执行代码。基于智能合约的多 VPP主从
博弈优化实现流程包括 Stackelberg博弈过程、本地
网络状态估计、证书交易过程以及激励分配这四个
环节。
该智能合约流程：1）数据上传阶段，各 VPP上
报下一时段 DG预测、ESO调度计划、交易角色及
LA波动范围；2）博弈优化决策阶段，生成优化目标
函数，多次迭代优化运算，输出全局最优策略；3）网
络安全优化，VPP节点对博弈均衡解根据网络安全
约束进行验证及调整，得到调整后的决策方案；4）能
源认证阶段，每个 VPP供电或用电信息，所处地址
及博弈电价等信息将以证书索引的形式记录在资产
链中；5）证书交易阶段，各 VPP以证书索引的形式
参与市场，交易达成后，交易行为写入商业链；6）激
励结算分配，利用智能合约自动指导激励分配，各
VPP节点通过竞争博弈效用最大化以及削峰填谷
经济补偿获取高效用奖励，该奖励可获得在VPP报
名区块链网络时的优先权。
3 仿真算例
3. 1 算例系统数据
为验证上述模型，搭建了包含 3个 VPP的应用
场景，风电机组出力和负荷预测的相关数据见文献
［10］。储能系统的额定容量为 4 MW·h，最大允许
充放电功率为 2 MW，充电费用系数和放电收益系
数均为 518元/（MW·h），充放电效率分别为 0.85和
0.90。微型燃气轮机的参数特性见附录D，阶段 1的
多区域 VPP内部购售电价取电力市场分时电价为
参考，具体见文献［25］。需求侧的满意度系数 v e、α e
分别为 6.0、1.5。算例优化周期为 1 d，以 1 h为优化
步长，将滚动优化长度设置为 4 h。
3. 2 阶段 1的 ESO滚动优化结果
阶段 1优化 ESO的充放电行为如图 3所示。由
于风电的反调峰特性，风电出力与负荷需求往往存
在较大偏差，00：00—08：00、11：00—16：00时段内
风电出力相对较大时，储能系统处于充电状态，有效
消纳部分可再生能源，并在负荷需求量大的时候释
159
2022，46（1） ·学术研究·
放能量，降低该时段的用电成本；而在 16：00—
24：00、08：00—16：00时段，荷电状态达到了极限，
风电出力抑或需求侧用电仍存在盈余或者短缺的情
况，储能系统已经不能再进一步进行调节。
3. 3 区块链技术下多VPP优化运行结果
选用 4台配置为 Intel i7-9700 CPU、32 G内存、
1 TB固态硬盘、CentOS 7.3操作系统的台式机为实
验载体，利用 Docker容器作为Hyperledger Fabric的
运行环境，启动 4个 Docker容器作为虚拟机运行基
础环境，其中有 3个运行节点（VPP）和一个监督节
点（MVPPO），采用 fabric-chaincode-java编写智能
合约。
3. 3. 1 多区域VPP主从博弈优化结果
基于阶段 1的优化结果，不平衡的 VPP加入区
块链网络，参与到多区域VPP的主从博弈优化运行
中，博弈结果分析如下。
合约算法中设置群体规模为 60，经过 100次迭
代后，结果达到收敛。图 4为输出的博弈最优定价
策略，由预测数据可知，各 VPP的新能源出力与负
荷需求在不同时段差异较大，MVPPO可以通过调
整内部的购售电价策略，为VPP提供与电网相比更
优的价格，促进VPP之间的能源互动。
在 00：00— 09：00、13：00— 16：00、20：00—
24：00时段存在多种状态下的 VPP，此时，MVPPO
将售电给电力市场或从电力市场购电以满足负荷需
求 ，此 时 降 低 MVPPO 售 电 价 ，同 时 适 当 上 调
MVPPO购电价，供电 VPP可以通过调整负荷需
求、燃气机组出力，出售更多的电能，创造更多的收
益。由图 4可以看出，电负荷的极限在 04：00—
06：00、17：00—23：00时段。
在 10：00—13：00时段，所有 VPP都处于供电
状态，此时MVPPO购电价等于上网电价，以求保证
收益；当处于 16：00—20：00时，所有 VPP都处于用
电状态，此时MVPPO售电价等于电网分时电价，同
时上调内部购电价，为了激励燃气机组发电，减少从
电力市场的购电量。
3. 3. 2 主从博弈模式下能量管理分析
为了说明本文所提方法在出力上的有效性，设
置两种方案用以比较：1）多VPP优化中引入需求响
应和主从博弈机制；2）多VPP仅以合作模式参与优
化，不考虑需求响应和主从博弈。
VPP的分布式能量管理响应如图 5所示。方案
1和方案 2下，VPP 1至VPP 3的负荷结果对比见图
5，两者优化方式均能达到波动放缓，但本文所述策
略的削峰填谷效果更明显，同时，在必要的时段内进
行负荷削减，避免了给用户带来过多的计划调整。
进一步分析VPP内部各聚合单元的出力情况，
新能源出力会优先供给所在区域的 VPP。通过调
整内部购售电价，将 00：00—08：00这一期间 VPP 3
盈余的新能源出力出售给处于缺电下的 VPP 1与
VPP 2。在需求响应后的 14：00—20：00时段，受内
部购电价激励，燃气机组出力较多，出售更多的剩余
电量以增加收益；燃气机组在 17：00—24：00时段内
作为补充，弥补新能源的缺失，减少从电网的购
电量。
从表 1可以看出在多 VPP系统增加需求响应
和主从博弈机制可在原先的基础上促进 VPP的运
行经济性，由于内部购售电价处于电网电价之间，为
0
0.5
1.0
1.5
2.0
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1.0
-1.0
-1.5
-2.0
8
*
'
�
0
0.2
0.4
0.6
0.8
1.0
1.2
1.4
-0.5
8
*
'
�
0
0.2
0.4
0.6
0.8
1.0
1.2
8
*
'
�
8*'�
��*�(
�
�
*
�
(
/M
W
0
0.5
1.0
1.5
2.0
-1.0
-1.5
-2.0
-0.5
�
�
*
�
(
/M
W
0
0.5
1.0
1.5
2.0
-1.0
-1.5
-2.5
-2.0
-0.5
�
�
*
�
(
/M
W
�K/h
(a) VPP 1
�K/h
(b) VPP 2
�K/h
(c) VPP 3
8*'�
��*�(
8*'�
��*�(
51 9 13 17 21 24
51 9 13 17 21 24
51 9 13 17 21 24
图 3 储能系统滚动优化调度
Fig. 3 Rolling optimal scheduling of energy
storage system
1 5 9 13 17 21 24
400
600
800
1 000
1 200
1 400
1 600
1 800
�4*�� *4��*��
=�*�
*
�
/(�
·(M
W
·h
)-1
)
�K/h
MVPPOB*��
MVPPO
*�
图 4 博弈电价优化结果
Fig. 4 Optimization results of game electricity price
160
周步祥，等 基于区块链的多虚拟电厂主从博弈优化运行
http：//www.aeps-info.com
了弥补新能源缺失以及提高自身收益，燃气轮机出
力较多，从而成本相比较增大。
3. 3. 3 区块链技术下多VPP运行性能分析
分 别 对 引 入 区 块 链（仿 真 1，Hyperledger
Fabric）和无区块链（仿真 2，MATLAB R2020a）方
法下的优化运行情形进行仿真实验，实验结果如表
2所示。由表 2可见，分布式区块链方法的运营成本
相较于集中式常规方法有所下降，一方面是因为在
集中式方法中，聚合单元需要向运营商支付额外的
费用，以在多 VPP内进行有效的功率分配，另一方
面得益于区块链网络有效的分布式运行模式；削峰
负荷参与量有所上升，说明各VPP积极响应激励机
制，吸引到更多可调负荷参与削峰；通过调节负荷的
用能有效促进了VPP之间进行可再生能源消纳，进
而减少了线路上的有功功率损耗。
在计算效率方面，仿真 1中分布式优化决策的
计 算 时 间 为 132.4 s，其 中 潮 流 算 法 计 算 时 间 为
112.2 s，与仿真 2中集中式决策计算时间 331.3 s相
比（其中潮流算法计算时间为 316.1 s），其决策时间
更短。由此可见，采用区块链技术下的分布式计算
提高了计算效率。
在 Hyperledger Fabric的运行环境下，分别部署
单条联盟链和由资产链、商业链以及技术链组成的
区块链群式架构的区块链，进行网络性能测试。
由于单条联盟链时，完成一次交易需要经过优
化决策、网络安全约束、数据计量认证及交易结算这
一系列流程，从数据上传，到证书交易结束创建区
块，需要 15 min左右，仅仅支持每秒 4笔的交易速
度；而本文所创建的区块链群，则将交易结果、交易
时间、参与主体等信息储存在资产链，将交易行为成
链在商业链，将网络安全验证调整在技术链确认，使
不同时段的各环节可以同时进行。由此，区块链群
网络中完成多链的一次交互运行用时需要 6 min左
右，同时每秒处理的交易量为 9笔。在交易速度和
共识时延上，多 VPP区块链群的运行场景更具有
优势。
4 结语
区块链离散模式的拓扑结构与多 VPP的组织
结构有高度一致性，并且可以满足集中控制下难以
达到的可扩展性和兼容性要求。因此，本文从 VPP
作为一个整体参与能源交易以及系统运行的层面出
发进行了分析研究。构建了考虑多虚拟电厂运营
商、虚拟电厂运营商、分布式能源和负荷聚合商主体
利益以及计及本地网络约束的多 VPP系统主从博
弈优化运行模型，结合区块链技术在多VPP主从博
弈运行中的优势，建立了多 VPP的区块链体系架
构，并提出了区块链群的运行机制。利用区块链节
点具有强大的边缘计算和自我调节能力，本文设计
了基于GA-QP算法的区块链边缘计算的计算方法，
提高了计算速度。使用区块链来存储大量数据，各
VPP节点共享 Stackelberg最优策略并不断改进自
身策略，促进效益最大化，通过智能合约和激励机制
-2
0
2
4
6
8
��*B8� �K*B8
�
(
/M
W
-2
0
2
4
6
8
�
(
/M
W
-2
0
2
4
6
8
10
12
�
(
/M
W
�K/h
(a) VPP 1
�K/h
(b) VPP 2
�K/h
(c) VPP 3
&!D���� �6��*� M���� MVPPOB*
��1*B8��3�� ��2*B8��3�
1 5 9 13 17 21 24
1 5 9 13 17 21 24
1 5 9 13 17 21 24
图 5 VPP电功率优化情况
Fig. 5 Optimization of VPP electric power
表 1 不同方案下的效益和成本
Table 1 Profit and cost with different schemes
VPP
VPP 1
VPP 2
VPP 3
负荷效用值/元
方案 1
205 380
250 140
163 130
方案 2
235 540
269 130
203 980
燃气轮机成本/元
方案 1
62 780
45 460
50 680
方案 2
69 920
44 650
55 070
总效益/元
方案 1
167 340
222 320
166 650
方案 2
185 480
245 200
171 510
表 2 有无区块链的多VPP仿真结果比较
Table 2 Comparison of multi-VPP simulation results
with or without blockchain
VPP
VPP 1
VPP 2
VPP 3
运营成本/元
仿真 1
18 540
12 750
14 210
仿真 2
19 320
14 420
15 110
削峰负荷参与量/
MW
仿真 1
63.53
52.65
65.74
仿真 2
60.44
46.12
55.45
有功损耗/
（MW·h）
仿真 1
0.534
0.118
0.324
仿真 2
0.613
0.163
0.375
161
2022，46（1） ·学术研究·
实现智能决策功能，体现了区块链技术下运行管理
的“分布控制，协同优化”的特点。
本文工作表明，基于区块链的各VPP通过博弈
竞价的优化，调整各自的需求响应及出力，以最大程
度发挥自己效用；提出的区块链群运行机制可以有
效提高 VPP 之间交易处理效率、性能以及计算
效率。
后续将进一步分析电热耦合下的多 VPP主从
博弈优化以及进一步考虑新型储能（如电动汽车、抽
水蓄能电站）如何参与博弈机制下的区块链优化运
行模式。
附录见本刊网络版（http：//www.aeps-info.com/
aeps/ch/index.aspx），扫英文摘要后二维码可以阅读
网络全文。
参 考 文 献
［1］刘振亚 .建设我国能源互联网，推进绿色低碳转型［EB/OL］.
［2020-07-29］. http：//www. chinapower. com. cn/zk/zjgd/
20200729/26456.html.
LIU Zhenya. Build an Energy Internet in China and promote
green and low-carbon transformation［EB/OL］.［2020-07-29］.
http：//www.chinapower.com.cn/zk/zjgd/20200729/26456.html.
［2］方燕琼，甘霖，艾芊，等 .基于主从博弈的虚拟电厂双层竞标策
略［J］.电力系统自动化，2017，41（14）：61-69.
FANG Yanqiong，GAN Lin，AI Qian，et al. Stackelberg game
based bi-level bidding strategy for virtual power plant［J］.
Automation of Electric Power Systems，2017，41（14）：61-69.
［3］KARDAKOS E G， SIMOGLOU C K， BAKIRTZIS A G.
Optimal offering strategy of a virtual power plant：a stochastic bi-
level approach［J］. IEEE Transactions on Smart Grid，2016，7
（2）：794-806.
［4］周亦洲，孙国强，黄文进，等 .多区域虚拟电厂综合能源协调调
度优化模型［J］.中国电机工程学报，2017，37（23）：6780-6790.
ZHOU Yizhou， SUN Guoqiang， HUANG Wenjin， et al.
Optimized multi-regional integrated energy coordinated
scheduling of a virtual power plant［J］. Proceedings of the CSEE，
2017，37（23）：6780-6790.
［5］孙惠娟，蒙锦辉，彭春华 .风-光-水-碳捕集多区域虚拟电厂协调
优化调度［J］.电网技术，2019，43（11）：4040-4051.
SUN Huijuan，MENG Jinhui，PENG Chunhua. Coordinated
optimization scheduling of multi-region virtual power plant with
wind-power/photovoltaic/hydropower/carbon-capture units［J］.
Power System Technology，2019，43（11）：4040-4051.
［6］陈妤，卫志农，胥峥，等 .电力体制改革下的多虚拟电厂联合优
化调度策略［J］.电力系统自动化，2019，43（7）：42-49.
CHEN Yu，WEI Zhinong，XU Zheng，et al. Architecture and
key technologies of lightweight human-machine interaction
system for power grid dispatching and control system［J］.
Automation of Electric Power Systems，2019，43（7）：42-49.
［7］周博，吕林，高红均，等 .多虚拟电厂日前鲁棒交易策略研究［J］.
电网技术，2018，42（8）：2694-2703.
ZHOU Bo，LÜ Lin，GAO Hongjun，et al. Robust day-ahead
trading strategy for multiple virtual power plants［J］. Power
System Technology，2018，42（8）：2694-2703.
［8］WANG Y，AI X，TAN Z F，et al. Interactive dispatch modes
and bidding strategy of multiple virtual power plants based on
demand response and game theory［J］. IEEE Transactions on
Smart Grid，2016，7（1）：510-519.
［9］刘思源，艾芊，郑建平，等 .多时间尺度的多虚拟电厂双层协调
机制与运行策略［J］.中国电机工程学报，2018，38（3）：753-761.
LIU Siyuan， AI Qian， ZHENG Jianping， et al. Bi-level
coordination mechanism and operation strategy of multi-time
scale multiple virtual power plants［J］. Proceedings of the CSEE，
2018，38（3）：753-761.
［10］董雷，涂淑琴，李烨，等 .基于元模型优化算法的主从博弈多虚
拟电厂动态定价和能量管理［J］.电网技术 ，2020，44（3）：
973-981.
DONG Lei，TU Shuqin，LI Ye，et al. A Stackelberg game
model for dynamic pricing and energy management of multiple
virtual power plants using metamodel-based optimization method
［J］. Power System Technology，2020，44（3）：973-981.
［11］LIU N， TAN L， ZHOU L， et al. Multi-party energy
management of energy hub：a hybrid approach with Stackelberg
game and blockchain［J］. Journal of Modern Power Systems
and Clean Energy，2020，8（5）：919-928.
［12］王胜寒，郭创新，冯斌，等 .区块链技术在电力系统中的应用：
前景与思路［J］.电力系统自动化，2020，44（11）：10-24.
WANG Shenghan， GUO Chuangxin， FENG Bin， et al.
Application of blockchain technology in power systems：
prospects and ideas［J］. Automation of Electric Power Systems，
2020，44（11）：10-24.
［13］MÜNSING E，MATHER J，MOURA S. Blockchains for
decentralized optimization of energy resources in microgrid
networks ［C］// 2017 IEEE Conference on Control
Technology and Applications， October 9， 2017， Maui，
USA：2164-2171.
［14］DANZI P，ANGJELICHINOSKI M，STEFANOVIĆ Č，et
al. Distributed proportional-fairness control in microgrids via
blockchain smart contracts［C］// 2017 IEEE International
Conference on Smart Grid Communications，October 23-27，
2017，Dresden，Germany：45-51.
［15］艾芊 .虚拟电厂：能源互联网的终极组态［M］.北京：科学出版
社，2018.
AI Qian. Virtual power plants：the ultimate configuration of the
energy internet［M］. Beijing：Science Press，2018.
［16］李军祥，王宇倩，何建佳，等 .基于区块链的微电网电力市场电
价与电量动态博弈［J/OL］.电力系统自动化［2021-06-17］.
http：//kns. cnki. net/kcms/detail/32.1180. TP. 20210617.1441.
006.html.
LI Junxiang，WANG Yuqian，HE Jianjia，et al. Blockchain-
based dynamic game of electricity price and power for microgrid
electricity market［J/OL］. Automation of Electric Power
Systems ［2021-06-17］. http：//kns. cnki. net/kcms/detail/32.
1180.TP.20210617.1441.006.html.
［17］陈岑，武传涛，林湘宁，等 .计及上下游市场的园区综合能源商
购售能策略［J/OL］.电工技术学报［2021-03-03］.https：//doi.
org/10.19595/j.cnki.1000-6753.tces.201400.
CHEN Cen，WU Chuantao，LIN Xiangning，et al. Purchase
162
周步祥，等 基于区块链的多虚拟电厂主从博弈优化运行
http：//www.aeps-info.com
and sale strategies of park integrated energy suppliers in
wholesale and retail markets［J/OL］. Transactions of China
Electrotechnical Society ［2021-03-03］. https：//doi. org/10.
19595/j.cnki.10006753.tces.201400.
［18］KORAKI D，STRUNZ K. Wind and solar power integration in
electricity markets and distribution networks through service-
centric virtual power plants［J］. IEEE Transactions on Power
System，2018，33（1）：473-485.
［19］LI Z Y， SHAHIDEHPOUR M， LIU X. Cyber-secure
decentralized energy management for IoT-enabled active
distribution networks［J］. Journal of Modern Power Systems
and Clean Energy，2018，6（5）：900-917.
［20］DONG Z Y，LUO F J，LIANG G Q. Blockchain：a secure，
decentralized， trusted cyber infrastructure solution for future
energy systems［J］. Journal of Modern Power Systems and
Clean Energy，2018，6（5）：958-967.
［21］龚钢军，王慧娟，杨晟，等 .区块链技术下的综合能源服务［J］.
中国电机工程学报，2020，40（5）：1397-1408.
GONG Gangjun，WANG Huijuan， YANG Sheng， et al.
Research on integrated energy service based on blockchain
technology［J］. Proceedings of the CSEE，2020，40（5）：1397-
1408.
［22］熊宇峰，司杨，郑天文，等 .基于主从博弈的工业园区综合能源
系统氢储能优化配置［J］.电工技术学报，2021，36（3）：507-516.
XIONG Yufeng，SI Yang，ZHENG Tianwen，et al. Optimal
configuration of hydrogen storage in industrial park integrated
energy system based on Stackelberg game［J］. Transactions of
China Electrotechnical Society，2021，36（3）：507-516.
［23］沈翔宇，陈思捷，严正，等 .区块链在能源领域的价值、应用场
景与适用性分析［J］.电力系统自动化，2021，45（5）：18-29.
SHEN Xiangyu，CHEN Sijie，YAN Zheng，et al. Analysis of
the value application scenarios and applicability of blockchain in
the energy field［J］. Automation of Electric Power Systems，
2021，45（5）：18-29.
［24］马春光，安婧，毕伟，等 .区块链中的智能合约［J］.信息网络安
全，2018（11）：8-17.
MA Chunguang，AN Jing，BI Wei，et al. Smart contract in
blockchain［J］. Netinfo Security，2018（11）：8-17.
［25］LIU N，CHENG M，YU X，et al. Energy-sharing provider for
PV prosumer clusters： a hybrid approach using stochastic
programming and Stackelberg game［J］. IEEE Transactions on
Industrial Electronics，2018，65（8）：6740-6750.
周步祥 (1965—)，男，博士，教授，博士生导师，主要研究
方 向 ：电 力 系 统 调 度 自 动 化 及 计 算 机 信 息 处 理 。E-mail：
hiaway_scu@l26.com
张 越(1997—)，女，硕士研究生，主要研究方向：综合能
源 系 统 运 行 优 化 与 控 制 、虚 拟 电 厂 及 区 块 链 。 E-mail：
3329752946@qq.com
臧天磊 (1986—)，男，通信作者，博士，特聘副研究员，主
要 研 究 方 向 ：综 合 能 源 系 统 运 行 优 化 与 控 制 。 E-mail：
zangtianlei@126.com
（编辑 王梦岩）
Blockchain-based Stackelberg Game Optimal Operation of Multiple Virtual Power Plants
ZHOU Buxiang，ZHANG Yue，ZANG Tianlei，CAO Qiang，ZHANG Yuanhong，PENG Haoyu
(College of Electrical Engineering, Sichuan University, Chengdu 610065, China)
Abstract: In the future power system where renewable energy is predominant, the energy management of multiple virtual power
plants (VPPs) will be more complicated and challenging. Considering the characteristics of blockchain technology including
information security, transparent mechanism, and regional co-governance, a blockchain consisting of commercial chain, technical
chain and asset chain is designed inspired by the functional characteristics of VPPs. Then, comprehensively considering the
association and conflict of the interest of the multiple decision-making entities formed by multiple VPPs, a Stackelberg game based
optimal operation method is introduced with the network security constraints. On this basis, the optimal operation mode of multiple
VPPs based on the blockchain technology is analyzed and designed from the aspects including the network level framework,
interaction mechanism, smart contracts, and incentive mechanism. Finally, case studies are conducted to verify the effectiveness of
the proposed method.
This work is supported by National Natural Science Foundation of China (No. 51907097) and Science and Technology
Planning Project of Sichuan Province of China (No. 2020JDRC0049).
Key words: multiple virtual power plants; Stackelberg game; network security constraint; blockchain technology; operation mode
163